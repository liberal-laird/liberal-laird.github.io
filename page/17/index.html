<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="baidu-site-verification" content="codeva-6wmKWl5hmx" />
<meta name="bytedance-verification-code" content="GcOf/MpQ8shZ5Hh/2hvr" />
<meta name="google-site-verification" content="wivqPhuFdISMEKkFZjOWHPYJGSvd716d9R7Bwy2Jj-A" />
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4636539228226058"
     crossorigin="anonymous"></script>
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.vvbuys.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Share some post and some issue for linux program">
<meta property="og:type" content="website">
<meta property="og:title" content="VVbugs Blog">
<meta property="og:url" content="https://www.vvbuys.com/page/17/index.html">
<meta property="og:site_name" content="VVbugs Blog">
<meta property="og:description" content="Share some post and some issue for linux program">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="vvbuys">
<meta property="article:tag" content="Linux hyprland Python Rust Golang javascript">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.vvbuys.com/page/17/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/17/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>VVbugs Blog - standalone Linux lover</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">VVbugs Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">standalone Linux lover</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">vvbuys</p>
  <div class="site-description" itemprop="description">Share some post and some issue for linux program</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">265</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/read_sf_plf/2019-03-11-sf-plf-11-typechecking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/read_sf_plf/2019-03-11-sf-plf-11-typechecking/" class="post-title-link" itemprop="url">「SF-PLF」11. TypeChecking</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>The <code>has_type</code> relation is good but doesn’t give us a <em>executable algorithm</em> – 不是一个算法<br>but it’s <em>syntax directed</em>, just one typing rule for one term (unique typing) – translate into function!</p>
</blockquote>
<h2 id="Comparing-Types"><a href="#Comparing-Types" class="headerlink" title="Comparing Types"></a>Comparing Types</h2><p>首先我们需要 check equality for types.<br>这里非常简单，如果是 SystemF 会麻烦很多，对 <code>∀</code> 要做 local nameless 或者 alpha renaming:</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> eqb_ty (T1 T2:ty) : bool :=</span><br><span class="line">  <span class="keyword">match</span> T1,T2 <span class="built_in">with</span></span><br><span class="line">  | <span class="type">Bool</span>, Bool ⇒</span><br><span class="line">      true</span><br><span class="line">  | <span class="type">Arrow</span> T11 T12, Arrow T21 T22 ⇒</span><br><span class="line">      andb (eqb_ty T11 T21) (eqb_ty T12 T22)</span><br><span class="line">  | <span class="type">_</span>,<span class="keyword">_</span> ⇒</span><br><span class="line">      false</span><br><span class="line">  <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>

<p>然后我们需要一个 refl 和一个 reflection，准确得说：「define equality by computation」，反方向用 refl 即可易证</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Lemma</span> eqb_ty_refl : ∀T1,</span><br><span class="line">  eqb_ty T1 T1 = true.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Lemma</span> eqb_ty__eq : ∀T1 T2,</span><br><span class="line">  eqb_ty T1 T2 = true → T1 = T2.</span><br></pre></td></tr></table></figure>



<h2 id="The-Typechecker"><a href="#The-Typechecker" class="headerlink" title="The Typechecker"></a>The Typechecker</h2><p>直接 syntax directed，不过麻烦的是需要 pattern matching <code>option</code>…</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> type_check (Gamma : context) (t : tm) : option ty :=</span><br><span class="line">  <span class="keyword">match</span> t <span class="built_in">with</span></span><br><span class="line">  | <span class="type">var</span> x =&gt;</span><br><span class="line">      Gamma x</span><br><span class="line">  | <span class="type">abs</span> x T11 t12 =&gt;</span><br><span class="line">      <span class="keyword">match</span> type_check (update Gamma x T11) t12 <span class="built_in">with</span>     <span class="comment">(** &lt;-- 对应 t12 的 rule **)</span></span><br><span class="line">      | <span class="type">Some</span> T12 =&gt; Some (Arrow T11 T12)                 </span><br><span class="line">      | <span class="type">_</span> =&gt; None</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  | <span class="type">app</span> t1 t2 =&gt;</span><br><span class="line">      <span class="keyword">match</span> type_check Gamma t1, type_check Gamma t2 <span class="built_in">with</span></span><br><span class="line">      | <span class="type">Some</span> (Arrow T11 T12),Some T2 =&gt;</span><br><span class="line">          <span class="keyword">if</span> eqb_ty T11 T2 <span class="keyword">then</span> Some T12 <span class="keyword">else</span> None       <span class="comment">(** eqb_ty 见下文 **)</span></span><br><span class="line">      | <span class="type">_</span>,<span class="keyword">_</span> =&gt; None</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>在课堂时提到关于 <code>eqb_ty</code> 的一个细节（我以前也经常犯，在 ML&#x2F;Haskell 中……）：<br>我们能不能在 pattern matching 里支持「用同一个 binding 来 imply 说他们两需要 be equal」？</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(** instead of this **)</span></span><br><span class="line">| <span class="type">Some</span> (Arrow T11 T12),Some T2 =&gt; <span class="keyword">if</span> eqb_ty T11 T2 <span class="keyword">then</span> ...</span><br><span class="line"></span><br><span class="line"><span class="comment">(** can we do this? **)</span></span><br><span class="line">| <span class="type">Some</span> (Arrow T   T&#x27; ),Some T  =&gt; ...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>the answer is <strong>NO</strong> because this demands a <em>decidable equality</em>.<br>我好奇的是，用 typeclass 是不是就可以 bake in 这个功能了？尤其是在 Coq function 还是 total 的情况下</p>
</blockquote>
<h2 id="Digression-Improving-the-Notation"><a href="#Digression-Improving-the-Notation" class="headerlink" title="Digression: Improving the Notation"></a>Digression: Improving the Notation</h2><p>这里我们可以自己定义一个 Haskell <code>do</code> notation 风格的 <em>monadic</em> notation:</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Notation</span> <span class="string">&quot; x &lt;- e1 ;; e2&quot;</span> := (<span class="keyword">match</span> e1 <span class="built_in">with</span></span><br><span class="line">                              | <span class="type">Some</span> x ⇒ e2</span><br><span class="line">                              | <span class="type">None</span> ⇒ None</span><br><span class="line">                              <span class="keyword">end</span>)</span><br><span class="line">         (<span class="built_in">right</span> associativity, <span class="built_in">at</span> level <span class="number">60</span>).</span><br><span class="line"></span><br><span class="line"><span class="keyword">Notation</span> <span class="string">&quot; &#x27;return&#x27; e &quot;</span></span><br><span class="line">  := (Some e) (<span class="built_in">at</span> level <span class="number">60</span>).</span><br><span class="line"></span><br><span class="line"><span class="keyword">Notation</span> <span class="string">&quot; &#x27;fail&#x27; &quot;</span></span><br><span class="line">  := None.</span><br></pre></td></tr></table></figure>

<p>好看一些吧反正：</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> type_check (Gamma : context) (t : tm) : option ty :=</span><br><span class="line">  <span class="keyword">match</span> t <span class="built_in">with</span></span><br><span class="line">  | <span class="type">var</span> x ⇒</span><br><span class="line">      Gamma x </span><br><span class="line">  | <span class="type">abs</span> x T11 t12 ⇒</span><br><span class="line">      T12 &lt;- type_check (update Gamma x T11) t12 ;;</span><br><span class="line">      <span class="keyword">return</span> (Arrow T11 T12)</span><br><span class="line">  | <span class="type">app</span> t1 t2 ⇒</span><br><span class="line">      T1 &lt;- type_check Gamma t1 ;;</span><br><span class="line">      T2 &lt;- type_check Gamma t2 ;;</span><br><span class="line">      <span class="keyword">match</span> T1 <span class="built_in">with</span> </span><br><span class="line">      | <span class="type">Arrow</span> T11 T12 ⇒ <span class="keyword">if</span> eqb_ty T11 T2 <span class="keyword">then</span> <span class="keyword">return</span> T12 <span class="keyword">else</span> <span class="built_in">fail</span></span><br><span class="line">      | <span class="type">_</span> ⇒ <span class="built_in">fail</span></span><br><span class="line">      <span class="keyword">end</span></span><br></pre></td></tr></table></figure>


<h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><p>最后我们需要验证一下算法的正确性：<br>这里的 soundness 和 completess 都是围绕 “typechecking function ~ typing relation inference rule” 这组关系来说的：</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Theorem</span> type_checking_sound : ∀Gamma t T,</span><br><span class="line">  type_check Gamma t = Some T → has_type Gamma t T.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Theorem</span> type_checking_complete : ∀Gamma t T,</span><br><span class="line">  has_type Gamma t T → type_check Gamma t = Some T.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h2><p>给 <code>MoreStlc.v</code> 里的 StlcE 写 typechecker, 然后 prove soundness &#x2F; completeness （过程中用了非常 mega 的 tactics）</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(** 还不能这么写 **)</span></span><br><span class="line">| <span class="type">fst</span> p =&gt;</span><br><span class="line">    (Prod T1 T2) &lt;- type_check Gamma p ;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">(** 要这样……感觉是 notation 的缘故？并且要提供 fallback case 才能通过 exhaustive check 是真的 **)</span></span><br><span class="line">| <span class="type">fst</span> p =&gt;</span><br><span class="line">    Tp &lt;- type_check Gamma p ;;</span><br><span class="line">    <span class="keyword">match</span> Tp <span class="built_in">with</span></span><br><span class="line">    | <span class="type">(Prod</span> T1 T2) =&gt; T1</span><br><span class="line">    | <span class="type">_</span> =&gt; <span class="built_in">fail</span></span><br><span class="line">    <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>


<h2 id="Extra-Exercise-Prof-Mtf"><a href="#Extra-Exercise-Prof-Mtf" class="headerlink" title="Extra Exercise (Prof.Mtf)"></a>Extra Exercise (Prof.Mtf)</h2><blockquote>
<p>I believe this part of exercise was added by Prof. Fluet (not found in SF website version)</p>
</blockquote>
<p>给 <code>MoreStlc.v</code> 的 operational semantics 写 Interpreter (<code>stepf</code>), 然后 prove soundness &#x2F; completeness… </p>
<h3 id="step-vs-stepf"><a href="#step-vs-stepf" class="headerlink" title="step vs. stepf"></a><code>step</code> vs. <code>stepf</code></h3><p>首先我们定义了 <code>value</code> 关系的函数版本 <code>valuef</code>，<br>然后我们定义 <code>step</code> 关系的函数版本 <code>stepf</code>:</p>
<p>以 pure STLC 为例：</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Inductive</span> step : tm -&gt; tm -&gt; <span class="keyword">Prop</span> :=</span><br><span class="line">  | <span class="type">ST_AppAbs</span> : <span class="keyword">forall</span> x T11 t12 v2,</span><br><span class="line">         value v2 -&gt;</span><br><span class="line">         (app (abs x T11 t12) v2) --&gt; [x:=v2]t12</span><br><span class="line">  | <span class="type">ST_App1</span> : <span class="keyword">forall</span> t1 t1&#x27; t2,</span><br><span class="line">         t1 --&gt; t1&#x27; -&gt;</span><br><span class="line">         (app t1 t2) --&gt; (app t1&#x27; t2)</span><br><span class="line">  | <span class="type">ST_App2</span> : <span class="keyword">forall</span> v1 t2 t2&#x27;,</span><br><span class="line">         value v1 -&gt;</span><br><span class="line">         t2 --&gt; t2&#x27; -&gt;</span><br><span class="line">         (app v1 t2) --&gt; (app v1 t2&#x27;)</span><br></pre></td></tr></table></figure>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> stepf (t : tm) : option tm :=</span><br><span class="line">  <span class="keyword">match</span> t <span class="built_in">with</span></span><br><span class="line">  | <span class="type">var</span> x        =&gt; None <span class="comment">(* We only define step for closed terms *)</span></span><br><span class="line">  | <span class="type">abs</span> x1 T1 t2 =&gt; None <span class="comment">(* Abstraction is a value *)</span></span><br><span class="line">  | <span class="type">app</span> t1 t2    =&gt;</span><br><span class="line">    <span class="keyword">match</span> stepf t1, stepf t2, t1 <span class="built_in">with</span></span><br><span class="line">    | <span class="type">Some</span> t1&#x27;, <span class="keyword">_</span>       , <span class="keyword">_</span>           =&gt;                     Some (app t1&#x27; t2)</span><br><span class="line">    | <span class="type">None</span>    , Some t2&#x27;, <span class="keyword">_</span>           =&gt; <span class="built_in">assert</span> (valuef t1) (Some (app t1 t2&#x27;)) <span class="comment">(* otherwise [t1]      is a normal form *)</span></span><br><span class="line">    | <span class="type">None</span>    , None    , abs x T t11 =&gt; <span class="built_in">assert</span> (valuef t2) (Some ([x:=t2]t11)) <span class="comment">(* otherwise [t1], [t2] are normal forms *)</span></span><br><span class="line">    | <span class="type">_</span>       , <span class="keyword">_</span>       , <span class="keyword">_</span>           =&gt;                     None</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Definition</span> <span class="built_in">assert</span> (b : bool) (a : option tm) : option tm := <span class="keyword">if</span> b <span class="keyword">then</span> a <span class="keyword">else</span> None.</span><br></pre></td></tr></table></figure>

<ol>
<li><p>对于关系，一直就是 implicitly applied 的，在可用时即使用。<br>对于函数，我们需要手动指定 match 的顺序</p>
</li>
<li><p><code>stepf t1 =&gt; None</code> 只代表这是一个 <code>normal form</code>，但不一定就是 <code>value</code>，还有可能是 stuck 了，所以我们需要额外的 <code>assert</code>ion. (失败时返回异常)<br><strong>dynamics</strong> 本身与 <strong>statics</strong> 是正交的，在 <code>typecheck</code> 之后我们可以有 <code>progress</code>，但是现在还没有</p>
</li>
</ol>
<h3 id="Soundness"><a href="#Soundness" class="headerlink" title="Soundness"></a>Soundness</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Theorem</span> sound_stepf : <span class="keyword">forall</span> t t&#x27;,</span><br><span class="line">    stepf t = Some t&#x27;  -&gt;  t --&gt; t&#x27;.</span><br></pre></td></tr></table></figure>

<p>证明用了一个 given 的非常夸张的 automation…</p>
<p>不过帮助我找到了 <code>stepf</code> 和 <code>step</code> 的多处 inconsistency: </p>
<ul>
<li>3 次做 <code>subst</code> 时依赖的 <code>valuef</code> 不能省</li>
<li><code>valuef pair</code> 该怎么写才合适？<br>最后把 <code>step</code> 中的 <code>value p -&gt;</code> 改成了 <code>value v1 -&gt; value v2 -&gt;</code>，<br>因为 <code>valuef (pair v1 v2)</code> 出来的 <code>valuef v1 &amp;&amp; valuef v2</code> 比较麻烦。<br>但底线是：<strong>两者必须 consistent！</strong> 这时就能感受到 Formal Methods 的严谨了。</li>
</ul>
<h3 id="Completeness"><a href="#Completeness" class="headerlink" title="Completeness"></a>Completeness</h3><p>发现了 pair 实现漏了 2 个 case……然后才发现了 <code>Soundness</code> 自动化中的 <code>valuef pair</code> 问题</p>
<h2 id="Extra-Mentioned"><a href="#Extra-Mentioned" class="headerlink" title="Extra (Mentioned)"></a>Extra (Mentioned)</h2><hr>
<p><a target="_blank" rel="noopener" href="https://lispcast.com/church-vs-curry-types/">Church Style vs. Curry Style</a><br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Rice%27s_theorem">Rice’s Theorem</a></p>
<p>CakeML </p>
<ul>
<li>prove correctness of ML lang compiler</li>
<li>latest paper on verifying GC</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/read_sf_plf/2019-03-12-sf-plf-12-records/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/read_sf_plf/2019-03-12-sf-plf-12-records/" class="post-title-link" itemprop="url">「SF-PLF」12 Records</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Adding-Records"><a href="#Adding-Records" class="headerlink" title="Adding Records"></a>Adding Records</h2><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">t ::=                          Terms:</span><br><span class="line">    | <span class="type">&#123;i1</span>=t1, ..., <span class="built_in">in</span>=tn&#125;         <span class="built_in">record</span></span><br><span class="line">    | <span class="type">t</span>.i                         projection</span><br><span class="line">    | <span class="type">...</span></span><br><span class="line"><span class="type"></span></span><br><span class="line"><span class="type">v</span> ::=                          Values:</span><br><span class="line">    | <span class="type">&#123;i1</span>=v1, ..., <span class="built_in">in</span>=vn&#125;         <span class="built_in">record</span> value</span><br><span class="line">    | <span class="type">...</span></span><br><span class="line"><span class="type"></span></span><br><span class="line"><span class="type">T</span> ::=                          <span class="keyword">Types</span>:</span><br><span class="line">    | <span class="type">&#123;i1</span>:T1, ..., <span class="built_in">in</span>:Tn&#125;         <span class="built_in">record</span> type</span><br><span class="line">    | <span class="type">...</span></span><br></pre></td></tr></table></figure>


<h2 id="Formalizing-Records"><a href="#Formalizing-Records" class="headerlink" title="Formalizing Records"></a>Formalizing Records</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/read_sf_plf/2019-03-13-sf-plf-13-references/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/read_sf_plf/2019-03-13-sf-plf-13-references/" class="post-title-link" itemprop="url">「SF-PLF」13 References</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>Hux: this chapter is very similar to TAPL - ch13 References<br>But under a “formal verification” concept, it’s more interesting and practical and push you to think about it!</p>
</blockquote>
<p><em>computational effects</em> - “side effects” of computation - <em>impure</em> features</p>
<ul>
<li>assign to mutable variables (reference cells, arrays, mutable record fields, etc.)</li>
<li>perform input and output to files, displays, or network connections; </li>
<li>make non-local transfers of control via exceptions, jumps, or continuations; </li>
<li>engage in inter-process synchronization and communication</li>
</ul>
<blockquote>
<p>The main extension will be dealing explicitly with a </p>
<ul>
<li><em>store</em> (or <em>heap</em>) and </li>
<li><em>pointers</em> (or <em>reference</em>) that name <em>store locations</em>, or <em>address</em>…</li>
</ul>
</blockquote>
<p>interesting refinement: type preservation</p>
<h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h2><p>forms of assignments:</p>
<ul>
<li>rare : Gallina   - No </li>
<li>some : ML family - Explicit <em>reference</em> and <em>dereference</em></li>
<li>most : C  family - Implicit …</li>
</ul>
<p>For formal study, use ML’s model.</p>
<h2 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h2><h3 id="Types-Terms"><a href="#Types-Terms" class="headerlink" title="Types &amp; Terms"></a>Types &amp; Terms</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">T ::= </span><br><span class="line">    | <span class="type">Nat</span></span><br><span class="line">    | <span class="type">Unit</span></span><br><span class="line">    | <span class="type">T</span> → T</span><br><span class="line">    | <span class="type">Ref</span> T</span><br><span class="line"></span><br><span class="line">t ::= </span><br><span class="line">    | <span class="type">...                Terms</span></span><br><span class="line">    | <span class="type">ref</span> t              allocation</span><br><span class="line">    | <span class="type">!t</span>                 dereference</span><br><span class="line">    | <span class="type">t</span> := t             assignment</span><br><span class="line">    | <span class="type">l</span>                  location</span><br></pre></td></tr></table></figure>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Inductive</span> ty : <span class="keyword">Type</span> :=</span><br><span class="line">  | <span class="type">Nat</span> : ty</span><br><span class="line">  | <span class="type">Unit</span> : ty</span><br><span class="line">  | <span class="type">Arrow</span> : ty → ty → ty</span><br><span class="line">  | <span class="type">Ref</span> : ty → ty.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Inductive</span> tm : <span class="keyword">Type</span> :=</span><br><span class="line">  <span class="comment">(* STLC with numbers: *)</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">(* New terms: *)</span></span><br><span class="line">  | <span class="type">unit</span> : tm</span><br><span class="line">  | <span class="type">ref</span> : tm → tm</span><br><span class="line">  | <span class="type">deref</span> : tm → tm</span><br><span class="line">  | <span class="type">assign</span> : tm → tm → tm</span><br><span class="line">  | <span class="type">loc</span> : nat → tm.         <span class="comment">(** 这里表示 l 的方式是 wrap 一个 nat as loc **)</span></span><br></pre></td></tr></table></figure>


<h3 id="Typing"><a href="#Typing" class="headerlink" title="Typing"></a>Typing</h3><pre><code>                       Gamma |- t1 : T1
                   ------------------------                         (T_Ref)
                   Gamma |- ref t1 : Ref T1

                    Gamma |- t1 : Ref T11
                    ---------------------                         (T_Deref)
                      Gamma |- !t1 : T11

                    Gamma |- t1 : Ref T11
                      Gamma |- t2 : T11
                   ------------------------                      (T_Assign)
                   Gamma |- t1 := t2 : Unit
</code></pre>
<h3 id="Values-and-Substitution"><a href="#Values-and-Substitution" class="headerlink" title="Values and Substitution"></a>Values and Substitution</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Inductive</span> value : tm → <span class="keyword">Prop</span> :=</span><br><span class="line">  ...</span><br><span class="line">  | <span class="type">v_unit</span> :     value unit</span><br><span class="line">  | <span class="type">v_loc</span>  : ∀l, value (loc l).  <span class="comment">(* &lt;-- 注意这里是一个 Π (l:nat) . value (loc l) *)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> <span class="built_in">subst</span> (x:string) (s:tm) (t:tm) : tm :=</span><br><span class="line">  <span class="keyword">match</span> t <span class="built_in">with</span></span><br><span class="line">  ...</span><br><span class="line">  | <span class="type">unit</span>         ⇒ t</span><br><span class="line">  | <span class="type">ref</span> t1       ⇒ ref (<span class="built_in">subst</span> x s t1)</span><br><span class="line">  | <span class="type">deref</span> t1     ⇒ deref (<span class="built_in">subst</span> x s t1)</span><br><span class="line">  | <span class="type">assign</span> t1 t2 ⇒ assign (<span class="built_in">subst</span> x s t1) (<span class="built_in">subst</span> x s t2)</span><br><span class="line">  | <span class="type">loc</span> <span class="keyword">_</span>        ⇒ t</span><br><span class="line">  <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>




<h2 id="Pragmatics"><a href="#Pragmatics" class="headerlink" title="Pragmatics"></a>Pragmatics</h2><h3 id="Side-Effects-and-Sequencing"><a href="#Side-Effects-and-Sequencing" class="headerlink" title="Side Effects and Sequencing"></a>Side Effects and Sequencing</h3><pre><code>r:=succ(!r); !r
</code></pre>
<p>can be desugar to</p>
<pre><code>(\x:Unit. !r) (r:=succ(!r)).
</code></pre>
<p>then we can write some “imperative programming”</p>
<pre><code>r:=succ(!r); 
r:=succ(!r); 
r:=succ(!r); 
!r
</code></pre>
<h3 id="References-and-Aliasing"><a href="#References-and-Aliasing" class="headerlink" title="References and Aliasing"></a>References and Aliasing</h3><p><em>shared reference</em> brings _<em>shared state</em></p>
<pre><code>let r = ref 5 in
let s = r in
s := 82;
(!r)+1
</code></pre>
<h3 id="Shared-State"><a href="#Shared-State" class="headerlink" title="Shared State"></a>Shared State</h3><p><em>thunks</em> as <em>methods</em> </p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title">let</span> c = ref <span class="number">0</span> <span class="keyword">in</span></span><br><span class="line"><span class="title">let</span> incc = \_:<span class="type">Unit</span>. (c := succ (!c); !c) <span class="keyword">in</span></span><br><span class="line"><span class="title">let</span> decc = \_:<span class="type">Unit</span>. (c := pred (!c); !c) <span class="keyword">in</span> (</span><br><span class="line">  incc unit; </span><br><span class="line">  incc unit;          <span class="comment">-- in real PL: the concrete syntax is `incc()`</span></span><br><span class="line">  decc unit</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h3><p><em>constructor</em> and <em>encapsulation</em>!</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title">newcounter</span> =</span><br><span class="line">  \_:<span class="type">Unit</span>.            <span class="comment">-- add `(self, init_val)` would make it more &quot;real&quot;</span></span><br><span class="line">    <span class="keyword">let</span> c = ref <span class="number">0</span> <span class="keyword">in</span>  <span class="comment">-- private and only accessible via closure (特权方法)</span></span><br><span class="line">    <span class="keyword">let</span> incc = \_:<span class="type">Unit</span>. (c := succ (!c); !c) <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> decc = \_:<span class="type">Unit</span>. (c := pred (!c); !c) <span class="keyword">in</span></span><br><span class="line">    &#123; i=incc, </span><br><span class="line">      d=decc  &#125;       <span class="comment">-- return a &quot;record&quot;, or &quot;struct&quot;, or &quot;object&quot;!</span></span><br><span class="line">      </span><br></pre></td></tr></table></figure>


<h3 id="References-to-Compound-Types-e-g-Function-Type"><a href="#References-to-Compound-Types-e-g-Function-Type" class="headerlink" title="References to Compound Types (e.g. Function Type)"></a>References to Compound Types (e.g. Function Type)</h3><p>Previously, we use <em>closure</em> to represent <em>map</em>, with <em>functional update</em><br>这里的”数组” （这个到底算不算数组估计都有争议，虽然的确提供了 index 但是这个显然是 O(n) 都不知道算不算 random access…<br>并不是 in-place update 里面的数据的，仅仅是一个 <code>ref</code> 包住的 map 而已 （仅仅是多了可以 shared</p>
<p>其实或许 <code>list (ref nat)</code> 也可以表达数组？ 反正都是 O(n) 每次都 linear search 也一样……</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title">newarray</span> = \_:<span class="type">Unit</span>. ref (\n:<span class="type">Nat</span>.<span class="number">0</span>)</span><br><span class="line"><span class="title">lookup</span> = \a:<span class="type">NatArray</span>. \n:<span class="type">Nat</span>. (!a) n   </span><br><span class="line"><span class="title">update</span> = \a:<span class="type">NatArray</span>. \m:<span class="type">Nat</span>. \v:<span class="type">Nat</span>.</span><br><span class="line">           <span class="keyword">let</span> oldf = !a <span class="keyword">in</span></span><br><span class="line">           a := (\n:<span class="type">Nat</span>. <span class="keyword">if</span> equal m n <span class="keyword">then</span> v <span class="keyword">else</span> oldf n);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Null-References"><a href="#Null-References" class="headerlink" title="Null References"></a>Null References</h3><p><em>nullptr</em>!</p>
<p>Deref a nullptr:</p>
<ul>
<li>exception in Java&#x2F;C#</li>
<li>insecure in C&#x2F;C++     &lt;– violate memory safety!!</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Option</span> <span class="type">T</span>   = <span class="type">Unit</span> + <span class="type">T</span></span></span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="type">Nullable</span> <span class="type">T</span> = <span class="type">Option</span> (<span class="type">Ref</span> <span class="type">T</span>)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>Why is <code>Option</code> outside?<br>think about C, <code>nullptr</code> is A special <em>const</em> location, like <code>Unit</code> (<code>None</code> in terms of datacon) here.</p>
<h3 id="Garbage-Collection"><a href="#Garbage-Collection" class="headerlink" title="Garbage Collection"></a>Garbage Collection</h3><p>last issue: store <em>de-allocation</em> </p>
<blockquote>
<p>w&#x2F;o GC, extremely difficult to achieve type safety…if a primitive for “explicit deallocation” provided<br>one can easily create <em>dangling reference</em> i.e. references -&gt; deleted</p>
</blockquote>
<p>One type-unsafe example: (pseudo code)</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title">a</span> : <span class="type">Ref</span> <span class="type">Nat</span> = ref <span class="number">1</span>;       <span class="comment">-- alloc loc 0</span></span><br><span class="line"><span class="title">free</span>(a);                   <span class="comment">-- free  loc 0</span></span><br><span class="line"><span class="title">b</span> : <span class="type">Ref</span> <span class="type">Bool</span> = ref <span class="type">True</span>;   <span class="comment">-- alloc loc 0</span></span><br><span class="line"></span><br><span class="line"><span class="title">a</span> := !a + <span class="number">1</span>                <span class="comment">-- BOOM!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="Operational-Semantics"><a href="#Operational-Semantics" class="headerlink" title="Operational Semantics"></a>Operational Semantics</h2><h3 id="Locations"><a href="#Locations" class="headerlink" title="Locations"></a>Locations</h3><blockquote>
<p>what should be the <em>values</em> of type <code>Ref T</code>? </p>
</blockquote>
<p><code>ref</code> allocate some memory&#x2F;storage!</p>
<blockquote>
<p>run-time store is essentially big array of bytes.<br>different datatype need to allocate different size of space (region)</p>
</blockquote>
<blockquote>
<p>we think store as <em>array of values</em>, <em>abstracting away different size of different values</em><br>we use the word <em>location</em> here to prevent from modeling <em>pointer arithmetic</em>, which is un-trackable by most type system</p>
</blockquote>
<p>location <code>n</code> is <code>float</code> doesn’t tell you anything about location <code>n+4</code>…</p>
<h3 id="Stores"><a href="#Stores" class="headerlink" title="Stores"></a>Stores</h3><p>we defined <code>replace</code> as <code>Fixpoint</code> since it’s computational and easier. The consequence is it has to be total.</p>
<h3 id="Reduction"><a href="#Reduction" class="headerlink" title="Reduction"></a>Reduction</h3><h2 id="Typing-1"><a href="#Typing-1" class="headerlink" title="Typing"></a>Typing</h2><p>typing context:</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Definition</span> context := partial_map ty.</span><br></pre></td></tr></table></figure>

<h3 id="Store-typings"><a href="#Store-typings" class="headerlink" title="Store typings"></a>Store typings</h3><p>why not just make a <em>context</em> a map of pair?<br>we don’t want to complicate the dynamics of language,<br>and this store typing is only for type check.</p>
<h3 id="The-Typing-Relation"><a href="#The-Typing-Relation" class="headerlink" title="The Typing Relation"></a>The Typing Relation</h3><h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><h3 id="Well-Typed-Stores"><a href="#Well-Typed-Stores" class="headerlink" title="Well-Typed Stores"></a>Well-Typed Stores</h3><h3 id="Extending-Store-Typings"><a href="#Extending-Store-Typings" class="headerlink" title="Extending Store Typings"></a>Extending Store Typings</h3><h3 id="Preservation-Finally"><a href="#Preservation-Finally" class="headerlink" title="Preservation, Finally"></a>Preservation, Finally</h3><h3 id="Substitution-Lemma"><a href="#Substitution-Lemma" class="headerlink" title="Substitution Lemma"></a>Substitution Lemma</h3><h3 id="Assignment-Preserves-Store-Typing"><a href="#Assignment-Preserves-Store-Typing" class="headerlink" title="Assignment Preserves Store Typing"></a>Assignment Preserves Store Typing</h3><h3 id="Weakening-for-Stores"><a href="#Weakening-for-Stores" class="headerlink" title="Weakening for Stores"></a>Weakening for Stores</h3><h3 id="Preservation"><a href="#Preservation" class="headerlink" title="Preservation!"></a>Preservation!</h3><h3 id="Progress"><a href="#Progress" class="headerlink" title="Progress"></a>Progress</h3><h2 id="References-and-Nontermination"><a href="#References-and-Nontermination" class="headerlink" title="References and Nontermination"></a>References and Nontermination</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/read_sf_plf/2019-03-14-sf-plf-14-record-sub/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/read_sf_plf/2019-03-14-sf-plf-14-record-sub/" class="post-title-link" itemprop="url">「SF-PLF」14 RecordSub</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Inductive</span> ty : <span class="keyword">Type</span> :=</span><br><span class="line">  <span class="comment">(* record types *)</span></span><br><span class="line">  | <span class="type">RNil</span> : ty</span><br><span class="line">  | <span class="type">RCons</span> : string → ty → ty → ty.</span><br></pre></td></tr></table></figure>

<p>we need typecon to identify record…</p>
<pre><code class="coq">Inductive tm : Type :=
  | rproj ...?  isn&#39;t it as well?
  (* record terms *)
  | rnil : tm
  | rcons : string → tm → tm → tm.
``

as a list...


for Record, can compiler reorder the fields? (SML and OCaml)




</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/read_sf_plf/2019-03-17-sf-plf-17-use-tactics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/read_sf_plf/2019-03-17-sf-plf-17-use-tactics/" class="post-title-link" itemprop="url">「SF-PLF」17 UseTactics</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">From</span> PLF <span class="keyword">Require</span> <span class="keyword">Import</span> LibTactics.</span><br></pre></td></tr></table></figure>

<p><code>LibTactics</code>  vs. <code>SSReflect</code> (another tactics package)</p>
<ul>
<li>for PL      vs. for math</li>
<li>traditional vs. rethinks..so harder</li>
</ul>
<h2 id="Tactics-for-Naming-and-Performing-Inversion"><a href="#Tactics-for-Naming-and-Performing-Inversion" class="headerlink" title="Tactics for Naming and Performing Inversion"></a>Tactics for Naming and Performing Inversion</h2><h3 id="introv"><a href="#introv" class="headerlink" title="introv"></a><code>introv</code></h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Theorem</span> ceval_deterministic: ∀c st st1 st2,</span><br><span class="line">  st =[ c ]⇒ st1 →</span><br><span class="line">  st =[ c ]⇒ st2 →</span><br><span class="line">  st1 = st2.</span><br><span class="line"><span class="built_in">intros</span> c st st1 st2 E1 E2. <span class="comment">(* 以往如果想给 Hypo 命名必须说全 *)</span></span><br><span class="line">introv E1 E2.              <span class="comment">(* 现在可以忽略 forall 的部分 *)</span></span><br></pre></td></tr></table></figure>

<h3 id="inverts"><a href="#inverts" class="headerlink" title="inverts"></a><code>inverts</code></h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(* was... 需要 subst, clear *)</span></span><br><span class="line">- <span class="built_in">inversion</span> H. <span class="built_in">subst</span>. <span class="built_in">inversion</span> H2. <span class="built_in">subst</span>. </span><br><span class="line"><span class="comment">(* now... *)</span></span><br><span class="line">- inverts H. inverts H2. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">(* 可以把 invert 出来的东西放在 goal 的位置让你自己用 intro 命名！*)</span></span><br><span class="line">inverts E2 <span class="built_in">as</span>.</span><br></pre></td></tr></table></figure>







<h2 id="Tactics-for-N-ary-Connectives"><a href="#Tactics-for-N-ary-Connectives" class="headerlink" title="Tactics for N-ary Connectives"></a>Tactics for N-ary Connectives</h2><blockquote>
<p>Because Coq encodes conjunctions and disjunctions using binary constructors ∧ and ∨…<br>to work with a <code>N</code>-ary logical connectives…</p>
</blockquote>
<h3 id="splits"><a href="#splits" class="headerlink" title="splits"></a><code>splits</code></h3><blockquote>
<p>n-ary conjunction</p>
</blockquote>
<p>n-ary <code>split</code></p>
<h3 id="branch"><a href="#branch" class="headerlink" title="branch"></a><code>branch</code></h3><blockquote>
<p>n-ary disjunction</p>
</blockquote>
<p>faster <code>destruct</code>?</p>
<h2 id="Tactics-for-Working-with-Equality"><a href="#Tactics-for-Working-with-Equality" class="headerlink" title="Tactics for Working with Equality"></a>Tactics for Working with Equality</h2><h3 id="asserts-rewrite-and-cuts-rewrite"><a href="#asserts-rewrite-and-cuts-rewrite" class="headerlink" title="asserts_rewrite and cuts_rewrite"></a><code>asserts_rewrite</code> and <code>cuts_rewrite</code></h3><h3 id="substs"><a href="#substs" class="headerlink" title="substs"></a><code>substs</code></h3><p>better <code>subst</code> - not fail on circular eq</p>
<h3 id="fequals"><a href="#fequals" class="headerlink" title="fequals"></a><code>fequals</code></h3><p>vs <code>f_equal</code>?</p>
<h3 id="applys-eq"><a href="#applys-eq" class="headerlink" title="applys_eq"></a><code>applys_eq</code></h3><p>variant of <code>eapply</code> </p>
<h2 id="Some-Convenient-Shorthands"><a href="#Some-Convenient-Shorthands" class="headerlink" title="Some Convenient Shorthands"></a>Some Convenient Shorthands</h2><h3 id="unfolds"><a href="#unfolds" class="headerlink" title="unfolds"></a><code>unfolds</code></h3><p>better <code>unfold</code></p>
<h3 id="false-and-tryfalse"><a href="#false-and-tryfalse" class="headerlink" title="false and tryfalse"></a><code>false</code> and <code>tryfalse</code></h3><p>better <code>exfalso</code></p>
<h3 id="gen"><a href="#gen" class="headerlink" title="gen"></a><code>gen</code></h3><p>shorthand for <code>generalize dependent</code>, multiple arg.</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">(* old *)</span></span><br><span class="line"><span class="built_in">intros</span> Gamma x U v t S Htypt Htypv.</span><br><span class="line"><span class="built_in">generalize</span> <span class="built_in">dependent</span> S. <span class="built_in">generalize</span> <span class="built_in">dependent</span> Gamma.</span><br><span class="line"> </span><br><span class="line"><span class="comment">(* new...so nice!!! *)</span></span><br><span class="line">introv Htypt Htypv. gen S Gamma.</span><br></pre></td></tr></table></figure>


<h3 id="admits-admit-rewrite-and-admit-goal"><a href="#admits-admit-rewrite-and-admit-goal" class="headerlink" title="admits, admit_rewrite and admit_goal"></a><code>admits</code>, <code>admit_rewrite</code> and <code>admit_goal</code></h3><p>wrappers around <code>admit</code></p>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a><code>sort</code></h3><blockquote>
<p>proof context more readable </p>
</blockquote>
<p>vars       -&gt; top<br>hypotheses -&gt; bottom</p>
<h2 id="Tactics-for-Advanced-Lemma-Instantiation"><a href="#Tactics-for-Advanced-Lemma-Instantiation" class="headerlink" title="Tactics for Advanced Lemma Instantiation"></a>Tactics for Advanced Lemma Instantiation</h2><h3 id="Working-on-lets"><a href="#Working-on-lets" class="headerlink" title="Working on lets"></a>Working on <code>lets</code></h3><h3 id="Working-on-applys-forwards-and-specializes"><a href="#Working-on-applys-forwards-and-specializes" class="headerlink" title="Working on applys, forwards and specializes"></a>Working on <code>applys</code>, <code>forwards</code> and <code>specializes</code></h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/read_sf_plf/2019-03-18-sf-plf-18-use-auto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/read_sf_plf/2019-03-18-sf-plf-18-use-auto/" class="post-title-link" itemprop="url">「SF-PLF」18 UseAuto</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Basic-Features-of-Proof-Search"><a href="#Basic-Features-of-Proof-Search" class="headerlink" title="Basic Features of Proof Search"></a>Basic Features of Proof Search</h2><h3 id="Strength-of-Proof-Search"><a href="#Strength-of-Proof-Search" class="headerlink" title="Strength of Proof Search"></a>Strength of Proof Search</h3><blockquote>
<p>four proof-search tactics: <code>auto</code>, <code>eauto</code>, <code>iauto</code> and <code>jauto</code>.</p>
</blockquote>
<hr>
<h2 id="How-Proof-Search-Works"><a href="#How-Proof-Search-Works" class="headerlink" title="How Proof Search Works"></a>How Proof Search Works</h2><h3 id="Search-Depth"><a href="#Search-Depth" class="headerlink" title="Search Depth"></a>Search Depth</h3><h3 id="Backtracking"><a href="#Backtracking" class="headerlink" title="Backtracking"></a>Backtracking</h3><h3 id="Adding-Hints"><a href="#Adding-Hints" class="headerlink" title="Adding Hints"></a>Adding Hints</h3><h3 id="Integration-of-Automation-in-Tactics"><a href="#Integration-of-Automation-in-Tactics" class="headerlink" title="Integration of Automation in Tactics"></a>Integration of Automation in Tactics</h3><hr>
<h2 id="Example-Proofs"><a href="#Example-Proofs" class="headerlink" title="Example Proofs"></a>Example Proofs</h2><hr>
<h2 id="Advanced-Topics-in-Proof-Search"><a href="#Advanced-Topics-in-Proof-Search" class="headerlink" title="Advanced Topics in Proof Search"></a>Advanced Topics in Proof Search</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><hr>
<h2 id="Decision-Procedures"><a href="#Decision-Procedures" class="headerlink" title="Decision Procedures"></a>Decision Procedures</h2><h3 id="Omega"><a href="#Omega" class="headerlink" title="Omega"></a>Omega</h3><h3 id="Ring"><a href="#Ring" class="headerlink" title="Ring"></a>Ring</h3><h3 id="Congurence"><a href="#Congurence" class="headerlink" title="Congurence"></a>Congurence</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/data_rep/2020-06-19-data-rep-int/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/data_rep/2020-06-19-data-rep-int/" class="post-title-link" itemprop="url">Data Representation - Integer</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Integers, or <em>whole number</em> from elemental mathematics, are the most common and<br>fundamental numbers used in the computers. It’s represented as<br><em>fixed-point numbers</em>, contrast to <em>floating-point numbers</em> in the machine.<br>Today we are going to learn a whole bunch of way to encode it.</p>
<p>There are mainly two properties to make a integer representation different:</p>
<ol>
<li><p><strong>Size, of the number of bits used</strong>.<br>usually the power of 2. e.g. 8-bit, 16-bit, 32-bit, 64-bit.</p>
</li>
<li><p><strong>Signed or unsigned</strong>.<br>there are also multiple schemas to encode a signed integers.</p>
</li>
</ol>
<p>We are also gonna use the below terminologies throughout the post:</p>
<ul>
<li><em>MSB</em>: Most Significant Bit</li>
<li><em>LSB</em>: Least Significant Bit</li>
</ul>
<h2 id="Prerequisite-printf-Recap"><a href="#Prerequisite-printf-Recap" class="headerlink" title="Prerequisite - printf Recap"></a>Prerequisite - <code>printf</code> Recap</h2><p>We will quickly recap the integers subset of usages of <code>printf</code>.<br>Basically, we used <em>format specifier</em> to interpolate values into strings:</p>
<h3 id="Format-Specifier"><a href="#Format-Specifier" class="headerlink" title="Format Specifier"></a><a target="_blank" rel="noopener" href="http://www.cplusplus.com/reference/cstdio/printf/">Format Specifier</a></h3><blockquote>
<p><code>%[flags][width][.precision][length]specifier</code></p>
</blockquote>
<ul>
<li><code>specifier</code><ul>
<li><code>d</code>, <code>i</code> : signed decimal</li>
<li><code>u</code> : unsigned decimal</li>
<li><code>c</code> : char</li>
<li><code>p</code>: pointer addr</li>
<li><code>x</code> &#x2F; <code>X</code> : lower&#x2F;upper unsigned hex</li>
</ul>
</li>
<li><code>length</code><ul>
<li><code>l</code> : long (at least 32)</li>
<li><code>ll</code> : long long (at least 64)</li>
<li><code>h</code> : short (usually 16)</li>
<li><code>hh</code> : short short (usually 8)</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Size of int = &quot;</span>&lt;&lt; <span class="built_in">sizeof</span>(<span class="type">int</span>) &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Size of long = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">long</span>) &lt;&lt; endl;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Size of long long = &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">long</span> <span class="type">long</span>);</span><br><span class="line">&#125;</span><br><span class="line">Output in <span class="number">32</span> bit gcc compiler: <span class="number">4</span> <span class="number">4</span> <span class="number">8</span></span><br><span class="line">Output in <span class="number">64</span> bit gcc compiler: <span class="number">4</span> <span class="number">8</span> <span class="number">8</span></span><br></pre></td></tr></table></figure>

<h3 id="inttypes-h-from-C99"><a href="#inttypes-h-from-C99" class="headerlink" title="inttypes.h from C99"></a><a target="_blank" rel="noopener" href="http://www.qnx.com/developers/docs/6.5.0/index.jsp?topic=/com.qnx.doc.dinkum_en_c99/inttypes.html"><code>inttypes.h</code> from C99</a></h3><p>Also in <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/c/types/integer">cppreference.com</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// signed int (d or i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRId8     <span class="string">&quot;hhd&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRId16    <span class="string">&quot;hd&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRId32    <span class="string">&quot;ld&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRId64    <span class="string">&quot;lld&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// unsigned int (u)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIu8     <span class="string">&quot;hhd&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIu16    <span class="string">&quot;hd&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIu32    <span class="string">&quot;ld&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIu64    <span class="string">&quot;lld&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// unsigned hex</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIx8     <span class="string">&quot;hhu&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIx16    <span class="string">&quot;hu&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIx32    <span class="string">&quot;lu&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIx64    <span class="string">&quot;llu&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uintptr_t (64 bit machine word len)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRIxPTR   <span class="string">&quot;llx&quot;</span></span></span><br></pre></td></tr></table></figure>


<h2 id="Unsigned-Integers"><a href="#Unsigned-Integers" class="headerlink" title="Unsigned Integers"></a>Unsigned Integers</h2><p>The conversion between unsigned integers and binaries are trivial.<br>Here, we can represent 8 bits (i.e. a <em>byte</em>) as a <em>hex pair</em>, e.g.<br><code>255 == 0xff == 0b11111111</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span>    <span class="comment">// uintN_t</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;inttypes.h&gt;</span>  <span class="comment">// PRI macros</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> u8 = <span class="number">255</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;0x%02&quot;</span> PRIx8 <span class="string">&quot;\n&quot;</span>, u8); <span class="comment">// 0xff</span></span><br><span class="line"><span class="built_in">printf</span>(  <span class="string">&quot;%&quot;</span>   PRId8 <span class="string">&quot;\n&quot;</span>, u8); <span class="comment">// 255</span></span><br></pre></td></tr></table></figure>


<h2 id="Signed-Integers"><a href="#Signed-Integers" class="headerlink" title="Signed Integers"></a>Signed Integers</h2><p>Signed integers are more complicated. We need to cut those bits to halves<br>to represent both positive and negative integers somehow.</p>
<p>There are four well-known schemas to encode it, according to<br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Signed_number_representations">signed number representation of wikipedia</a>.</p>
<h3 id="Sign-magnitude-原码"><a href="#Sign-magnitude-原码" class="headerlink" title="Sign magnitude 原码"></a>Sign magnitude 原码</h3><p>It’s also called <em>“sign and magnitude”</em>. From the name we can see how straightforward it is:<br>it’s basically put one bit (often the <em>MSB</em>) as the <em>sign bit</em> to represent <em>sign</em> and the remaining bits indicating<br>the magnitude (or absolute value), e.g.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  binary   | sign-magn |  <span class="type">unsigned</span></span><br><span class="line">-----------|-----------|------------</span><br><span class="line"><span class="number">0</span> <span class="number">000</span> <span class="number">0000</span> |    +<span class="number">0</span>     |     <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">111</span> <span class="number">1111</span> |    <span class="number">127</span>    |    <span class="number">127</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> <span class="number">000</span> <span class="number">0000</span> |    <span class="number">-0</span>     |    <span class="number">128</span></span><br><span class="line"><span class="number">1</span> <span class="number">111</span> <span class="number">1111</span> |   <span class="number">-127</span>    |    <span class="number">255</span></span><br></pre></td></tr></table></figure>

<p>It was used in early computer (IBM 7090) and now mainly used in the<br><em>significand</em> part in floating-point number</p>
<p>Pros:</p>
<ul>
<li>simple and nature for human</li>
</ul>
<p>Cons:</p>
<ul>
<li>2 way to represent zeros (<code>+0</code> and <code>-0</code>)</li>
<li>not as good for machine<ul>
<li>add&#x2F;sub&#x2F;cmp require knowing the sign<ul>
<li>complicate CPU ALU design; potentially more cycles</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Ones’-complement-反码"><a href="#Ones’-complement-反码" class="headerlink" title="Ones’ complement 反码"></a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ones%27_complement">Ones’ complement</a> 反码</h3><p>It form a negative integers by applying a <em>bitwise NOT</em><br>i.e. <em>complement</em> of its positive counterparts.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  binary   |  <span class="number">1</span>s comp  |  <span class="type">unsigned</span></span><br><span class="line">-----------|-----------|------------</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span>  |     <span class="number">0</span>     |     <span class="number">0</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0001</span>  |     <span class="number">1</span>     |     <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="number">0111</span> <span class="number">1111</span>  |    <span class="number">127</span>    |    <span class="number">127</span></span><br><span class="line"><span class="number">1000</span> <span class="number">0000</span>  |   <span class="number">-127</span>    |    <span class="number">128</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1111</span> <span class="number">1110</span>  |    <span class="number">-1</span>     |    <span class="number">254</span></span><br><span class="line"><span class="number">1111</span> <span class="number">1111</span>  |    <span class="number">-0</span>     |    <span class="number">255</span></span><br></pre></td></tr></table></figure>

<p>N.B. <em>MSB</em> can still be signified by MSB.</p>
<p>It’s referred to as <em>ones’</em> complement because the negative can be formed<br>by subtracting the positive <strong>from</strong> <em>ones</em>: <code>1111 1111 (-0)</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">1111</span> <span class="number">1111</span>       <span class="number">-0</span></span><br><span class="line">- <span class="number">0111</span> <span class="number">1111</span>       <span class="number">127</span></span><br><span class="line">---------------------</span><br><span class="line">  <span class="number">1000</span> <span class="number">0000</span>      <span class="number">-127</span></span><br></pre></td></tr></table></figure>

<p>The benefits of the complement nature is that adding becomes simple,<br>except we need to do an <em>end-around carry</em> to add resulting carry<br>back to get the correct result.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">0111</span> <span class="number">1111</span>       <span class="number">127</span></span><br><span class="line">+ <span class="number">1000</span> <span class="number">0001</span>      <span class="number">-126</span></span><br><span class="line">---------------------</span><br><span class="line"><span class="number">1</span> <span class="number">0000</span> <span class="number">0000</span>        <span class="number">0</span></span><br><span class="line">          <span class="number">1</span>       +<span class="number">1</span>     &lt;- add carry <span class="string">&quot;1&quot;</span> back</span><br><span class="line">---------------------</span><br><span class="line">  <span class="number">0000</span> <span class="number">0001</span>        <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Pros:</p>
<ul>
<li>Arithmetics on machien are fast.</li>
</ul>
<p>Cons:</p>
<ul>
<li>still 2 zeros!</li>
</ul>
<h3 id="Twos’-complement-补码"><a href="#Twos’-complement-补码" class="headerlink" title="Twos’ complement 补码"></a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Two%27s_complement">Twos’ complement</a> 补码</h3><p>Most of the current architecture adopted this, including x86, MIPS, ARM, etc.<br>It differed with one’s complement by one.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  binary   |  <span class="number">2</span>s comp  |  <span class="type">unsigned</span></span><br><span class="line">-----------|-----------|------------</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span>  |     <span class="number">0</span>     |     <span class="number">0</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0001</span>  |     <span class="number">1</span>     |     <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="number">0111</span> <span class="number">1111</span>  |    <span class="number">127</span>    |    <span class="number">127</span></span><br><span class="line"><span class="number">1000</span> <span class="number">0000</span>  |   <span class="number">-128</span>    |    <span class="number">128</span></span><br><span class="line"><span class="number">1000</span> <span class="number">0001</span>  |   <span class="number">-127</span>    |    <span class="number">129</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1111</span> <span class="number">1110</span>  |    <span class="number">-2</span>     |    <span class="number">254</span></span><br><span class="line"><span class="number">1111</span> <span class="number">1111</span>  |    <span class="number">-1</span>     |    <span class="number">255</span></span><br></pre></td></tr></table></figure>

<p>N.B. <em>MSB</em> can still be signified by MSB.</p>
<p>It’s referred to as <em>twos’</em> complement because the negative can be formed<br>by subtracting the positive <strong>from</strong> <code>2 ** N</code> (congruent to <code>0000 0000 (+0)</code>),<br>where <code>N</code> is the number of bits.</p>
<p>E.g., for a <code>uint8_t</code>, the <em>sum</em> of any number and it’s twos’ complement would<br>be <code>256 (1 0000 0000)</code>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">0000</span> <span class="number">0000</span>       <span class="number">256</span>  = <span class="number">2</span> ** <span class="number">8</span></span><br><span class="line">- <span class="number">0111</span> <span class="number">1111</span>       <span class="number">127</span></span><br><span class="line">---------------------</span><br><span class="line">  <span class="number">1000</span> <span class="number">0001</span>      <span class="number">-127</span></span><br></pre></td></tr></table></figure>

<p>Becuase of this, arithmetics becomes really easier, for any number <code>x</code> e.g. <code>127</code><br>we can get its twos’ complement by:</p>
<ol>
<li><code>~x =&gt; 1000 0000</code> bitwise NOT (like ones’ complement)</li>
<li><code>+1 =&gt; 1000 0001</code> add 1 (the one differed from ones’ complement)</li>
</ol>
<p>Cons:</p>
<ul>
<li>bad named?</li>
</ul>
<p>Pros:</p>
<ul>
<li>fast machine arithmatics.</li>
<li>only 1 zeros!</li>
<li>the minimal negative is <code>-128</code></li>
</ul>
<h3 id="Offset-binary-移码"><a href="#Offset-binary-移码" class="headerlink" title="Offset binary 移码"></a><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Offset_binary">Offset binary</a> 移码</h3><p>It’s also called <em>excess-K</em> (偏移 K) or <em>biased representation</em>, where <code>K</code> is<br>the <em>biasing value</em> (the new <code>0</code>), e.g. in <em>excess-128</em>:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  binary   |  K = <span class="number">128</span>  |  <span class="type">unsigned</span></span><br><span class="line">-----------|-----------|------------</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span>  |   <span class="number">-128</span>(-K)|     <span class="number">0</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0001</span>  |   <span class="number">-127</span>    |     <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="number">0111</span> <span class="number">1111</span>  |    <span class="number">-1</span>     |    <span class="number">127</span></span><br><span class="line"><span class="number">1000</span> <span class="number">0000</span>  |     <span class="number">0</span>     |    <span class="number">128</span>  (K)</span><br><span class="line"><span class="number">1000</span> <span class="number">0001</span>  |     <span class="number">1</span>     |    <span class="number">129</span></span><br><span class="line">...</span><br><span class="line"><span class="number">1111</span> <span class="number">1111</span>  |    <span class="number">127</span>    |    <span class="number">255</span></span><br></pre></td></tr></table></figure>

<p>It’s now mainly used for the <em>exponent</em> part of floating-point number.</p>
<h2 id="Type-Conversion-Printf"><a href="#Type-Conversion-Printf" class="headerlink" title="Type Conversion &amp; Printf"></a>Type Conversion &amp; <code>Printf</code></h2><p>This might be a little bit off topic, but I want to note down what I observed<br>from experimenting. Basically, <code>printf</code> would not perform an implicit type<br>conversion but merely <em>interpret</em> the bits arrangement of your arguments as you<br>told it.</p>
<ul>
<li><em>UB!</em> stands for <em>undefined behaviors</em></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint8_t</span> u8 = <span class="number">0b10000000</span>; <span class="comment">// 128</span></span><br><span class="line"> <span class="type">int8_t</span> s8 = <span class="number">0b10000000</span>; <span class="comment">// -128</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRIu8 <span class="string">&quot;\n&quot;</span>, u8);          <span class="comment">// 128</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRId8 <span class="string">&quot;\n&quot;</span>, u8);          <span class="comment">// 128 (UB! but somehow it&#x27;s got right)</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRId8 <span class="string">&quot;\n&quot;</span>, (<span class="type">int8_t</span>)u8);  <span class="comment">// -128</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRId8 <span class="string">&quot;\n&quot;</span>, s8);          <span class="comment">// -128</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRIu8 <span class="string">&quot;\n&quot;</span>, s8);          <span class="comment">// 4294967168 (UB!)</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRId8 <span class="string">&quot;\n&quot;</span>, (<span class="type">uint8_t</span>)s8); <span class="comment">// 128</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRIxPTR <span class="string">&quot;\n&quot;</span>, s8);             <span class="comment">// ffffff80</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%&quot;</span>PRIxPTR <span class="string">&quot;\n&quot;</span>, (<span class="type">uintptr_t</span>)s8);  <span class="comment">// ffffffffffffff80</span></span><br></pre></td></tr></table></figure>


<h2 id="Char-ASCII"><a href="#Char-ASCII" class="headerlink" title="Char &amp; ASCII"></a>Char &amp; <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/ASCII">ASCII</a></h2><p>Traditionally, <code>char</code> is represented in the computer as 8 bits as well. And<br>really, ASCII is only defined between <code>0</code> and <code>127</code> and require 7 bits.<br>(8-bit Extended ASCII is not quite well popularized and supported.)</p>
<p>It’s more complicated in extension such as <em>Unicode</em> nowadays, but we’ll ignore<br>it for future posts dedicated for char and string representation.</p>
<p>So how is a <code>char</code> different with a <em>byte</em>?</p>
<p>Well, the answer is whether a <code>char</code> is a <code>signed char</code> (backed by <code>int8_t</code>)<br>or a <code>unsigned char</code> (backed by <code>uint8_t</code>) is… <em>implementaton-defined</em>.<br>And most systems made it <em>signed</em> since most types (e.g. <code>int</code>) were signed<br>by default.</p>
<p>N.B. <code>int</code> is standard-defined to be equivalent to <code>signed int</code>. This is<br>not the case of <code>char</code>.</p>
<p>That’s why you often see such <code>typedef</code> such as:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> Byte_t;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint8_t</span> <span class="type">byte_t</span>;</span><br></pre></td></tr></table></figure>

<p>to emphysize the nature of byte should be just plain, unsigned, bits.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Integer_(computer_science)">https://en.wikipedia.org/wiki/Integer_(computer_science)</a></li>
<li><a target="_blank" rel="noopener" href="https://www3.ntu.edu.sg/home/ehchua/programming/java/datarepresentation.html">https://www3.ntu.edu.sg/home/ehchua/programming/java/datarepresentation.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/data_rep/2020-06-21-data-rep-float/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/data_rep/2020-06-21-data-rep-float/" class="post-title-link" itemprop="url">Data Representation - Floating Point Numbers</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In the last episode we talked about the data representation of integer, a kind<br>of fixed-point numbers. Today we’re going to learn about floating-point numbers.</p>
<p>Floating-point numbers are used to <em>approximate</em> real numbers. Because of the<br>fact that all the stuffs in computers are, eventually, just a limited sequence<br>of bits. The representation of floating-point number had to made trade-offs<br>between <em>ranges</em> and <em>precision</em>.</p>
<p>Due to its computational complexities, CPU also have a dedicated set of<br>instructions to accelerate on floating-point arithmetics.</p>
<h2 id="Terminologies"><a href="#Terminologies" class="headerlink" title="Terminologies"></a>Terminologies</h2><p>The terminologies of floating-point number is coming from the<br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Scientific_notation"><em>scientific notation</em></a>,<br>where a real number can be represented as such:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.2345 = 12345 × 10 ** -4</span><br><span class="line">         -----   --    --</span><br><span class="line">  significand^   ^base  ^exponent</span><br></pre></td></tr></table></figure>

<ul>
<li><em>significand</em>, or <em>mantissa</em>, 有效数字, 尾数</li>
<li><em>base</em>, or <em>radix</em> 底数</li>
<li><em>exponent</em>, 幂</li>
</ul>
<p>So where is the <em>floating point</em>? It’s the <code>.</code> of <code>1.2345</code>. Imaging the dot<br>can be float to the left by one to make the representation <code>.12345</code>.</p>
<p>The dot is called <em>radix point</em>, because to us it’s seem to be a <em>decimal point</em>,<br>but it’s really a <em>binary point</em> in the computers.</p>
<p>Now it becomes clear that, to represent a floating-point number in computers,<br>we will simply assign some bits for <em>significand</em> and some for <em>exponent</em>, and<br>potentially a bit for <em>sign</em> and that’s it.</p>
<h2 id="IEEE-754-32-bits-Single-Precision-Floats-单精度浮点数"><a href="#IEEE-754-32-bits-Single-Precision-Floats-单精度浮点数" class="headerlink" title="IEEE-754 32-bits Single-Precision Floats 单精度浮点数"></a>IEEE-754 32-bits Single-Precision Floats 单精度浮点数</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">https://en.wikipedia.org/wiki/Single-precision_floating-point_format</a></li>
</ul>
<p>It was called <strong>single</strong> back to IEEE-754-1985 and now <strong>binary32</strong> in the<br>relatively new IEEE-754-2008 standard.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">       (<span class="number">8</span> bits)             (<span class="number">23</span> bits)</span><br><span class="line">sign   exponent             fraction</span><br><span class="line">  <span class="number">0</span>   <span class="number">011</span> <span class="number">1111</span> <span class="number">1</span>    <span class="number">000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line"> <span class="number">31</span>   <span class="number">30</span> .... <span class="number">23</span>    <span class="number">22</span> ....................... <span class="number">0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>The <em>sign</em> part took 1 bit to indicate the sign of the floats. (<code>0</code> for <code>+</code><br>and <code>1</code> for <code>-</code>. This is the same treatment as the <a href="2020-06-19-data-rep-int.md##sign-magnitude-%E5%8E%9F%E7%A0%81">sign magnitute</a>.</li>
<li>The <em>exponent</em> part took 8 bits and used <a href="2020-06-19-data-rep-int.md#offset-binary-%E7%A7%BB%E7%A0%81"><em>offset-binary (biased) form</em></a> to represent a signed integer.<br>It’s a variant form since it took out the <code>-127</code> (all 0s) for zero and <code>+128</code><br>(all 1s) for non-numbers, thus it ranges only <code>[-126, 127]</code> instead of<br><code>[-127, 128]</code>. Then, it choose the zero offset of <code>127</code> in these 254 bits (like<br>using <code>128</code> in <em>excess-128</em>), a.k.a the <em>exponent bias</em> in the standard.</li>
<li>The <em>fraction</em> part took 23 bits with an <em>implicit leading bit</em> <code>1</code> and<br>represent the actual <em>significand</em> in total precision of 24-bits.</li>
</ul>
<p>Don’t be confused by why it’s called <em>fraction</em> instead of <em>significand</em>!<br>It’s all because that the 23 bits in the representation is indeed, representing<br>the fraction part of the real significand in the scientific notation.</p>
<p>The floating-point version of “scientific notation” is more like:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(leading <span class="number">1</span>)</span><br><span class="line">   <span class="number">1.</span> fraction  ×  <span class="number">2</span> ^ exponent   ×  <span class="built_in">sign</span></span><br><span class="line">      (base<span class="number">-2</span>)           (base<span class="number">-2</span>)</span><br></pre></td></tr></table></figure>

<p>So what number does the above bits represent?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S     F   ×  E  =  R</span><br><span class="line">+  <span class="number">1.</span>(<span class="number">0</span>)  ×  <span class="number">0</span>  =  <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Aha! It’s the real number <code>1</code>!<br>Recall that the <code>E = 0b0111 1111 = 0</code> because it used a biased representation!</p>
<p>We will add more non-trivial examples later.</p>
<h2 id="Demoing-Floats-in-C-C"><a href="#Demoing-Floats-in-C-C" class="headerlink" title="Demoing Floats in C&#x2F;C++"></a>Demoing Floats in C&#x2F;C++</h2><p>Writing sample code converting between binaries (in hex) and floats are not<br>as straightforward as it for integers. Luckily, there are still some hacks to<br>perform it:</p>
<h3 id="C-Unsafe-Cast"><a href="#C-Unsafe-Cast" class="headerlink" title="C - Unsafe Cast"></a>C - Unsafe Cast</h3><p>We unsafely cast a pointer to enable reinterpretation of the same binaries.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> f1 = <span class="number">0x3f800000</span>; <span class="comment">// C doesn&#x27;t have a floating literal taking hex.</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%f \n&quot;</span>, f1);   <span class="comment">// 1065353216.000000 (???)</span></span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> u2 = <span class="number">0x3f800000</span>;</span><br><span class="line"><span class="type">float</span>* f2 = (<span class="type">float</span>*)&amp;u2;   <span class="comment">// unsafe cast</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%f \n&quot;</span>, *f2);      <span class="comment">// 1.000000</span></span><br></pre></td></tr></table></figure>

<h3 id="C-Union-Trick"><a href="#C-Union-Trick" class="headerlink" title="C - Union Trick"></a>C - Union Trick</h3><p>Oh I really enjoyed this one…Union in C is not only untagged union, but also<br>share the exact same chunk of memory. So we are doing the same reinterpretation,<br>but in a more structural and technically fancier way.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">float</span> pi = (<span class="type">float</span>)M_PI;</span><br><span class="line"><span class="keyword">union</span> &#123;</span><br><span class="line">    <span class="type">float</span> f;</span><br><span class="line">    <span class="type">uint32_t</span> u;</span><br><span class="line">&#125; f2u = &#123; .f = pi &#125;;  <span class="comment">// we took the data as float</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;pi : %f\n   : 0x%&quot;</span> PRIx32 <span class="string">&quot;\n&quot;</span>, pi, f2u.u);  <span class="comment">// but interpret as uint32_t</span></span><br><span class="line">pi : <span class="number">3.141593</span></span><br><span class="line">   : <span class="number">0x40490fdb</span></span><br></pre></td></tr></table></figure>

<p>N.B. this trick is well-known as <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Type_punning">type punning</a>:</p>
<blockquote>
<p>In computer science, type punning is a common term for any programming technique that subverts or circumvents the type system of a programming language in order to achieve an effect that would be difficult or impossible to achieve within the bounds of the formal language.</p>
</blockquote>
<h3 id="C-reinterpret-cast"><a href="#C-reinterpret-cast" class="headerlink" title="C++ - reinterpret_cast"></a>C++ - <code>reinterpret_cast</code></h3><p>C++ does provide such type punning to the standard language:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> u = <span class="number">0x40490fdb</span>;</span><br><span class="line"><span class="type">float</span> a = *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">float</span>*&gt;(&amp;u);</span><br><span class="line">std::cout &lt;&lt; a;  <span class="comment">// 3.14159</span></span><br></pre></td></tr></table></figure>

<p>N.B. it still need to be a conversion between pointers,<br>see <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/reinterpret_cast">https://en.cppreference.com/w/cpp/language/reinterpret_cast</a>.</p>
<p>Besides, C++ 17 does add a floating point literal that can take hex, but it<br>works in a different way, using an explicit radix point in the hex:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> f = <span class="number">0x1</span><span class="number">.2</span>p3;  <span class="comment">// 1.2 by 2^3</span></span><br><span class="line">std::cout &lt;&lt; f;     <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>

<p>That’s try with another direction:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">double</span> qNan = std::numeric_limits&lt;<span class="type">double</span>&gt;::<span class="built_in">quiet_NaN</span>();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;0x%&quot;</span> PRIx64 <span class="string">&quot;\n&quot;</span>, *<span class="built_in">reinterpret_cast</span>&lt;<span class="type">uint64_t</span>*&gt;(&amp;qNan));</span><br><span class="line">  <span class="comment">// 0x7ff8000000000000, the canonical qNaN!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Representation-of-Non-Numbers"><a href="#Representation-of-Non-Numbers" class="headerlink" title="Representation of Non-Numbers"></a>Representation of Non-Numbers</h2><p>There are more in the IEEE-754!</p>
<p>Real numbers doesn’t satisfy <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Closure_(mathematics)">closure property</a><br>as integers does. Notably, the set of real numbers is NOT closed under the<br>division! It could produce non-number results such as <strong>infinity</strong> (e.g. <code>1/0</code>)<br>and <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/NaN"><strong>NaN (Not-a-Number)</strong></a> (e.g. taking<br>a square root of a negative number).</p>
<p>It would be algebraically ideal if the set of floating-point numbers can be<br>closed under all floating-point arithmetics. That would made many people’s life<br>easier. So the IEEE made it so! Non-numeber values are squeezed in.</p>
<p>We will also include the two zeros (<code>+0</code>&#x2F;<code>-0</code>) into the comparison here,<br>since they are also special by being the only two demanding an <code>0x00</code> exponent:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">             binary                |    hex    |</span><br><span class="line">--------------------------------------------------------</span><br><span class="line"><span class="number">0</span> <span class="number">00000000</span> <span class="number">00000000000000000000000</span> = <span class="number">0000</span> <span class="number">0000</span> = +<span class="number">0</span></span><br><span class="line"><span class="number">1</span> <span class="number">00000000</span> <span class="number">00000000000000000000000</span> = <span class="number">8000</span> <span class="number">0000</span> = −<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="number">11111111</span> <span class="number">00000000000000000000000</span> = <span class="number">7f</span>80 <span class="number">0000</span> = +infinity</span><br><span class="line"><span class="number">1</span> <span class="number">11111111</span> <span class="number">00000000000000000000000</span> = ff80 <span class="number">0000</span> = −infinity</span><br><span class="line"></span><br><span class="line">_ <span class="number">11111111</span> <span class="number">10000000000000000000000</span> = _fc0 <span class="number">0000</span> = <span class="built_in">qNaN</span> (canonical)</span><br><span class="line">_ <span class="number">11111111</span> <span class="number">00000000000000000000001</span> = _f80 <span class="number">0001</span> = <span class="built_in">sNaN</span> (one of them)</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">      (<span class="number">8</span> bits)  (<span class="number">23</span> bits)</span><br><span class="line">sign  exponent  fraction</span><br><span class="line">  <span class="number">0</span>      <span class="number">00</span>     <span class="number">0</span> ..<span class="number">.0</span> <span class="number">0</span>  = +<span class="number">0</span></span><br><span class="line">  <span class="number">1</span>      <span class="number">00</span>     <span class="number">0</span> ..<span class="number">.0</span> <span class="number">0</span>  = <span class="number">-0</span></span><br><span class="line">  <span class="number">0</span>      FF     <span class="number">0</span> ..<span class="number">.0</span> <span class="number">0</span>  = +infinity</span><br><span class="line">  <span class="number">1</span>      FF     <span class="number">0</span> ..<span class="number">.0</span> <span class="number">0</span>  = -infinity</span><br><span class="line">  _      FF     <span class="number">1</span> ..<span class="number">.0</span> <span class="number">0</span>  = <span class="built_in">qNaN</span> (canonical)</span><br><span class="line">  _      FF     <span class="number">0</span> ..<span class="number">.0</span> <span class="number">1</span>  = <span class="built_in">sNaN</span> (one of them)</span><br></pre></td></tr></table></figure>

<p>Encodings of qNaN and sNaN are not specified in IEEE 754 and implemented<br>differently on different processors. Luckily, both x86 and ARM family use the<br>“most significant bit of fraction” to indicate whether it’s quite.</p>
<h3 id="More-on-NaN"><a href="#More-on-NaN" class="headerlink" title="More on NaN"></a>More on NaN</h3><p>If we look carefully into the IEEE 754-2008 spec, in the <em>page35, 6.2.1</em>, it<br>actually defined anything with exponent <code>FF</code> and not a infinity (i.e. with<br>all the fraction bits being <code>0</code>), a NaN!</p>
<blockquote>
<p>All binary NaN bit strings have all the bits of the biased exponent field E set to 1 (see 3.4). A quiet NaN bit string should be encoded with the first bit (d1) of the trailing significand field T being 1. A signaling NaN bit string should be encoded with the first bit of the trailing significand field being 0.</p>
</blockquote>
<p>That implies, we actually had <code>2 ** 24 - 2</code> of NaNs in a 32-bits float!<br>The <code>24</code> came from the <code>1</code> sign bit plus <code>23</code> fractions and the <code>2</code> excluded<br>were the <code>+/- inf</code>.</p>
<p>The continuous 22 bits inside the fraction looks quite a waste, and there<br>would be even 51 bits of them in the <code>double</code>! We will see how to made them useful<br>in later episodes (spoiler: they are known as <em>NaN payload</em>).</p>
<p>It’s also worth noting that it’s weird that the IEEE choose to use the MSB<br>instead of the sign bit for NaN quiteness&#x2F;signalness:</p>
<blockquote>
<p>It seems strange to me that the bit which signifies whether or not the NaN is signaling is the top bit of the mantissa rather than the sign bit; perhaps something about how floating point pipelines are implemented makes it less natural to use the sign bit to decide whether or not to raise a signal.<br>– <a target="_blank" rel="noopener" href="https://anniecherkaev.com/the-secret-life-of-nan">https://anniecherkaev.com/the-secret-life-of-nan</a></p>
</blockquote>
<p>I guess it might be something related to the CPU pipeline? I don’t know yet.</p>
<h3 id="Equality-of-NaNs-and-Zeros"><a href="#Equality-of-NaNs-and-Zeros" class="headerlink" title="Equality of NaNs and Zeros."></a>Equality of NaNs and Zeros.</h3><p>The spec defined a comparison with NaNs to return an <strong>unordered result</strong>, that<br>means any comparison operation except <code>!=</code>, i.e. <code>&gt;=, &lt;=, &gt;, &lt;, =</code> between a<br>NaN and any other floating-point number would return <code>false</code>.</p>
<p>No surprised that most (if not every) language implemented such behaviours, e.g.<br>in JavaScript:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NaN</span> !== <span class="title class_">NaN</span>   <span class="comment">// true</span></span><br><span class="line"><span class="title class_">NaN</span> === <span class="title class_">NaN</span>   <span class="comment">// false</span></span><br><span class="line"><span class="title class_">NaN</span> &gt;  <span class="number">1</span>      <span class="comment">// false</span></span><br><span class="line"><span class="title class_">NaN</span> &lt;  <span class="number">1</span>      <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>Position and negative zeros, however, are defined to be equal!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+<span class="number">0</span> === -<span class="number">0</span>  <span class="comment">// true, using the traditional JS equality</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(+<span class="number">0</span>, -<span class="number">0</span>)  <span class="comment">// false, using the &quot;SameValue&quot; equality</span></span><br></pre></td></tr></table></figure>

<p>In Cpp, we can tell them apart by looking at its sign bit:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span>   <span class="comment">// signbit</span></span></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; (+<span class="number">0.0f</span> == <span class="number">-0.0f</span>);     <span class="comment">// 1</span></span><br><span class="line">cout &lt;&lt; std::<span class="built_in">signbit</span>(<span class="number">-0.0f</span>);  <span class="comment">// 1</span></span><br><span class="line">cout &lt;&lt; std::<span class="built_in">signbit</span>(+<span class="number">0.0f</span>);  <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>




<h2 id="IEEE-754-64-bits-Double-Precision-Floats"><a href="#IEEE-754-64-bits-Double-Precision-Floats" class="headerlink" title="IEEE-754 64-bits Double-Precision Floats"></a>IEEE-754 64-bits Double-Precision Floats</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">https://en.wikipedia.org/wiki/Double-precision_floating-point_format</a></li>
</ul>
<p>Now, the 64-bit versions floating-point number, known as <code>double</code>, is just a<br>matter of scale:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">       (<span class="number">11</span> bits)            (<span class="number">52</span> bits)</span><br><span class="line">sign   exponent             fraction</span><br><span class="line">  <span class="number">0</span></span><br><span class="line"></span><br><span class="line"> <span class="number">63</span>   <span class="number">62</span> .... <span class="number">52</span>    <span class="number">51</span> ....................... <span class="number">0</span></span><br></pre></td></tr></table></figure>


<h2 id="IEEE-754-2008-16-bits-Short-Floats"><a href="#IEEE-754-2008-16-bits-Short-Floats" class="headerlink" title="IEEE-754-2008 16-bits Short Floats"></a>IEEE-754-2008 16-bits Short Floats</h2><p>The 2008 edition of IEEE-754 also standardize the <code>short float</code>, which is<br>neither in C or C++ standard. Though compiler extension might include it.</p>
<p>It looks like:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> sign bit | <span class="number">5</span> exponent bits | <span class="number">10</span> fraction bits</span><br><span class="line">S            E E E E E         M M M M M M M M M M</span><br></pre></td></tr></table></figure>



<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Floating-point_arithmetic">https://en.wikipedia.org/wiki/Floating-point_arithmetic</a></li>
<li><a target="_blank" rel="noopener" href="https://www3.ntu.edu.sg/home/ehchua/programming/java/datarepresentation.html">https://www3.ntu.edu.sg/home/ehchua/programming/java/datarepresentation.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/hidden/2020-05-05-pl-chart/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/hidden/2020-05-05-pl-chart/" class="post-title-link" itemprop="url">My Programming Languages Spectrum</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <iframe 
  id="chart"
  src="https://huangxuan.me/PL-chart/"
  frameborder="0" 
  scrolling="no" 
  style="width: 100%">
</iframe>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/read_sf_lf/2019-01-01-sf-lf-01-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/read_sf_lf/2019-01-01-sf-lf-01-basics/" class="post-title-link" itemprop="url">「SF-LC」1 Basics</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 01:05:07" itemprop="dateCreated datePublished" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>These series of notes combined </p>
<ul>
<li>My notes on reading <em>Software Foundation</em> and (if any) watching on <em>Coq intensive</em>.</li>
<li>Gotchas from my independent studies and discussion within <em>Prof.Fluet</em>‘s class.</li>
</ul>
</blockquote>
<blockquote>
<p>The <code>.v</code> code is a gorgeous example of <em>literal programming</em> and the compiled <code>.html</code> website is full-fledged.<br>So this note is intended to be NOT self-contained and only focus on things I found essential or interesting.</p>
</blockquote>
<blockquote>
<p>This note is intended to be very personal and potentially mix English with Chinese (You can Lol)<br>So yeah. Don’t expect it to be well organized and well written.<br>I posted it on blog mainly for my own references purpose.</p>
</blockquote>
<blockquote>
<p>The quotes could either come from the book or saying from someone (even including me). </p>
</blockquote>
<h2 id="Data-and-Functions"><a href="#Data-and-Functions" class="headerlink" title="Data and Functions"></a>Data and Functions</h2><h3 id="Custom-Notation"><a href="#Custom-Notation" class="headerlink" title="Custom Notation"></a>Custom Notation</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Notation</span> <span class="string">&quot;x &amp;&amp; y&quot;</span> := (andb x y).</span><br><span class="line"><span class="keyword">Notation</span> <span class="string">&quot;x || y&quot;</span> := (orb x y).</span><br></pre></td></tr></table></figure>

<p>can go pretty far with unicode char…</p>
<p>making things <em>infix</em></p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Notation</span> <span class="string">&quot;x + y&quot;</span> := (plus x y)</span><br><span class="line">                      (<span class="built_in">at</span> level <span class="number">50</span>, <span class="built_in">left</span> associativity)</span><br><span class="line">                      : nat_scope.</span><br><span class="line"><span class="keyword">Notation</span> <span class="string">&quot;x - y&quot;</span> := (minus x y)</span><br><span class="line">                      (<span class="built_in">at</span> level <span class="number">50</span>, <span class="built_in">left</span> associativity)</span><br><span class="line">                      : nat_scope.</span><br><span class="line"><span class="keyword">Notation</span> <span class="string">&quot;x * y&quot;</span> := (mult x y)</span><br><span class="line">                      (<span class="built_in">at</span> level <span class="number">40</span>, <span class="built_in">left</span> associativity)</span><br><span class="line">                      : nat_scope.</span><br></pre></td></tr></table></figure>

<p>why <code>40</code> <code>50</code>? Making sure there are still <em>rooms</em> for priority in between…</p>
<blockquote>
<p>no known PL using real number for priority though</p>
</blockquote>
<h3 id="Data-Constructor-with-arguments"><a href="#Data-Constructor-with-arguments" class="headerlink" title="Data Constructor with arguments"></a>Data Constructor with arguments</h3><p>there are 2 ways to define them:</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Inductive</span> color : <span class="keyword">Type</span> :=</span><br><span class="line">  | <span class="type">black</span></span><br><span class="line">  | <span class="type">white</span></span><br><span class="line">  | <span class="type">primary</span> (p : rgb).      <span class="comment">(* ADT, need to name arg, useful in proof *)</span></span><br><span class="line">  | <span class="type">primary</span> : rgb -&gt; color. <span class="comment">(* GADT style, dependent type *)</span></span><br></pre></td></tr></table></figure>



<h3 id="Syntax-for-arguments-having-the-same-type"><a href="#Syntax-for-arguments-having-the-same-type" class="headerlink" title="Syntax for arguments having the same type"></a>Syntax for arguments having the same type</h3><blockquote>
<p>As a notational convenience, if two or more arguments have the same type, they can be written together</p>
</blockquote>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Inductive</span> nybble : <span class="keyword">Type</span> :=</span><br><span class="line">  | <span class="type">bits</span> (b0 b1 b2 b3 : bit).</span><br></pre></td></tr></table></figure>

<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> mult (n m : nat)         : nat := </span><br><span class="line"><span class="keyword">Fixpoint</span> plus (n : nat) (m : nat) : nat := </span><br></pre></td></tr></table></figure>


<h2 id="Fixpoint-and-Structrual-Recursion"><a href="#Fixpoint-and-Structrual-Recursion" class="headerlink" title="Fixpoint and Structrual Recursion"></a><code>Fixpoint</code> and Structrual Recursion</h2><blockquote>
<p>This requirement is a fundamental feature of Coq’s design: In particular, it guarantees that every function that can be defined in Coq will terminate on all inputs.</p>
</blockquote>
<p>However, Coq’s “decreasing analysis” is not very sophisticated. E.g.</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> evenb (n:nat) : bool :=</span><br><span class="line">  <span class="keyword">match</span> n <span class="built_in">with</span></span><br><span class="line">  | <span class="type">O</span>        =&gt; true</span><br><span class="line">  | <span class="type">S</span> O      =&gt; false</span><br><span class="line">  | <span class="type">n</span>        =&gt; evenb (pred (pred n))</span><br><span class="line">  <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>

<p>will result in a error that basically complains <em>“this structure is not shrinking”</em>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Error:</span><br><span class="line">Recursive definition of evenb is ill-formed.</span><br><span class="line"></span><br><span class="line">evenb : nat -&gt; bool</span><br><span class="line">n : nat</span><br><span class="line">n0 : nat</span><br><span class="line">n1 : nat</span><br><span class="line"></span><br><span class="line">Recursive call to evenb has principal argument equal to</span><br><span class="line">&quot;Nat.pred (Nat.pred n)&quot; instead of one of the following variables: &quot;n0&quot; &quot;n1&quot;.</span><br><span class="line"></span><br><span class="line">Recursive definition is:</span><br><span class="line">&quot;fun n : nat =&gt;</span><br><span class="line"> match n with</span><br><span class="line"> | 0 =&gt; true</span><br><span class="line"> | 1 =&gt; false</span><br><span class="line"> | S (S _) =&gt; evenb (Nat.pred (Nat.pred n))</span><br><span class="line"> end&quot;.</span><br></pre></td></tr></table></figure>

<p>N.B. the <code>n0</code> and <code>n1</code> are sub-terms of <code>n</code> where <code>n = S (S _)</code>.</p>
<p>So we have to make the sub-structure explicit to indicate the structure is obviously shrinking:</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Fixpoint</span> evenb (n:nat) : bool :=</span><br><span class="line">  <span class="keyword">match</span> n <span class="built_in">with</span></span><br><span class="line">  | <span class="type">O</span>        =&gt; true</span><br><span class="line">  | <span class="type">S</span> O      =&gt; false</span><br><span class="line">  | <span class="type">S</span> (S n&#x27;) =&gt; evenb n&#x27;</span><br><span class="line">  <span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>

<p>Now Coq will know this <code>Fixpoint</code> is performing a structural recursion over the 1st recursion and it guarantees to be terminated since the structure is decreasing:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">evenb is defined</span><br><span class="line">evenb is recursively defined (decreasing on 1st argument)</span><br></pre></td></tr></table></figure>


<h2 id="Proof-by-Case-Analysis"><a href="#Proof-by-Case-Analysis" class="headerlink" title="Proof by Case Analysis"></a>Proof by Case Analysis</h2><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Theorem</span> plus_1_neq_0_firsttry : ∀n : nat,</span><br><span class="line">  (n + <span class="number">1</span>) =? <span class="number">0</span> = false.</span><br><span class="line"><span class="keyword">Proof</span>.</span><br><span class="line">  <span class="built_in">intros</span> n.</span><br><span class="line">  <span class="built_in">simpl</span>. <span class="comment">(* does nothing! *)</span></span><br><span class="line"><span class="keyword">Abort</span>.</span><br></pre></td></tr></table></figure>

<p><code>simpl.</code> does nothing since both <code>+</code> and <code>=?</code> have 2 cases.</p>
<p>so we have to <code>destruct</code> <code>n</code> as 2 cases: nullary <code>O</code> and unary <code>S n&#39;</code>.</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">intros</span> n. <span class="built_in">destruct</span> n <span class="built_in">as</span> [ <span class="comment">(* O *)</span> | <span class="type">(* S</span> *) n&#x27;] eqn:E.</span><br></pre></td></tr></table></figure>

<ul>
<li>the <em>intro pattern</em> <code>as [ |n&#39;]</code> name new bindings.</li>
<li><code>eqn:E</code> annonate the destructed <code>eqn</code> (equation?) as <code>E</code> in the premises of proofs. It could be elided if not explicitly used, but useful to keep for the sake of documentation as well.</li>
</ul>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">subgoal <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  n : nat</span><br><span class="line">  E : n = <span class="number">0</span>                          <span class="comment">(* case 1, n is [O] a.k.a. [0] *)</span></span><br><span class="line">  ============================</span><br><span class="line">  (<span class="number">0</span> + <span class="number">1</span> =? <span class="number">0</span>) = false</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subgoal <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  n, n&#x27; : nat</span><br><span class="line">  E : n = S n&#x27;                       <span class="comment">(* case 2, n is [S n&#x27;] *)</span></span><br><span class="line">  ============================</span><br><span class="line">  (S n&#x27; + <span class="number">1</span> =? <span class="number">0</span>) = false</span><br></pre></td></tr></table></figure>

<p>If there is no need to specify any names, we could omit <code>as</code> clause or simply write <code>as [|]</code> or <code>as []</code>.<br>In fact. Any <code>as</code> clause could be ommited and Coq will fill in random var name auto-magically.</p>
<h3 id="A-small-caveat-on-intro"><a href="#A-small-caveat-on-intro" class="headerlink" title="A small caveat on intro"></a>A small caveat on <code>intro</code></h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">intros</span> x y. <span class="built_in">destruct</span> y <span class="built_in">as</span> [ | <span class="type">y</span> ] eqn:E.</span><br></pre></td></tr></table></figure>

<p>By doing this, name <code>y</code> is shadowed. It’d usually better to use, say <code>y&#39;</code> for this purpose.</p>
<h2 id="Qed"><a href="#Qed" class="headerlink" title="Qed"></a><code>Qed</code></h2><p>standing for Latin words <em>“Quod Erat Demonstrandum”</em>…meaning “that which was to be demonstrated”.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/16/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/18/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">vvbuys</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
