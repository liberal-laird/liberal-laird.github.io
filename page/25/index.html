<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="baidu-site-verification" content="codeva-6wmKWl5hmx" />
<meta name="bytedance-verification-code" content="GcOf/MpQ8shZ5Hh/2hvr" />
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.vvbuys.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Share some post and some issue for linux program">
<meta property="og:type" content="website">
<meta property="og:title" content="VVbugs Blog">
<meta property="og:url" content="https://www.vvbuys.com/page/25/index.html">
<meta property="og:site_name" content="VVbugs Blog">
<meta property="og:description" content="Share some post and some issue for linux program">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="vvbuys">
<meta property="article:tag" content="Linux hyprland Python Rust Golang javascript">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.vvbuys.com/page/25/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/25/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>VVbugs Blog - standalone Linux lover</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">VVbugs Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">standalone Linux lover</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">vvbuys</p>
  <div class="site-description" itemprop="description">Share some post and some issue for linux program</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">265</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2021-10-09-%E3%80%90%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98%E3%80%91%E5%8F%8C%E6%8C%87%E9%92%88%E6%B3%95%EF%BC%88%E5%BF%AB%E6%85%A2%E6%8C%87%E9%92%88%E6%B3%95%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021-10-09-%E3%80%90%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98%E3%80%91%E5%8F%8C%E6%8C%87%E9%92%88%E6%B3%95%EF%BC%88%E5%BF%AB%E6%85%A2%E6%8C%87%E9%92%88%E6%B3%95%EF%BC%89/" class="post-title-link" itemprop="url">「算法刷题」双指针法（快慢指针法）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-10-09 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-09T00:00:00+00:00">2021-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:00:55" itemprop="dateModified" datetime="2024-02-02T01:00:55+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一、顺序结构中的双指针法"><a href="#一、顺序结构中的双指针法" class="headerlink" title="一、顺序结构中的双指针法"></a>一、顺序结构中的双指针法</h1><p>顺序结构：这里主要指的是数组或字符串。</p>
<h3 id="（1）普通数组"><a href="#（1）普通数组" class="headerlink" title="（1）普通数组"></a>（1）普通数组</h3><p>slow指向   当前所需元素数组的下一个空位。返回值为slow时，slow就代表目标数组的长度。</p>
<table>
<thead>
<tr>
<th><strong>题目简述</strong></th>
<th><strong>关键点</strong></th>
<th><strong>解题思路</strong></th>
<th><strong>力扣题目</strong></th>
<th align="center"><strong>相关链接</strong></th>
</tr>
</thead>
<tbody><tr>
<td>删除数组中的某类元素</td>
<td>同向移动，快慢指针同时出发；</td>
<td>slow：指向当前所需元素数组的下一个空位。fast：遍历数组。     如果快指针遇到目标值则快指针直接跳过它一步，慢指针不动，<strong>如果快指针没有遇到目标值则将自己手中的数交给慢指针</strong>，然后各自前进一步。</td>
<td>27 移除元素（简单难度）</td>
<td align="center"><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/remove-element/">https://leetcode-cn.com/problems/remove-element/</a></td>
</tr>
<tr>
<td>移动数组中的某类元素到开头或者末尾</td>
<td>同向移动，快慢指针同时出发；</td>
<td>如果快指针遇到目标值则快指针直接跳过它一步，慢指针不动，如果快指针没有遇到目标值则将自己手中的数和慢指针交换，然后各自前进一步。</td>
<td>283 移动零（简单难度）</td>
<td align="center"><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/move-zeroes/">https://leetcode-cn.com/problems/move-zeroes/</a></td>
</tr>
</tbody></table>
<h3 id="（2）有序数组"><a href="#（2）有序数组" class="headerlink" title="（2）有序数组"></a>（2）有序数组</h3><p>无序数组可以直接使用sort()函数排序后变成有序数组。sort(nums.begin(),nums.end())</p>
<table>
<thead>
<tr>
<th><strong>题目简述</strong></th>
<th><strong>关键点</strong></th>
<th><strong>解题思路</strong></th>
<th><strong>力扣题目</strong></th>
<th><strong>相关链接</strong></th>
</tr>
</thead>
<tbody><tr>
<td>删除<strong>有序数组</strong>中的重复元素</td>
<td>同向移动，快指针先行一步，每次不断比较两个指针上的数是否相同。</td>
<td><strong>一个指针（fast）从头到尾遍历，另一个（slow）始终指示当前没有重复的元素数组的下一个空位置；</strong>相同则快指针直接跳过去多行一步，不相同则快指针将手中的数交给慢指针，然后快慢指针同时前进一步；（这时慢指针指的是当前没有重复元素的最后一个*：注意返回值是slow+1。）</td>
<td>26 删除排序数组中的重复项（简单难度）</td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/">https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/</a></td>
</tr>
<tr>
<td>求有序数组中的众数（可能不止一个）</td>
<td>同向移动，快指针先行一步，每次不断比较两个指针上的数是否相同。</td>
<td>相同则频率计时器+1，不相同则频率计时器设为0；每次检查频率计时器是否超过最大计数，超过则记录当前快指针上的数为众数。vector数组排序：sort(nums.begin(),nums.end())</td>
<td><strong>169 多数元素（中等难度）</strong></td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/majority-element/">https://leetcode-cn.com/problems/majority-element/</a></td>
</tr>
<tr>
<td>将有序数组中每个元素平方后再排序</td>
<td>反向移动，左指针和右指针同时出发，每次比较左指针和右指针手上的数的平方；</td>
<td>如果左指针手中数的平方更大则移动起始指针，如果末尾指针手中的数更大则移动末尾指针；当起始指针大于末尾指针时循环结束。（有序数组平方数组平方的最大值就在数组的两端，所以排序需要不断比较数组两端的数）</td>
<td>977 有序数组的平方（简单难度）</td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/squares-of-a-sorted-array/">https://leetcode-cn.com/problems/squares-of-a-sorted-array/</a></td>
</tr>
</tbody></table>
<h4 id="169-多数元素（中等难度）"><a href="#169-多数元素（中等难度）" class="headerlink" title="169 多数元素（中等难度）"></a>169 多数元素（中等难度）</h4><h4 id="1、排序法"><a href="#1、排序法" class="headerlink" title="1、排序法"></a>1、排序法</h4><p>​       <strong>众数是指在数组中出现次数大于<code>⌊ n/2 ⌋</code> 的元素</strong>。 先将nums排序， ，然后返回中间元素的值即可（众数的个数大于一半，排好序的<code>nums</code>中间元素一定是众数） 。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(),nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> nums[nums.<span class="built_in">size</span>()/<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2、摩尔投票法思路"><a href="#2、摩尔投票法思路" class="headerlink" title="2、摩尔投票法思路"></a>2、摩尔投票法思路</h4><p>候选人(cand_num)初始化为nums[0]，票数count初始化为1。<br>当遇到与cand_num相同的数，则票数count &#x3D; count + 1，否则票数count &#x3D; count - 1。<br>当票数count为0时，更换候选人，并将票数count重置为1。<br>遍历完数组后，cand_num即为最终答案。</p>
<p>为何这行得通呢？<br>投票法是遇到相同的则票数 + 1，遇到不同的则票数 - 1。<br>且“多数元素”的个数&gt; ⌊ n&#x2F;2 ⌋，其余元素的个数总和&lt;&#x3D; ⌊ n&#x2F;2 ⌋。<br>因此“多数元素”的个数 - 其余元素的个数总和 的结果 肯定 &gt;&#x3D; 1。<br>这就相当于每个“多数元素”和其他元素 两两相互抵消，抵消到最后肯定还剩余至少1个“多数元素”。</p>
<p>无论数组是1 2 1 2 1，亦或是1 2 2 1 1，总能得到正确的候选人。</p>
<p>作者：gfu<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/majority-element/solution/3chong-fang-fa-by-gfu-2/">https://leetcode-cn.com/problems/majority-element/solution/3chong-fang-fa-by-gfu-2/</a><br>来源：力扣（LeetCode）</p>
<p>代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cand=nums[<span class="number">0</span>],count=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;nums.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cand==nums[i])&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(--count==<span class="number">0</span>)&#123;</span><br><span class="line">                cand=nums[i];</span><br><span class="line">                count=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cand;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="二、非顺序结构中的双指针法"><a href="#二、非顺序结构中的双指针法" class="headerlink" title="二、非顺序结构中的双指针法"></a>二、非顺序结构中的双指针法</h1><p>这里的非顺序结构主要指的是：链表或二叉树。</p>
<h2 id="1、链表"><a href="#1、链表" class="headerlink" title="1、链表"></a>1、链表</h2><p>链表删除某个元素的模板：</p>
<p>1、创建头结点和当前结点</p>
<p>2、删除结点</p>
<p>3、还原真实头结点，返回。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ListNode* removeElements(ListNode* head, int val) &#123;</span><br><span class="line">        //新建虚拟头结点</span><br><span class="line">        ListNode * myHead = new ListNode(0);</span><br><span class="line">        myHead-&gt;next=head;</span><br><span class="line">        //循环检查链表的当前节点的下一节点</span><br><span class="line">        ListNode* cur=myHead;//当前节点（一定不为空）</span><br><span class="line">        while (cur-&gt;next != NULL) &#123;</span><br><span class="line">            if(cur-&gt;next-&gt;val == val) &#123;</span><br><span class="line">                cur-&gt;next = cur-&gt;next-&gt;next;//删除下一节点</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                cur = cur-&gt;next;//更新当前节点为下一节点</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //还原真实头结点</span><br><span class="line">        head = myHead-&gt;next;</span><br><span class="line">        return head;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="（1）链表的删除操作"><a href="#（1）链表的删除操作" class="headerlink" title="（1）链表的删除操作"></a>（1）链表的删除操作</h3><p>有序链表中删除一个节点cur需要其<strong>前一个节点</strong>pre-&gt;next&#x3D;cur-&gt;next; 所以其天生需要节点的先后关系。</p>
<p>所以在执行删除操作时，一般就需要(头结点)</p>
<table>
<thead>
<tr>
<th><strong>题目简述</strong></th>
<th><strong>关键点</strong></th>
<th><strong>解题思路</strong></th>
<th><strong>力扣题目</strong></th>
<th><strong>相关链接</strong></th>
</tr>
</thead>
<tbody><tr>
<td>删除链表中的某类元素（简单难度）</td>
<td>虚拟头结点；链表的循环操作和节点的删除操作</td>
<td>同向移动，快指针从头结点先行一步，每次判断快指针是否符合删除条件，若符合则删除快指针并且重新为快指针赋值；否则则快指针和慢指针都前进一步。</td>
<td>203 移除链表元素（简单难度）</td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/remove-linked-list-elements/">https://leetcode-cn.com/problems/remove-linked-list-elements/</a></td>
</tr>
<tr>
<td>删除链表的倒数第N个节点（中等难度）</td>
<td>快指针先走N步之后进行判断</td>
<td>同向出发，快指针从头结点先行N步，如果此时快指针不存在则直接返回，若存在则快指针和慢指针（从头结点）同时出发，当快指针不存在时删除慢指针之后的一个节点。</td>
<td>19 删除链表的倒数第N个节点（中等难度）</td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/">https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/</a></td>
</tr>
</tbody></table>
<h4 id="19-删除链表的倒数第n个结点"><a href="#19-删除链表的倒数第n个结点" class="headerlink" title="19.删除链表的倒数第n个结点"></a>19.删除链表的倒数第n个结点</h4><p>（1）假设链表长度为m+n。</p>
<p>fast、slow开始指向虚拟头结点。</p>
<p>1、fast先走n步</p>
<p>2、fast和slow同时走，直到fast指向链表的最后一个。</p>
<p>​     则slow走了m步。</p>
<p>（2）链表的删除操作，需要得到目标结点的前一个结点。</p>
<p>所以</p>
<p>1、fast先走n+1步。</p>
<p>2、fast和slow同时走，直到fast指向链表的最后一个的下一个位置：NULL。</p>
<p>​     则slow走了m-1步，在倒数第n个结点前。</p>
<h3 id="（2）链表的反转操作"><a href="#（2）链表的反转操作" class="headerlink" title="（2）链表的反转操作"></a>（2）链表的反转操作</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3><table>
<thead>
<tr>
<th><strong>题目简述</strong></th>
<th><strong>关键点</strong></th>
<th><strong>解题思路</strong></th>
<th><strong>力扣题目</strong></th>
<th><strong>相关链接</strong></th>
</tr>
</thead>
<tbody><tr>
<td>将一个链表全部反转过来</td>
<td>相邻节点之间的反转操作</td>
<td>同向移动，快指针从头结点先行一步；每次移动快节点和慢节点都进行一次反向</td>
<td>206 反转链表（简单难度）</td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reverse-linked-list/">https://leetcode-cn.com/problems/reverse-linked-list/</a></td>
</tr>
<tr>
<td>将一个链表中的[left,right]区域反转过来</td>
<td></td>
<td>慢指针从虚拟头结点出发找到第left个节点，然后快指针从慢指针的后一个节点出发，共同前进找到第right个节点</td>
<td>92 反转链表II（中等难度）</td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reverse-linked-list-ii/">https://leetcode-cn.com/problems/reverse-linked-list-ii/</a></td>
</tr>
<tr>
<td></td>
<td></td>
<td>根据快慢指针找到中点；反转后半段；比较前后两端节点值</td>
<td>234 回文链表（简单难度）</td>
<td><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/palindrome-linked-list/">https://leetcode-cn.com/problems/palindrome-linked-list/</a></td>
</tr>
</tbody></table>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="206、反转链表"><a href="#206、反转链表" class="headerlink" title="206、反转链表"></a>206、反转链表</h3><p>1、保存后面链表</p>
<p>2、断开指针</p>
<p>3、重新规划pre、cur</p>
<h3 id="234、回文链表"><a href="#234、回文链表" class="headerlink" title="234、回文链表"></a>234、回文链表</h3><p>1、慢指针走一步，快指针走两步</p>
<p>2、pre记录慢指针的前一个，用来分割链表，如果链表长度为奇数，则后半部分多一个结点。</p>
<p>3、将后半部分反转，得cur2，前半部分为cur1.</p>
<p>4、按照cur1的长度，比较cur1和cur2的节点数值。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        ListNode* slow=head;</span><br><span class="line">        ListNode* fast=head;</span><br><span class="line">        ListNode* pre=head;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//慢指针走一步，快指针走两步</span></span><br><span class="line">        <span class="keyword">while</span>(fast &amp;&amp; fast-&gt;next)&#123;</span><br><span class="line">            pre=slow;</span><br><span class="line">            slow=slow-&gt;next;</span><br><span class="line">            fast=fast-&gt;next-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//pre断开链表</span></span><br><span class="line">        pre-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">        ListNode* cur1=head;</span><br><span class="line">        <span class="comment">//反转cur2</span></span><br><span class="line">        ListNode* cur2=<span class="built_in">reverselist</span>(slow);</span><br><span class="line">        <span class="comment">//按照cur1的长度，比较cur1，cur2</span></span><br><span class="line">        <span class="keyword">while</span>(cur1)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur1-&gt;val!=cur2-&gt;val)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cur1=cur1-&gt;next;</span><br><span class="line">            cur2=cur2-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverselist</span><span class="params">(ListNode* head)</span></span>&#123;</span><br><span class="line">        ListNode* cur=head;</span><br><span class="line">        ListNode* temp=head;</span><br><span class="line">        ListNode* pre=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span>(cur)&#123;</span><br><span class="line">            <span class="comment">//保存后面链表</span></span><br><span class="line">            temp=cur-&gt;next;</span><br><span class="line">            <span class="comment">//断开原链表</span></span><br><span class="line">            cur-&gt;next=pre;</span><br><span class="line">            <span class="comment">//重新规划pre，cur</span></span><br><span class="line">            pre=cur;</span><br><span class="line">            cur=temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2021-09-27-%E3%80%90%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0%E3%80%91%E5%B0%81%E8%A3%85%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E5%AD%A6%E4%B9%A0%E7%8E%87%E7%9A%84%E8%B0%83%E6%95%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021-09-27-%E3%80%90%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0%E3%80%91%E5%B0%81%E8%A3%85%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%AD%E5%AD%A6%E4%B9%A0%E7%8E%87%E7%9A%84%E8%B0%83%E6%95%B4/" class="post-title-link" itemprop="url">「技术笔记」封装深度学习中的学习率的调整工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-27 00:00:00" itemprop="dateCreated datePublished" datetime="2021-09-27T00:00:00+00:00">2021-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:00:55" itemprop="dateModified" datetime="2024-02-02T01:00:55+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>学习率调度器（Scheduler）负责根据训练回合（epoch）来调整优化器的学习率（learning rate），该策略可以让模型更高效地收敛。</p>
<p>可以看出，学习率调度器Scheduler和参数优化器optimizer的使用紧密结合。</p>
<h1 id="一、优化器optimizer的定义"><a href="#一、优化器optimizer的定义" class="headerlink" title="一、优化器optimizer的定义"></a>一、优化器optimizer的定义</h1><p>我们以最常见的Adam优化器为例进行介绍（所有optimizers都继承自torch.optim.Optimizer类）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">net = model()</span><br><span class="line">initial_lr = <span class="number">0.1</span></span><br><span class="line">optimizer = torch.optim.Adam(params=net.parameters(),<span class="comment"># 需要优化的可迭代的网络参数，可以是多个网络的参数</span></span><br><span class="line">                             lr=initial_lr,<span class="comment"># 初始学习率</span></span><br><span class="line">                             )</span><br></pre></td></tr></table></figure>

<h1 id="二、学习率调度器scheduler的定义"><a href="#二、学习率调度器scheduler的定义" class="headerlink" title="二、学习率调度器scheduler的定义"></a>二、学习率调度器scheduler的定义</h1><p><strong>torch.optim.lr_scheduler</strong>模块提供了一些根据epoch训练次数来调整学习率（learning rate）的方法。</p>
<p>下面列举常见的学习率调整策略有几种：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.optim.lr_scheduler <span class="keyword">as</span> lr_scheduler</span><br><span class="line"><span class="comment"># 将每个参数组的学习率设置为初始lr与给定函数的乘积</span></span><br><span class="line">scheduler = lr_scheduler.LambdaLR(optimizer,</span><br><span class="line">                                  lr_lambda=<span class="keyword">lambda</span> epoch:<span class="number">0.95</span>**epoch, <span class="comment"># 根据epoch计算衰减因子的函数，也可是函数列表</span></span><br><span class="line">                                 )</span><br><span class="line"><span class="comment"># 每过step_size个epoch，做一次学习率更新：</span></span><br><span class="line">scheduler = lr_scheduler.StepLR(optimizer,</span><br><span class="line">                                step_size=<span class="number">30</span>, <span class="comment"># 每训练step_size个回合更新一次学习率</span></span><br><span class="line">                                gamma=<span class="number">0.1</span>,<span class="comment"># 衰减因子，学习率的乘法因子</span></span><br><span class="line">                                )</span><br><span class="line"><span class="comment"># 该策略能够读取模型的性能指标，当该指标停止改善时，持续关系几个epochs之后，自动减小学习率。</span></span><br><span class="line">scheduler = lr_scheduler.ReduceLROnPlateau(optimizer,</span><br><span class="line">                                           mode=<span class="string">&#x27;min&#x27;</span>, <span class="comment"># 指示指标不再减小/增大时降低学习率，可取min/max</span></span><br><span class="line">                                           factor=<span class="number">0.1</span>,<span class="comment"># 衰减因子，默认为0.1</span></span><br><span class="line">                                           patience= <span class="number">10</span>,<span class="comment"># 默认为10，patience个回合之后降低学习率</span></span><br><span class="line">                                           min_lr= self.min_lr<span class="comment"># 默认为0，最小学习率</span></span><br><span class="line">                                          )</span><br></pre></td></tr></table></figure>

<p>当然我们也可以继承lr_scheduler或其子类来自定义学习率的变化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LinearDecay</span>(lr_scheduler._LRScheduler):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;This class implements LinearDecay&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, optimizer, num_epochs, start_epoch=<span class="number">0</span>, min_lr=<span class="number">0</span>, last_epoch=-<span class="number">1</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;implements LinearDecay</span></span><br><span class="line"><span class="string">        Parameters:</span></span><br><span class="line"><span class="string">        ----------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(optimizer, last_epoch)</span><br><span class="line">        self.num_epochs = num_epochs  <span class="comment"># 训练的总回合</span></span><br><span class="line">        self.start_epoch = start_epoch <span class="comment"># 起始回合</span></span><br><span class="line">        self.min_lr = min_lr <span class="comment"># 最小学习率</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_lr</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 如果没有到指定回合则直接返回</span></span><br><span class="line">        <span class="keyword">if</span> self.last_epoch &lt; self.start_epoch:</span><br><span class="line">            <span class="keyword">return</span> self.base_lrs</span><br><span class="line">        lr = [base_lr - ((base_lr - self.min_lr) / self.num_epochs) * (self.last_epoch - self.start_epoch) <span class="keyword">for</span> base_lr <span class="keyword">in</span> self.base_lrs]</span><br><span class="line">        <span class="keyword">return</span> lr</span><br></pre></td></tr></table></figure>

<h1 id="三、学习率预热机制-Warmup"><a href="#三、学习率预热机制-Warmup" class="headerlink" title="三、学习率预热机制-Warmup"></a>三、学习率预热机制-Warmup</h1><h3 id="1、什么是Warmup"><a href="#1、什么是Warmup" class="headerlink" title="1、什么是Warmup?"></a>1、什么是Warmup?</h3><p>Warmup是在ResNet论文中提到的一种学习率预热的方法,即先用最初的小学习率训练，然后每个step增大一点点，直到达到最初设置的比较大的学习率时（注：此时预热学习率完成），采用最初设置的学习率进行训练（注：预热学习率完成后的训练过程，学习率是衰减的），有助于使模型收敛速度变快，效果更佳。</p>
<h3 id="2、为什么使用Warmup"><a href="#2、为什么使用Warmup" class="headerlink" title="2、为什么使用Warmup?"></a>2、为什么使用Warmup?</h3><p>由于刚开始训练时,模型的权重(weights)是随机初始化的，此时若选择一个较大的学习率,可能带来模型的不稳定(振荡)，选择Warmup预热学习率的方式，可以使得开始训练的几个epoches或者一些steps内学习率较小,在预热的小学习率下，模型可以慢慢趋于稳定,等模型相对稳定后再选择预先设置的学习率进行训练,使得模型收敛速度变得更快，模型效果更佳。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WarmRestart</span>(lr_scheduler.CosineAnnealingLR):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;This class implements Stochastic Gradient Descent with Warm Restarts(SGDR): https://arxiv.org/abs/1608.03983.</span></span><br><span class="line"><span class="string">    Set the learning rate of each parameter group using a cosine annealing schedule, When last_epoch=-1, sets initial lr as lr.</span></span><br><span class="line"><span class="string">    This can&#x27;t support scheduler.step(epoch). please keep epoch=None.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, optimizer, T_max=<span class="number">30</span>, T_mult=<span class="number">1</span>, eta_min=<span class="number">0</span>, last_epoch=-<span class="number">1</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;implements SGDR</span></span><br><span class="line"><span class="string">        Parameters:</span></span><br><span class="line"><span class="string">        ----------</span></span><br><span class="line"><span class="string">        T_max : int</span></span><br><span class="line"><span class="string">            Maximum number of epochs.</span></span><br><span class="line"><span class="string">        T_mult : int</span></span><br><span class="line"><span class="string">            Multiplicative factor of T_max.</span></span><br><span class="line"><span class="string">        eta_min : int</span></span><br><span class="line"><span class="string">            Minimum learning rate. Default: 0.</span></span><br><span class="line"><span class="string">        last_epoch : int</span></span><br><span class="line"><span class="string">            The index of last epoch. Default: -1.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.T_mult = T_mult</span><br><span class="line">        <span class="built_in">super</span>().__init__(optimizer, T_max, eta_min, last_epoch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_lr</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> math</span><br><span class="line">        <span class="keyword">if</span> self.last_epoch == self.T_max:</span><br><span class="line">            self.last_epoch = <span class="number">0</span></span><br><span class="line">            self.T_max *= self.T_mult</span><br><span class="line">        <span class="keyword">return</span> [self.eta_min + (base_lr - self.eta_min) * (<span class="number">1</span> + math.cos(math.pi * self.last_epoch / self.T_max)) / <span class="number">2</span> <span class="keyword">for</span></span><br><span class="line">                base_lr <span class="keyword">in</span> self.base_lrs]</span><br></pre></td></tr></table></figure>

<h1 id="四、封装的学习率调整器"><a href="#四、封装的学习率调整器" class="headerlink" title="四、封装的学习率调整器"></a>四、封装的学习率调整器</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.optim.lr_scheduler <span class="keyword">as</span> lr_scheduler</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Scheduler</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.min_lr = <span class="number">0.0000001</span> <span class="comment"># 衰减的最低学习率</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_scheduler</span>(<span class="params">self, optimizer</span>):</span><br><span class="line">        <span class="keyword">if</span> self.name == <span class="string">&#x27;lambdaLR&#x27;</span>:</span><br><span class="line">            <span class="comment"># 将每个参数组的学习率设置为初始lr与给定函数的乘积</span></span><br><span class="line">            scheduler = lr_scheduler.LambdaLR(optimizer,</span><br><span class="line">                                              lr_lambda=<span class="keyword">lambda</span> epoch:<span class="number">0.95</span>**epoch, <span class="comment"># 根据epoch计算衰减因子的函数，也可以是函数列表</span></span><br><span class="line">                                              )</span><br><span class="line">        <span class="keyword">elif</span> self.name == <span class="string">&#x27;stepLR&#x27;</span>:</span><br><span class="line">            <span class="comment"># 每过step_size个epoch，做一次学习率更新：</span></span><br><span class="line">            scheduler = lr_scheduler.StepLR(optimizer,</span><br><span class="line">                                                  step_size=<span class="number">30</span>, <span class="comment"># 每训练step_size个回合更新一次学习率</span></span><br><span class="line">                                                  gamma=<span class="number">0.1</span>,<span class="comment"># 衰减因子，学习率的乘法因子</span></span><br><span class="line">                                                    )</span><br><span class="line">        <span class="keyword">elif</span> self.name == <span class="string">&#x27;plateau&#x27;</span>:</span><br><span class="line">            <span class="comment"># 该策略能够读取模型的性能指标，当该指标停止改善时，持续关系几个epochs之后，自动减小学习率。</span></span><br><span class="line">            scheduler = lr_scheduler.ReduceLROnPlateau(optimizer,</span><br><span class="line">                                                             mode=<span class="string">&#x27;min&#x27;</span>, <span class="comment"># 指示指标不再减小/增大时降低学习率，可取min/max</span></span><br><span class="line">                                                             factor=<span class="number">0.1</span>,<span class="comment"># 衰减因子，默认为0.1</span></span><br><span class="line">                                                             patience= <span class="number">10</span>,<span class="comment"># 默认为10，patience个回合之后降低学习率</span></span><br><span class="line">                                                             min_lr= self.min_lr)<span class="comment"># 默认为0，最小学习率</span></span><br><span class="line">        <span class="keyword">elif</span> self.name == <span class="string">&#x27;sgdr&#x27;</span>:</span><br><span class="line">            <span class="comment"># 学习率的预热机制</span></span><br><span class="line">            scheduler = WarmRestart(optimizer)</span><br><span class="line">        <span class="keyword">elif</span> self.name == <span class="string">&#x27;linear&#x27;</span>:</span><br><span class="line">            <span class="comment"># 从start_epoch开始进行学习率的线性衰减：</span></span><br><span class="line">            scheduler = LinearDecay(optimizer,</span><br><span class="line">                                    min_lr=self.min_lr, <span class="comment"># 最小学习率</span></span><br><span class="line">                                    num_epochs=<span class="number">10</span>, <span class="comment"># 训练的总回合数</span></span><br><span class="line">                                    start_epoch=<span class="number">5</span>) <span class="comment"># 开始衰减的回合数</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Scheduler [%s] 无法初始化.&quot;</span> % self.config[<span class="string">&#x27;scheduler&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> scheduler</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_test_optimizer</span>():</span><br><span class="line">    <span class="keyword">import</span> torch</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">model</span>(torch.nn.Module):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="built_in">super</span>().__init__()</span><br><span class="line">            self.conv1 = torch.nn.Conv2d(in_channels=<span class="number">3</span>, out_channels=<span class="number">3</span>, kernel_size=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    net = model()</span><br><span class="line">    initial_lr = <span class="number">0.1</span></span><br><span class="line">    optimizer = torch.optim.Adam(params=net.parameters(),<span class="comment"># 需要优化的可迭代的网络参数，也可以是多个网络的参数</span></span><br><span class="line">                                 lr=initial_lr,<span class="comment"># 初始学习率</span></span><br><span class="line">                                 )</span><br><span class="line">    <span class="keyword">return</span> optimizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    optimizer = get_test_optimizer()</span><br><span class="line">    <span class="comment">#scheduler = Scheduler(&#x27;lambdaLR&#x27;).get_scheduler(optimizer)</span></span><br><span class="line">    scheduler = Scheduler(<span class="string">&#x27;linear&#x27;</span>).get_scheduler(optimizer)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;初始化的学习率：&quot;</span>, optimizer.defaults[<span class="string">&#x27;lr&#x27;</span>])</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;第%d个epoch的学习率：%f&quot;</span> % (epoch, optimizer.param_groups[<span class="number">0</span>][<span class="string">&#x27;lr&#x27;</span>]))</span><br><span class="line">        scheduler.step()</span><br></pre></td></tr></table></figure>

<p>测试输出结果：</p>
<p>初始化的学习率： 0.1</p>
<p>第1个epoch的学习率：0.100000</p>
<p>第2个epoch的学习率：0.100000</p>
<p>第3个epoch的学习率：0.100000</p>
<p>第4个epoch的学习率：0.100000</p>
<p>第5个epoch的学习率：0.100000</p>
<p>第6个epoch的学习率：0.100000</p>
<p>第7个epoch的学习率：0.090000</p>
<p>第8个epoch的学习率：0.080000</p>
<p>第9个epoch的学习率：0.070000</p>
<p>第10个epoch的学习率：0.060000</p>
<p>进程已结束，退出代码 0</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2018-05-11-pwa-zh-preface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018-05-11-pwa-zh-preface/" class="post-title-link" itemprop="url">《PWA 实战》推荐序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-05-11 12:00:00" itemprop="dateCreated datePublished" datetime="2018-05-11T12:00:00+00:00">2018-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>「博文视点」邀请我给<a target="_blank" rel="noopener" href="https://union-click.jd.com/jdc?e=&p=AyIGZRhfEgoaBVUbXBYyEgRXHF8UChI3EUQDS10iXhBeGlcJDBkNXg9JHU4YDk5ER1xOGRNLGEEcVV8BXURFUFdfC0RVU1JRUy1OVxUBEABRGlMVMmZMDxwsR2cWZVdbO2ocFV9cSB5qfnILWStaJQITBlcTWhYLEQJlK1sSMkRpVRpaFAMTAlUeWCUDIgdSG1oXARIPUx5eFAMiAFUSaxYBFAJVElgSCw4FURxTFAoiN2UYayUyEjdWKxl7UEEPUR5dFFYWBgYTXhZXFA5WTlMSVxoDUh9TQFFBAVUrWRQDFg4=">《PWA实战：面向下一代的Progressive Web APP》</a> 写的推荐序。</p>
</blockquote>
<p>Progressive Web App 是继 Ajax、响应式设计、HTML5 之后，web 平台的又一次革命性突破。它在开放 Web 标准的基础之上，突破了以往 Web 应用只能「依赖互联网分发」与「依赖浏览器为入口」的两大桎梏，一下子打开了 Web 应用从性能、架构到用户体验上的一系列可能性。</p>
<p>PWA 中最引入注目的核心新特性，Service Worker，实质上是为 Web 应用带来了一种安全而又低功耗的后台处理能力。无论是用于实现离线 Web 应用所需要的缓存读写与网络代理，还是用于提升 Web 应用能力的推送通知、后台同步，其实都得益于这种新的并发能力。随着 Edge 与 Safari 的相继发布，Service Worker 已经历史性的达到了全浏览器的支持。</p>
<p>而这就要归功于 Web 开放性的力量。相比于其他众多私有的“类 Web”技术，PWA 技术完全属于开放 Web 标准。PWA 因此具备了独一无二的跨平台能力，不止于移动端，Chrome 与 Windows 已经让 PWA 在桌面端也晋升为了第一公民。这使得「一套代码，发布可以同时跨移动桌面设备、跨操作系统、跨浏览器的超级应用」真正成为可能。这里有非常大的想象空间，非常值得我们期待。</p>
<p>PWA 作为“下一代 Web 应用模型”从 2015 年第一次发布，到现在的 2018 年中，国际上 Google、Twitter、Facebook、Instagram、FlipKart、Uber、Lyft、Pinterest、Tinder、Flipboard、Spotify……国内诸如 AliExpress、饿了么、微博，都已经在使用 PWA 技术甚至发布了专门的 PWA 产品。可以说 PWA 从生态到工具链都已经逐渐成熟，接下来将会迎来更大的爆发。</p>
<p>在这个时间点上，很高兴能看到本书的翻译团队能在如此短的时间里将最新的技术带回中文社区，非常难能可贵。本人也做过一些 PWA 的分享，但要对社区带来更大的推动，我们更需要这样完整的大部头作品。</p>
<p>本书原著非常详实且不失生动地涵盖了 PWA 的方方面面。作者不但通过一个贯穿全书的案例将 PWA 的各项技术串起，还把它们所要解决的问题与可以带来的产品价值也一一娓娓道来。书中讨论到的策略与模式非常实用，既可以帮助你快速上手 PWA，也能帮助你对 Web 应用的工程化有更好的理解。</p>
<p>在此，我谨作为整个中文 Web 社区的一员，感谢团队的贡献！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2017-02-09-nextgen-web-pwa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017-02-09-nextgen-web-pwa/" class="post-title-link" itemprop="url">下一代 Web 应用模型 —— Progressive Web App</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-02-09 12:00:00" itemprop="dateCreated datePublished" datetime="2017-02-09T12:00:00+00:00">2017-02-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>今年 9 月份的时候，《程序员》杂志社就邀请我写一篇关于 PWA 的文章。后来花式拖稿，拖过了 10 月的 QCon，11 月的 GDG DevFest，终于在 12 月把这篇长文熬了出来。几次分享的不成熟，这次的结构算是比较满意了。「 可能是目前中文世界里对 PWA 最全面详细的长文了」，希望你能喜欢。<br><br><br>本文首发于 <a target="_blank" rel="noopener" href="http://geek.csdn.net/news/detail/135595">CSDN</a> 与《程序员》2017 年 2 月刊，同步发布于 <a target="_blank" rel="noopener" href="https://huangxuan.me/">Hux Blog</a>、<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/FrontendMagazine">前端外刊评论 - 知乎专栏</a>，转载请保留链接 ;)</p>
</blockquote>
<h2 id="下一代-Web-应用？"><a href="#下一代-Web-应用？" class="headerlink" title="下一代 Web 应用？"></a>下一代 Web 应用？</h2><p>近年来，Web 应用在整个软件与互联网行业承载的责任越来越重，软件复杂度和维护成本越来越高，Web 技术，尤其是 Web 客户端技术，迎来了爆发式的发展。</p>
<p>包括但不限于基于 Node.js 的前端工程化方案；诸如 Webpack、Rollup 这样的打包工具；Babel、PostCSS 这样的转译工具；TypeScript、Elm 这样转译至 JavaScript 的编程语言；React、Angular、Vue 这样面向现代 web 应用需求的前端框架及其生态，也涌现出了像<a target="_blank" rel="noopener" href="http://nerds.airbnb.com/isomorphic-javascript-future-web-apps/" title="Isomorphic JavaScript: The Future of Web Apps">同构 JavaScript</a>与<a target="_blank" rel="noopener" href="https://medium.com/@mjackson/universal-javascript-4761051b7ae9#.unrzyz3b2" title="Universal JavaScript">通用 JavaScript 应用</a>这样将服务器端渲染（Server-side Rendering）与单页面应用模型（Single-page App）结合的 web 应用架构方式，可以说是百花齐放。</p>
<p>但是，Web 应用在移动时代并没有达到其在桌面设备上流行的程度。究其原因，尽管上述的各种方案已经充分利用了现有的 JavaScript 计算能力、CSS 布局能力、HTTP 缓存与浏览器 API 对当代基于 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ajax_(programming)" title="Ajax - Wikipedia">Ajax</a> 与<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Responsive_web_design" title="Responsive Web Design - Wikipedia">响应式设计</a>的 web 应用模型的性能与体验带来了工程角度的巨大突破，我们仍然无法在不借助原生程序辅助浏览器的前提下突破 web 平台本身对 web 应用固有的桎梏：<strong>客户端软件（即网页）需要下载所带来的网络延迟；与 Web 应用依赖浏览器作为入口所带来的体验问题。</strong></p>
<p><img src="/img/in-post/post-nextgen-web-pwa/PWAR-007.jpeg"><br><em>Web 与原生应用在移动平台上的使用时长对比 <a target="_blank" rel="noopener" href="https://developers.google.com/web/events/pwaroadshow/">图片来源: Google</a></em></p>
<p>在桌面设备上，由于网络条件稳定，屏幕尺寸充分，交互方式趋向于多任务，这两点造成的负面影响对比 web 应用免于安装、随叫随到、无需更新等优点，瑕不掩瑜。但是在移动时代，脆弱的网络连接与全新的人机交互方式使得这两个问题被无限放大，严重制约了 web 应用在移动平台的发展。在用户眼里，原生应用不会出现「白屏」，清一色都摆在主屏幕上；而 web 应用则是浏览器这个应用中的应用，使用起来并不方便，而且加载也比原生应用要慢。</p>
<p>Progressive Web Apps（以下简称 PWA）以及构成 PWA 的一系列关键技术的出现，终于让我们看到了彻底解决这两个平台级别问题的曙光：能够显著提高应用加载速度、甚至让 web 应用可以在离线环境使用的 Service Worker 与 Cache Storage；用于描述 web 应用元数据（metadata）、让 web 应用能够像原生应用一样被添加到主屏、全屏执行的 Web App Manifest；以及进一步提高 web 应用与操作系统集成能力，让 web 应用能在未被激活时发起推送通知的 Push API 与 Notification API 等等。</p>
<p>将这些技术组合在一起会是怎样的效果呢？「印度阿里巴巴」 —— <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Flipkart" title="Flipkart - wikipedia">Flipkart</a> 在 2015 年一度关闭了自己的移动端网站，却在年底发布了现在最为人津津乐道的 PWA 案例 <em>FlipKart Lite</em>，成为世界上第一个支撑大规模业务的 PWA。发布的一周后它就亮相于 <a target="_blank" rel="noopener" href="https://youtu.be/m2a9hlUFRhg" title="Keynote (Chrome Dev Summit 2015)">Chrome Dev Summit 2015</a> 上，笔者当时就被惊艳到了。为了方便各媒介上的读者观看，笔者做了几幅图方便给大家介绍：</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/flipkart-1.jpeg"><br><em>图片来源: Hux &amp; <a target="_blank" rel="noopener" href="https://medium.com/@AdityaPunjani/building-flipkart-lite-a-progressive-web-app-2c211e641883#.hz4d3kw41" title="Building Flipkart Lite: A Progressive Web App">Medium.com</a></em></p>
<p>当浏览器发现用户<a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/engage-and-retain/app-install-banners/?hl=en" title="Web App Install Banners - Google Developer">需要</a> Flipkart Lite 时，它就会提示用户「嘿，你可以把它添加至主屏哦」（用户也可以手动添加）。这样，Flipkart Lite 就会像原生应用一样在主屏上留下一个自定义的 icon 作为入口；与一般的书签不同，当用户点击 icon 时，Flipkat Lite 将直接全屏打开，不再受困于浏览器的 UI 中，而且有自己的启动屏效果。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/flipkart-2.jpeg"><br><em>图片来源: Hux &amp; <a target="_blank" rel="noopener" href="https://medium.com/@AdityaPunjani/building-flipkart-lite-a-progressive-web-app-2c211e641883#.hz4d3kw41" title="Building Flipkart Lite: A Progressive Web App">Medium.com</a></em></p>
<p>更强大的是，在无法访问网络时，Flipkart Lite 可以像原生应用一样照常执行，还会很骚气的变成黑白色；不但如此，曾经访问过的商品都会被缓存下来得以在离线时继续访问。在商品降价、促销等时刻，Flipkart Lite 会像原生应用一样发起推送通知，吸引用户回到应用。</p>
<p><strong>无需担心网络延迟；有着独立入口与独立的保活机制。</strong>之前两个问题的一并解决，宣告着 web 应用在移动设备上的浴火重生：满足 PWA 模型的 web 应用，将逐渐成为移动操作系统的一等公民，并将向原生应用发起挑战与「复仇」。</p>
<p>更令笔者兴奋的是，就在今年 11 月的 <a target="_blank" rel="noopener" href="https://youtu.be/eI3B6x0fw9s" title="Keynote (Chrome Dev Summit 2016)">Chrome Dev Summit 2016</a> 上，Chrome 的工程 VP Darin Fisher 介绍了 Chrome 团队正在做的一些实验：把「添加至主屏」重命名为「安装」，被安装的 PWA 不再仅以 widget 的形式显示在桌面上，而是真正做到与所有原生应用平级，一样被收纳进应用抽屉（App Drawer）里，一样出现在系统设置中 🎉🎉🎉。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/flipkart-3.jpeg"><br><em>图片来源: Hux &amp; <a target="_blank" rel="noopener" href="https://twitter.com/adityapunjani">@adityapunjani</a></em></p>
<p>图中从左到右分别为：类似原生应用的安装界面；被收纳在应用抽屉里的 Flipkart Lite 与 Hux Blog；设置界面中并列出现的 Flipkart 原生应用与 Flipkart Lite PWA （可以看到 PWA 巨大的体积优势）</p>
<p><strong>笔者相信，PWA 模型将继约 20 年前横空出世的 Ajax 与约 10 年前风靡移动互联网的响应式设计之后，掀起 web 应用模型的第三次根本性革命，将 web 应用带进一个全新的时代。</strong></p>
<h2 id="PWA-关键技术的前世今生"><a href="#PWA-关键技术的前世今生" class="headerlink" title="PWA 关键技术的前世今生"></a>PWA 关键技术的前世今生</h2><h3 id="Web-App-Manifest"><a href="#Web-App-Manifest" class="headerlink" title="Web App Manifest"></a><a target="_blank" rel="noopener" href="https://w3c.github.io/manifest/#use-cases-and-requirements" title="Web App Manifest">Web App Manifest</a></h3><p>Web App Manifest，即通过一个清单文件向浏览器暴露 web 应用的元数据，包括名字、icon 的 URL 等，以备浏览器使用，比如在添加至主屏或推送通知时暴露给操作系统，从而增强 web 应用与操作系统的集成能力。</p>
<p>让 web 应用在移动设备上的体验更接近原生应用的尝试其实早在 2008 年的 <a target="_blank" rel="noopener" href="https://huangxuan.me/pwa-qcon2016/#/37" title="PWA@QCon2016 #37">iOS 1.1.3 与 iOS 2.1.0 </a>时就开始了，它们分别为 web 应用增加了对自定义 icon 和全屏打开的支持。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/ios2-a2hs.gif"><br><em>图片来源: <a target="_blank" rel="noopener" href="http://appleinsider.com/articles/08/10/03/latest_iphone_software_supports_full_screen_web_apps.html">appleinsider.com</a></em></p>
<p>但是很快，随着越来越多的私有平台通过 <code>&lt;meta&gt;</code>&#x2F;<code>&lt;link&gt;</code> 标签来为 web 应用添加「私货」，<code>&lt;head&gt;</code> 很快就被塞满了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Add to homescreen for Safari on iOS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> <span class="attr">content</span>=<span class="string">&quot;yes&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> <span class="attr">content</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-title&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Lighten&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Add to homescreen for Chrome on Android --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;mobile-web-app-capable&quot;</span> <span class="attr">content</span>=<span class="string">&quot;yes&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mate</span> <span class="attr">name</span>=<span class="string">&quot;theme-color&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#000000&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Icons for iOS and Android Chrome M31~M38 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon-precomposed&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;144x144&quot;</span> <span class="attr">href</span>=<span class="string">&quot;images/touch/apple-touch-icon-144x144-precomposed.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon-precomposed&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;114x114&quot;</span> <span class="attr">href</span>=<span class="string">&quot;images/touch/apple-touch-icon-114x114-precomposed.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon-precomposed&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;72x72&quot;</span> <span class="attr">href</span>=<span class="string">&quot;images/touch/apple-touch-icon-72x72-precomposed.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon-precomposed&quot;</span> <span class="attr">href</span>=<span class="string">&quot;images/touch/apple-touch-icon-57x57-precomposed.png&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Icon for Android Chrome, recommended --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;196x196&quot;</span> <span class="attr">href</span>=<span class="string">&quot;images/touch/touch-icon-196x196.png&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Tile icon for Win8 (144x144 + tile color) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;msapplication-TileImage&quot;</span> <span class="attr">content</span>=<span class="string">&quot;images/touch/ms-touch-icon-144x144-precomposed.png&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;msapplication-TileColor&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#3372DF&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Generic Icon --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;images/touch/touch-icon-57x57.png&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>显然，这种做法并不优雅：分散又重复的元数据定义多余且难以维持同步，与 html 耦合在一起也加重了浏览器检查元数据未来变动的成本。与此同时，社区里开始出现使用 manifest 文件以中心化地描述元数据的方案，比如 <a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/manifest" title="Chrome Apps Manifest">Chrome Extension、 Chrome Hosted Web Apps (2010)</a> 与 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Archive/Firefox_OS/Firefox_OS_apps/Building_apps_for_Firefox_OS/Manifest" title="Firefox OS App Manifest">Firefox OS App Manifest (2011)</a> 使用 JSON；<a target="_blank" rel="noopener" href="http://cordova.apache.org/docs/en/6.x/config_ref/index.html" title="Config.xml - Apache Cordova">Cordova</a> 与 <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/dn320426%28v=vs.85%29.aspx" title="Browser configuration schema reference - MSDN">Windows Pinned Site</a> 使用 XML；</p>
<p>2013 年，W3C WebApps 工作组开始对基于 JSON 的 Manifest 进行标准化，于同年年底发布<a target="_blank" rel="noopener" href="https://www.w3.org/TR/2013/WD-appmanifest-20131217/" title="Manifest for web apps and bookmarks - First Public Working Draft">第一份公开 Working Draft</a>，并逐渐演化成为今天的 W3C Web App Manifest：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Manifest Sample&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Web Application Manifest Sample&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launcher-icon-2x.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;96x96&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/sample/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/sample/index.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;display&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standalone&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;orientation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;landscape&quot;</span></span><br><span class="line">  <span class="attr">&quot;theme_color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background_color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#fff&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- document --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;manifest&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/manifest.json&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>诸如 <code>name</code>、<code>icons</code>、<code>display</code> 都是我们比较熟悉的，而大部分新增的成员则为 web 应用带来了一系列以前 web 应用想做却做不到（或在之前只能靠 hack）的新特性：</p>
<ul>
<li><code>scope</code>：定义了 web 应用的浏览作用域，比如作用域外的 URL 就会打开浏览器而不会在当前 PWA 里继续浏览。</li>
<li><code>start_url</code>：定义了一个 PWA 的入口页面。比如说你添加 <a target="_blank" rel="noopener" href="https://huangxuan.me/" title="Hux Blog">Hux Blog</a> 的任何一个文章到主屏，从主屏打开时都会访问 <a target="_blank" rel="noopener" href="https://huangxuan.me/" title="Hux Blog">Hux Blog</a> 的主页。</li>
<li><code>orientation</code>：终于，我们可以锁定屏幕旋转了（喜极而泣…）</li>
<li><code>theme_color</code>&#x2F;<code>background_color</code>：主题色与背景色，用于配置一些可定制的操作系统 UI 以提高用户体验，比如 Android 的状态栏、任务栏等。</li>
</ul>
<p>这个清单的成员还有很多，比如用于声明「对应原生应用」的 <code>related_applications</code> 等等，本文就不一一列举了。作为 PWA 的「户口本」，承载着 web 应用与操作系统集成能力的重任，Web App Manifest 还将在日后不断扩展，以满足 web 应用高速演化的需要。</p>
<h3 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a><a target="_blank" rel="noopener" href="https://w3c.github.io/ServiceWorker/" title="Service Worker">Service Worker</a></h3><p>我们原有的整个 Web 应用模型，都是构建在「用户能上网」的前提之下的，所以一离线就只能玩小恐龙了。其实，对于「让 web 应用离线执行」这件事，Service Worker 至少是 web 社区的第三次尝试了。</p>
<p>故事可以追溯到 2007 年的 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Google_Gears" title="Gears - Wikipedia">Google Gears</a>：为了让自家的 Gmail、Youtube、Google Reader 等 web 应用可以在本地存储数据与离线执行，Google 开发了一个浏览器拓展来增强 web 应用。Google Gears 支持 IE 6、Safari 3、Firefox 1.5 等浏览器；要知道，那一年 Chrome 都还没出生呢。</p>
<p>在 Gears API 中，我们通过向 LocalServer 模块提交一个缓存文件清单来实现离线支持：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Somewhere in your javascript</span></span><br><span class="line"><span class="keyword">var</span> localServer = google.<span class="property">gears</span>.<span class="property">factory</span>.<span class="title function_">create</span>(<span class="string">&quot;bata.localserver&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> store = localServer.<span class="title function_">createManagedStore</span>(<span class="variable constant_">STORE_NAME</span>);</span><br><span class="line">store.<span class="property">manifestUrl</span> = <span class="string">&quot;manifest.json&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;betaManifestVersion&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;entries&quot;</span>: [</span><br><span class="line">    &#123; <span class="string">&quot;url&quot;</span>: <span class="string">&quot;index.html&quot;</span> &#125;, </span><br><span class="line">    &#123; <span class="string">&quot;url&quot;</span>: <span class="string">&quot;main.js&quot;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是不是感到很熟悉？好像 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/2011/WD-html5-20110525/offline.html" title="HTML5 5.6 Offline Web Applications">HTML5 规范</a>中的 Application Cache 也是类似的东西？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">manifest</span>=<span class="string">&quot;cache.appcache&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line"></span><br><span class="line">CACHE:</span><br><span class="line">index.html</span><br><span class="line">main.js</span><br></pre></td></tr></table></figure>

<p>是的，Gears 的 LocalServer 就是后来大家所熟知的 App Cache 的前身，大约从 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/offline-webapps/" title="Offline Web Applications">2008</a> 年开始 W3C 就开始尝试将 Gears 进行标准化了；除了 LocalServer，Gears 中用于提供并行计算能力的 WorkerPool 模块与用于提供本地数据库与 SQL 支持的 Database 模块也分别是日后 Web Worker 与 Web SQL Database（后被废弃）的前身。</p>
<p>HTML5 App Cache 作为第二波「让 web 应用离线执行」的尝试，确实也服务了比如 Google Doc、尤雨溪早年作品 HTML5 Clear、以及一直用 web 应用作为自己 iOS 应用的 FT.com（Financial Times）等不少 web 应用。那么，还有 Service Worker 什么事呢？  </p>
<p>是啊，如果 App Cache 没有被设计得<a target="_blank" rel="noopener" href="https://huangxuan.me/sw-101-gdgdf/#/12" title="SW-101@DevFest #12">烂到完全不可编程、无法清理缓存、几乎没有路由机制、出了 Bug 一点救都没有</a>，可能就真没 Service Worker 什么事了。<a target="_blank" rel="noopener" href="https://huangxuan.me/sw-101-gdgdf/#/13" title="SW-101@DevFest #13">App Cache 已经在前不久定稿的 HTML5.1 中被拿掉了，W3C 为了挽救 web 世界真是不惜把自己的脸都打肿了……</a></p>
<p>时至今日，我们终于迎来了 Service Worker 的曙光。简单来说，Service Worker 是一个可编程的 Web Worker，它就像一个位于浏览器与网络之间的客户端代理，可以拦截、处理、响应流经的 HTTP 请求；配合随之引入 Cache Storage API，你可以自由管理 HTTP 请求文件粒度的缓存，这使得 Service Worker 可以从缓存中向 web 应用提供资源，即使是在离线的环境下。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/sw-sw.png"><br><em>Service Worker 就像一个运行在客户端的代理</em></p>
<p>比如说，我们可以给网页 <code>foo.html</code> 注册这么一个 Service Worker，它将劫持由 <code>foo.html</code> 发起的一切 HTTP 请求，并统统返回未设置 <code>Content-Type</code> 的 <code>Hello World!</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sw.js</span></span><br><span class="line">self.<span class="property">onfetch</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.<span class="title function_">respondWith</span>(<span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&#x27;Hello World!&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service Worker 第一次发布于 2014 年的 Google IO 上，目前已处于 W3C 工作草案的状态。其设计吸取了 Application Cache 的失败经验，作为 web 应用的开发者的你有着完全的控制能力；同时，它还借鉴了 Chrome 多年来在 Chrome Extension 上的设计经验（Chrome Background Pages 与 Chrome Event Pages），采用了基于「事件驱动」的唤醒机制，以大幅节省后台计算的能耗。比如上面的 <code>fetch</code> 其实就是会唤醒 Service Worker 的事件之一。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/sw-lifecycle.png"><br><em>Service Worker 的生命周期</em></p>
<p>除了类似 <code>fetch</code> 这样的功能事件外，Service Worker 还提供了一组生命周期事件，包括安装、激活等等。比如，在 Service Worker 的「安装」事件中，我们可以把 web 应用所需要的资源统统预先下载并缓存到 Cache Storage 中去：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sw.js</span></span><br><span class="line">self.<span class="property">oninstall</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.<span class="title function_">waitUntil</span>(</span><br><span class="line">    caches.<span class="title function_">open</span>(<span class="string">&#x27;installation&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">cache</span> =&gt;</span>  cache.<span class="title function_">addAll</span>([</span><br><span class="line">        <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;./styles.css&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;./script.js&#x27;</span></span><br><span class="line">      ]))</span><br><span class="line">  )</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样，当用户离线，网络无法访问时，我们就可以从缓存中启动我们的 web 应用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sw.js</span></span><br><span class="line">self.<span class="property">onfetch</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fetched = <span class="title function_">fetch</span>(e.<span class="property">request</span>)</span><br><span class="line">  <span class="keyword">const</span> cached = caches.<span class="title function_">match</span>(e.<span class="property">request</span>)</span><br><span class="line"></span><br><span class="line">  e.<span class="title function_">respondWith</span>(</span><br><span class="line">    fetched.<span class="title function_">catch</span>(<span class="function"><span class="params">_</span> =&gt;</span> cached)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出，Service Worker 被设计为一个相对底层（low-level）、高度可编程、子概念众多，也因此异常灵活且强大的 API，故本文只能展示它的冰山一角。出于安全考虑，注册 Service Worker 要求你的 web 应用部署于 HTTPS 协议下，以免利用 Service Worker 的中间人攻击。笔者在今年 GDG 北京的 DevFest 上分享了 <a target="_blank" rel="noopener" href="https://huangxuan.me/2016/11/20/sw-101-gdgdf/">Service Worker 101</a>，涵盖了 Service Worker 譬如「网络优先」、「缓存优先」、「网络与缓存比赛」这些更复杂的缓存策略、学习资料、以及<a target="_blank" rel="noopener" href="https://github.com/Huxpro/sw-101-gdgdf">示例代码</a>，可以供大家参考。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/sw-race.png"><br><em>Service Worker 的一种缓存策略：让网络请求与读取缓存比赛</em></p>
<p>你也可以尝试在支持 PWA 的浏览器中访问笔者的博客 <a target="_blank" rel="noopener" href="https://huangxuan.me/" title="Hux Blog">Hux Blog</a>，感受 Service Worker 的实际效果：所有访问过的页面都会被缓存并允许在离线环境下继续访问，所有未访问过的页面则会在离线环境下展示一个自定义的离线页面。</p>
<p>在笔者看来，<strong>Service Worker 对 PWA 的重要性相当于 <code>XMLHTTPRequest</code> 之于 Ajax，媒体查询（Media Query）之于响应式设计，是支撑 PWA 作为「下一代 web 应用模型」的最核心技术。</strong>由于 Service Worker 可以与包括 Indexed DB、Streams 在内的大部分 DOM 无关 API 进行交互，它的潜力简直无可限量。笔者几乎可以断言，Service Worker 将在未来十年里成为 web 客户端技术工程化的兵家必争之地，带来「离线优先（Offline-first）」的架构革命。</p>
<h3 id="Push-Notification"><a href="#Push-Notification" class="headerlink" title="Push Notification"></a>Push Notification</h3><p>PWA 推送通知中的「推送」与「通知」，其实使用的是两个不同但又相得益彰的 API：</p>
<p><a target="_blank" rel="noopener" href="https://notifications.spec.whatwg.org/" title="Notification API">Notification API</a> 相信大家并不陌生，它负责所有与通知本身相关的机制，比如通知的权限管理、向操作系统发起通知、通知的类型与音效，以及提供通知被点击或关闭时的回调等等，目前国内外的各大网站（尤其在桌面端）都有一定的使用。Notification API 最早应该是在 <a target="_blank" rel="noopener" href="https://www.html5rocks.com/en/tutorials/notifications/quick/" title="Using the Notification API">2010</a> 年前后由 Chromium 提出<a target="_blank" rel="noopener" href="http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification" title="API Specification - The Chromium Projects">草案</a>以 <code>webkitNotifications</code> 前缀方式实现；随着 2011 年进入标准化；2012 年在 Safari 6（Mac OSX 10.8+）上获得支持；2015 年 Notification API 成为 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/notifications/" title="Web Notifications - W3C">W3C Recommendation</a>；2016 年 <a target="_blank" rel="noopener" href="https://blogs.windows.com/msedgedev/2016/05/16/web-notifications-microsoft-edge/#2VBm890EjvAvUcgE.97">Edge 的支持</a>；Web Notifications 已经在桌面浏览器中获得了全面支持（Chrome、Edge、Firefox、Opera、Safari）的成就。</p>
<p><a target="_blank" rel="noopener" href="http://w3c.github.io/push-api/" title="Push API">Push API</a> 的出现则让推送服务具备了向 web 应用推送消息的能力，它定义了 web 应用如何向推送服务发起订阅、如何响应推送消息，以及 web 应用、应用服务器与推送服务之间的鉴权与加密机制；由于 Push API 并不依赖 web 应用与浏览器 UI 存活，所以即使是在 web 应用与浏览器未被用户打开的时候，也可以通过后台进程接受推送消息并调用 Notification API 向用户发出通知。值得一提的是，Mac OSX 10.9 Mavericks 与 Safari 7 在 2013 年就发布了自己的私有推送支持，基于 APNS 的 <a target="_blank" rel="noopener" href="https://developer.apple.com/notifications/safari-push-notifications/" title="Safari Push Notifications">Safari Push Notifications</a>。</p>
<p>在 PWA 中，我们利用 Service Worker 的后台计算能力结合 Push API 对推送事件进行响应，并通过 Notification API 实现通知的发出与处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sw.js</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;push&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">waitUntil</span>(</span><br><span class="line">    <span class="comment">// Process the event and display a notification.</span></span><br><span class="line">    self.<span class="property">registration</span>.<span class="title function_">showNotification</span>(<span class="string">&quot;Hey!&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;notificationclick&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;  </span><br><span class="line">  <span class="comment">// Do something with the event  </span></span><br><span class="line">  event.<span class="property">notification</span>.<span class="title function_">close</span>();  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;notificationclose&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;  </span><br><span class="line">  <span class="comment">// Do something with the event  </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>对于 Push Notification，笔者的几次分享中一直都提的稍微少一些，一是因为 Push API 还处于 Editor Draft 的状态，二是目前浏览器与推送服务间的协议支持还不够成熟：Chrome（与其它基于 Blink 的浏览器）在 Chromium 52 之前只支持基于 Google 私有的 GCM&#x2F;FCM 服务进行通知推送。不过好消息是，继 Firefox 44 之后，Chrome 52 与 Opera 39 也紧追其后实现了正在由 IETF 进行标准化的 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/draft-ietf-webpush-protocol-12" title="Web Push Protocol">Web 推送协议（Web Push Protocol）</a>。</p>
<p>如果你已经在使用 Google 的云服务（比如 Firebase），并且主要面向的是海外用户，那么在 web 应用上支持基于 GCM&#x2F;FCM 的推送通知并不是一件费力的事情，笔者推荐你阅读一下 Google Developers 的<a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/engage-and-retain/push-notifications/" title="Web Push Notifications - Google Developer">系列文章</a>，很多国外公司已经玩起来了。</p>
<h2 id="从-Hybrid-到-PWA，从封闭到开放"><a href="#从-Hybrid-到-PWA，从封闭到开放" class="headerlink" title="从 Hybrid 到 PWA，从封闭到开放"></a>从 Hybrid 到 PWA，从封闭到开放</h2><p>2008 年，当移动时代来临，<a target="_blank" rel="noopener" href="https://huangxuan.me/pwa-qcon2016/#/17" title="PWA@QCon2016 #17">唱衰移动 Web 的声音</a>开始出现，而浏览器的进化并不能跟上时，来自 Nitobi 的 Brian Leroux 等人创造了 <a target="_blank" rel="noopener" href="https://cordova.apache.org/" title="Apache Cordova">Phonegap</a>，希望它能以 Polyfill 的形式、弥补目前浏览器与移动设备间的「鸿沟」，从此开启了<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Progressive_web_app#Hybrid_Apps">混合应用（Hybrid Apps）</a>的时代。</p>
<p>几年间，<a target="_blank" rel="noopener" href="http://www.adobe.com/products/air.html" title="Adobe AIR Application">Adobe AIR</a>、<a target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/windows/apps/br211385.aspx" title="Windows Runtime JS API">Windows Runtime Apps</a>、<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/apps" title="Chrome Packaged Apps">Chrome Apps</a>、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Archive/Firefox_OS/Firefox_OS_apps/Building_apps_for_Firefox_OS" title="Firefox OS Packaged Apps">Firefox OS</a>、<a target="_blank" rel="noopener" href="http://www.openwebosproject.org/" title="Open webOS">WebOS</a>、<a target="_blank" rel="noopener" href="https://cordova.apache.org/" title="Apache Cordova">Cordova&#x2F;Phonegap</a>、<a target="_blank" rel="noopener" href="http://electron.atom.io/" title="Electron">Electron</a> 以及国内比如微信、淘宝，无数的 Hybrid 方案拔地而起，让 web 开发者可以在继续使用 web 客户端技术的同时，做到一些只有原生应用才能做到的事情，包括访问一些设备与操作系统 API，给用户带来更加 「Appy」 的体验，以及进入 App Store 等等。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/qcon-hybridzation.png"><br><em>众多的 Hybrid 方案</em></p>
<p>PWA 作为一个涵盖性术语，与过往的这些或多或少通过私有平台 API 增强 web 应用的尝试最大的不同，在于构成 PWA 的每一项基本技术，都已经或正在被 IETF、ECMA、W3C 或 WHATWG 标准化，不出意外的话，它们都将被纳入开放 web 标准，并在不远的将来得到所有浏览器与全平台的支持。我们终于可以逃出 App Store 封闭的秘密花园，重新回到属于 web 的那片开放自由的大地。</p>
<p>有趣的是，从上文中你也可以发现，组成 PWA 的各项技术的草案正是由上述各种私有方案背后的浏览器厂商或开发者直接贡献或间接影响的。可以说，PWA 的背后并不是某一家或两家公司，而是整个 web 社区与整个 web 规范。<strong>正是因为这种开放与去中心化的力量，使得万维网（World Wide Web）能够成为当今世界上跨平台能力最强、且几乎是唯一一个具备这种跨平台能力的应用平台。</strong></p>
<p><a target="_blank" rel="noopener" href="http://phonegap.com/blog/2012/05/09/phonegap-beliefs-goals-and-philosophy/" title="PhoneGap Beliefs, Goals, and Philosophy">「我们相信 Web，是因为相信它是解决设备差异化的终极方案；我们相信，当 Web 在今天做不到一件事的时候，是因为它还没来得及去实现，而不是因为他做不到。而 Phonegap，它的终极目的就是消失在 Web 标准的背后。」</a></p>
<p>在不丢失 web 的开放灵魂，在不需要依靠 Hybrid 把应用放在 App Store 的前提下，让 web 应用能够渐进式地跳脱出浏览器的标签，变成用户眼中的 App。这是 Alex Russell 在 2015 年提出 PWA 概念的<a target="_blank" rel="noopener" href="https://infrequently.org/2015/06/progressive-apps-escaping-tabs-without-losing-our-soul/" title="Progressive Web Apps: Escaping Tabs Without Losing Our Soul">原委</a>。</p>
<p>而又正因为 web 是一个整体，PWA 可以利用的技术远不止上述的几个而已：Ajax、响应式设计、JavaScript 框架、ECMAScript Next、CSS Next、Houdini、Indexed DB、Device APIs、Web Bluetooth、Web Socket、Web Payment、<a target="_blank" rel="noopener" href="https://wicg.github.io/BackgroundSync/spec/" title="Web Background Synchronization - WICG">孵化</a>中的 <a href="developers.google.com/web/updates/2015/12/background-sync" title="Background Sync - Google Developers">Background Sync API</a>、<a target="_blank" rel="noopener" href="https://streams.spec.whatwg.org/" title="Streams">Streams</a>、WebVR……开放 Web 世界 27 年来的发展以及未来的一切，都与 PWA 天作之合。</p>
<h2 id="鱼与熊掌的兼得"><a href="#鱼与熊掌的兼得" class="headerlink" title="鱼与熊掌的兼得"></a>鱼与熊掌的兼得</h2><p>经过几年来的摸索，整个互联网行业仿佛在「Web 应用 vs. 原生应用」这个问题上达成了共识：</p>
<ul>
<li>web 应用是鱼：迭代快，获取用户成本低；跨平台强体验弱，开发成本低。<strong>适合拉新</strong>。</li>
<li>原生应用是熊掌：迭代慢，获取用户成本高；跨平台弱体验强，开发成本高。<strong>适合保活</strong>。</li>
</ul>
<p>要知道，虽然用户花在原生应用上的时间要明显多于 web 应用，但其中<a target="_blank" rel="noopener" href="http://marketingland.com/report-mobile-users-spend-80-percent-time-just-five-apps-116858" title="Report: Mobile Users Spend 80 Percent Of Time In Just Five Apps">有 80% 的时间是花在前五个应用中的</a>。<a target="_blank" rel="noopener" href="http://www.recode.net/2016/9/16/12933780/average-app-downloads-per-month-comscore" title="Half of U.S. smartphone users download zero apps per month">调查显示，美国有一半的智能手机用户平均每月新 App 安装量为零</a>，而月均网站访问量却有 100 个，更别提 Google Play 上<a target="_blank" rel="noopener" href="https://youtu.be/EUthgV-U05w" title="AdWords for App Promotion - Google">有 60% 的应用从未被人下载过了</a>。于是，整个行业的产品策略清一色地<strong>「拿鱼换熊掌」</strong>，比如笔者的老东家阿里旅行（飞猪旅行），web 应用布满阿里系各种渠道，提供「优秀的第一手体验」，等你用的开心了，再引诱你去下载安装原生应用。</p>
<p><img src="/img/in-post/post-nextgen-web-pwa/PWAR-014+PWA.jpeg"><br><em>原生应用、当代 Web 与 PWA 图片来源: Hux &amp; <a target="_blank" rel="noopener" href="https://developers.google.com/web/events/pwaroadshow/">Google</a></em></p>
<p>但是，PWA 的出现，让鱼与熊掌兼得变成了可能 —— 它同时具备了 web 应用与原生应用的优点，有着自己独有的先进性：「浏览器 -&gt; 添加至主屏&#x2F;安装 -&gt; 具备原生应用体验的 PWA -&gt; 推送通知 -&gt; 具备原生应用体验的 PWA」，PWA 自身就包含着从拉新到保活的闭环。</p>
<p>除此之外，PWA 还继承了 web 应用的另外两大优点：<strong>无需先付出几十兆的下载安装成本即可开始使用</strong>，以及<strong>不需要经过应用超市审核就可以发布新版本</strong>。所以，PWA 可以称得上是一种「流式应用（Streamable App）」与「常青应用（Evergreen App）」</p>
<h2 id="未来到来了吗"><a href="#未来到来了吗" class="headerlink" title="未来到来了吗"></a>未来到来了吗</h2><p>在笔者分享 PWA 的经历中，最不愿意回答的两个问题莫过于「PWA 已经被广泛支持了吗？」以及「PWA 与 ABCDEFG 这些技术方案相比有什么优劣？」，但是这确实是两个逃不开的问题。</p>
<h3 id="PWA-的支持情况？"><a href="#PWA-的支持情况？" class="headerlink" title="PWA 的支持情况？"></a>PWA 的支持情况？</h3><p>当我们说到 PWA 是否被支持时，其实我们在说的是 PWA 背后的几个关键技术都得到支持了没有。以浏览器内核来划分的话，Blink（Chrome、Oprea、Samsung Internet 等）与 Gecko（Firefox）都已经实现了 PWA 所需的所有关键技术（👏👏👏），并已经开始探寻更多的可能性。EdgeHTML（Edge）<a target="_blank" rel="noopener" href="https://blogs.windows.com/msedgedev/2016/07/08/the-progress-of-web-apps/" title="The Progress of Web Apps - MSEdgeDev Blog">简直积极得不能更积极了</a>，所有的特性都已经处于「正在开发中」的<a target="_blank" rel="noopener" href="https://developer.microsoft.com/en-us/microsoft-edge/platform/status/" title="Microsoft Edge web platform features status">状态</a>。最大的绊脚石仍然来自于 Webkit（Safari），尤其是在 iOS 上，上述的四个 API 都未得到支持，而且由于平台限制，第三方浏览器也无法在 iOS 上支持。（<a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/WindowsForBusiness/End-of-IE-support" title="Internet Explorer End of Support">什么你说 IE？</a>）</p>
<p>不过，也不要气馁，Webkit 不但在它 <a target="_blank" rel="noopener" href="https://trac.webkit.org/wiki/FiveYearPlanFall2015">2015 年发布的五年计划</a>里提到了 Service Worker，更是已经在最近实现了 Service Worker 所<a target="_blank" rel="noopener" href="https://jakearchibald.github.io/isserviceworkerready/" title="Is Service Worker Ready?">依赖</a>的 Request、Response 与 Fetch API，还把 Service Worker 与 Web App Manifest 纷纷<a target="_blank" rel="noopener" href="https://webkit.org/status/" title="Webkit Feature Status">列入了「正在考虑」</a>的 API 中；要知道，Webkit 可是把 Web Components 中的 HTML Imports 直接<a target="_blank" rel="noopener" href="https://webkit.org/status/#specification-web-components" title="HTML Imports - Not Considering">列到「不考虑」里去了</a>……（其实 Firefox 也是）</p>
<p>更何况，由于 web 社区一直以来所追求的「渐进增强、优雅降级」，一个 PWA 当然可以在 iOS 环境正常执行。<a target="_blank" rel="noopener" href="https://cloudfour.com/thinks/why-does-the-washington-posts-progressive-web-app-increase-engagement-on-ios/" title="Why does The Washington Post’s Progressive Web App increase engagement on iOS?">事实上，华盛顿邮报将网站迁移到 PWA 之后发现，不止是 Android，在 iOS 上也获得了 5 倍的活跃度增长</a>，（无论是不是它们之前的网站写得太烂吧），就算 iOS 现在还不支持 PWA 也<a target="_blank" rel="noopener" href="https://cloudfour.com/thinks/ios-doesnt-support-progressive-web-apps-so-what/" title="iOS doesn’t support Progressive Web Apps, so what?">不会怎么样</a>，我们更是有理由相信 PWA 会很快在 iOS 上到来。</p>
<h3 id="PWA-vs-Others"><a href="#PWA-vs-Others" class="headerlink" title="PWA vs. Others"></a>PWA vs. Others</h3><p>贺老（贺师俊）曾说过：「从纯 Web 到纯 Native，之间有许多可能的点」。当考虑移动应用的技术选型时，除了 Web 与原生应用，我们还有各种不同程度的 Hybrid，还有今年爆发的诸多 JS-to-Native 方案。</p>
<p>虽然我在上文中用了「复仇」这样的字眼，不过无论从技术还是商业的角度，我们都没必要把 web 或是 PWA 放到 Native 的对立面去看。它们当然存在竞争关系，但是更多的时候，web-only 与 app-only 的策略都是不完美的，当公司资源足够的时候，我们通常会选择同时开发两者。<a target="_blank" rel="noopener" href="https://cloudfour.com/thinks/progressive-web-apps-simply-make-sense/?utm_source=mobilewebweekly&utm_medium=email#fn-4857-1" title="Progressive Web Apps Simply Make Sense">当然，无论与不与原生应用对比，PWA 让 web 应用变得体验更好这件事本身是毋庸置疑的。</a>「不谈场景聊技术都是扯淡」，<a target="_blank" rel="noopener" href="https://medium.com/@owencm/the-surprising-tradeoff-at-the-center-of-question-whether-to-build-an-native-or-web-app-d2ad00c40fb2#.ym83ct2ax" title="The surprising tradeoff at the center of the question whether to build a Native or Web App">我们仍然还是需要根据自己产品与团队的情况来决定对应的技术选型与平台策略，只是 PWA 让 web 应用在面对选型考验时更加强势了而已。</a></p>
<p><img src="/img/in-post/post-nextgen-web-pwa/qcon-trend.png"><br><em>众多的技术选型，以及笔者的一种猜测</em></p>
<p>笔者不负责任得做一些猜测：虽然<a target="_blank" rel="noopener" href="http://zhihu.com/question/31316032/answer/75236718">重量级的 Hybrid 架构与基础设施</a>仍是目前不少场景下最优的解决方案；但是随着移动设备本身的硬件性能提升与新技术的成熟与普及，JS-to-Native 与以 PWA 为首的纯 web 应用，将分别从两个方向挤压 Hybrid 的生存空间，消化当前 Hybrid 架构主要解决的问题；前者将逐渐演化为类似 Xarmarin 这样针对跨平台原生应用开发的解决方案；后者将显著降低当前 Hybrid 架构的容器开发与部署成本，将 Hybrid 返璞归真为简单的 webview 调用。</p>
<p>这种猜测当然不是没有依据的瞎猜，比如前者可以参考阿里巴巴集团级别迁移 Weex 的战略与微信小程序的 roadmap；后者则可以参考当前 Cordova 与 Ionic 两大 Hybrid 社区对 PWA 的热烈反响。</p>
<h3 id="PWA-in-China"><a href="#PWA-in-China" class="headerlink" title="PWA in China"></a>PWA in China</h3><p>看看 Google 官方宣传较多的 PWA <a target="_blank" rel="noopener" href="https://developers.google.com/web/showcase/" title="Case Studies - Google Developers">案例</a>就会发现，FlipKart、Housing.com 来自印度；Lyft、华盛顿邮报来自北美；唯一来自中国的 AliExpress 主要开展的则是海外业务。</p>
<p>由于中国的特殊性，笔者在<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/46690207/answer/104851767">第一次</a>聊到 PWA 时难免表现出了一定程度的悲观：</p>
<ul>
<li>国内较重视 iOS，而 iOS 目前还不支持 PWA。</li>
<li>国内的 Android 实为「安卓」，不自带 Chrome 是一，可能还会有其他兼容问题。</li>
<li>国内厂商可能并不会像三星那样对推动自家浏览器支持 PWA 那么感兴趣。</li>
<li>依赖 GCM 推送的通知不可用，Web Push Protocol 还没有国内的推送服务实现。</li>
<li>国内 webview 环境较为复杂（比如微信），黑科技比较多。</li>
</ul>
<p>反观印度，由于 Google 服务健全、标配 Chrome 的 Android 手机市占率非常高，PWA 的用户达到率简直直逼 100%，也难免获得无数好评与支持了。<strong>笔者奢望着本文能对推动 PWA 的国内环境有一定的贡献。</strong>不过无论如何，PWA 在国内的春天可能的确会来得稍微晚一点了。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>「<a target="_blank" rel="noopener" href="https://huangxuan.me/pwa-qcon2016/#/99" title="PWA@QCon2016 #97">我们信仰 Web，不仅仅在于软件、软件平台与单纯的技术</a>，还在于<a target="_blank" rel="noopener" href="http://phonegap.com/blog/2012/05/09/phonegap-beliefs-goals-and-philosophy/" title="PhoneGap Beliefs, Goals, and Philosophy">『任何人，在任何时间任何地点，都可以在万维网上发布任何信息，并被世界上的任何一个人所访问到。』而这才是 web 的最为革命之处，堪称我们人类，作为一个物种的一次进化。</a>」</p>
<p>请不要让 web 再<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/22561084" title="Web 在继续离我们远去">继续离我们远去</a>，浏览器厂商们已经重新走到了一起，而下一棒将是交到我们 web 应用开发者的手上。<a href="youtu.be/y1B2c3ZD9fk?t=1h14m48s" title="WWDC 2017">乔布斯曾相信 web 应用才移动应用的未来</a>，那就让我们用代码证明给这个世界看吧。</p>
<p><strong>让我们的用户，也像我们这般热爱 web 吧。</strong></p>
<p>黄玄，于 12 月的北京。</p>
<hr>
<p><em>注：在笔者撰文期间，Google 在 Google China Developers Days 上宣布了 developers.google.cn 域名的启用，方便国内开发者访问。对于文中所有链向 developers.google.com 的参考文献，应该都可以在 cn 站点中找到。</em></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2016-11-20-sw-101-gdgdf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016-11-20-sw-101-gdgdf/" class="post-title-link" itemprop="url">Service Worker 101「GDG DevFest 2016 北京」</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-11-20 00:00:00" itemprop="dateCreated datePublished" datetime="2016-11-20T00:00:00+00:00">2016-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>下滑这里查看更多内容</p>
</blockquote>
<p>TLDR; It covers lots of cool stuff about Service Worker!</p>
<h3 id="Watching-Fullscreen-→"><a href="#Watching-Fullscreen-→" class="headerlink" title="Watching Fullscreen → "></a><a target="_blank" rel="noopener" href="https://huangxuan.me/sw-101-gdgdf/">Watching Fullscreen → </a></h3><div class="visible-md visible-lg">
    <img src="//huangxuan.me/sw-101-gdgdf/attach/qrcode.png" width="350" />
    <small class="img-hint">Scanning on mobile</small>
</div>



<h3 id="Demo-Code-→"><a href="#Demo-Code-→" class="headerlink" title="Demo Code → "></a><a target="_blank" rel="noopener" href="https://github.com/Huxpro/sw-101-gdgdf">Demo Code → </a></h3><ul>
<li>Hello World of Service Worker</li>
<li>Make your own Offline Dinosaurs</li>
<li>Stale&#x2F;Fastest while revalidate</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><p>This slides is powered by <a target="_blank" rel="noopener" href="http://yanshuo.io/">Yanshuo.io (演说.io)</a>, a online software helping you create, store and share web slides. </p>
<p>There are 2 ways that you can fork or contribute this project:</p>
<ol>
<li><code>index.html</code> is the HTML source code exported from <a target="_blank" rel="noopener" href="http://yanshuo.io/">Yanshuo.io</a>, and many of its dependencis (js, css, fonts) are still linked to CDN of <a target="_blank" rel="noopener" href="http://yanshuo.io/">Yanshuo.io</a>. You can do any secondary development and host it by yourself.</li>
<li>Download the project file under <code>shuo/</code>, drag it into <a target="_blank" rel="noopener" href="http://yanshuo.io/">Yanshuo.io</a>, and you are ready to go. You can edit whatever you want, upload it to your account, and even share your distributions.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2016-10-20-pwa-qcon2016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016-10-20-pwa-qcon2016/" class="post-title-link" itemprop="url">Progressive Web Apps，复兴序章「QCon 上海 2016」</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-10-20 00:00:00" itemprop="dateCreated datePublished" datetime="2016-10-20T00:00:00+00:00">2016-10-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>下滑这里查看更多内容</p>
</blockquote>
<h3 id="Watching-Fullscreen-→"><a href="#Watching-Fullscreen-→" class="headerlink" title="Watching Fullscreen →"></a><a target="_blank" rel="noopener" href="https://huangxuan.me/pwa-qcon2016/">Watching Fullscreen →</a></h3><h3 id="Watching-Video-→"><a href="#Watching-Video-→" class="headerlink" title="Watching Video →"></a><a target="_blank" rel="noopener" href="http://www.infoq.com/cn/presentations/progressive-web-app">Watching Video →</a></h3><div class="visible-md visible-lg">
    <img src="//huangxuan.me/pwa-qcon2016/attach/qrcode.png" width="350" />
    <small class="img-hint">Scanning on mobile</small>
</div>


<h3 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h3><ul>
<li>The State Of Web</li>
<li>Rethinking Hybridzation</li>
<li>PWA 101<ul>
<li>Definition</li>
<li>Add To HomeScreen<ul>
<li>Web Manifest</li>
</ul>
</li>
<li>Reliable Experience (Network as PE)<ul>
<li>Service Worker<ul>
<li>Register SW</li>
<li>On Install &amp; Cache API<ul>
<li>ExtendableEvent &amp; SkipWaiting</li>
</ul>
</li>
<li>On Fetch</li>
<li>Stale-While-Revalidate &amp; Fallback</li>
<li>Updating SW</li>
<li>SW LifeCycle</li>
<li>On Activate</li>
<li>SW Brings Architectural Revolution</li>
</ul>
</li>
</ul>
</li>
<li>Re-engageable</li>
</ul>
</li>
<li>PWA In Production <ul>
<li>User Expectation &amp; Guiding</li>
<li>Low Deliver Friction</li>
</ul>
</li>
<li>PWA vs. Others</li>
<li>The Belief In Web<ul>
<li>One Web</li>
<li>Fulfill WWDC 2007</li>
</ul>
</li>
</ul>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><p>This slides is powered by <a target="_blank" rel="noopener" href="http://yanshuo.io/">Yanshuo.io (演说.io)</a>, a online software helping you create, store and share web slides. </p>
<p><code>index.html</code> is the HTML source code exported from <a target="_blank" rel="noopener" href="http://yanshuo.io/">Yanshuo.io</a>, and many of its dependencis (js, css, fonts) are still linked to CDN of <a target="_blank" rel="noopener" href="http://yanshuo.io/">Yanshuo.io</a>. You can do any secondary development and host it by yourself.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2016-06-05-pwa-in-my-pov/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016-06-05-pwa-in-my-pov/" class="post-title-link" itemprop="url">Progressive Web App 之我见</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-06-05 00:00:00" itemprop="dateCreated datePublished" datetime="2016-06-05T00:00:00+00:00">2016-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>下滑这里查看更多内容</p>
</blockquote>
<h3 id="Watching-Fullscreen-→"><a href="#Watching-Fullscreen-→" class="headerlink" title="Watching Fullscreen →"></a><a target="_blank" rel="noopener" href="https://huangxuan.me/pwa-in-my-pov/">Watching Fullscreen →</a></h3><div class="visible-md visible-lg">
    <img src="//huangxuan.me/pwa-in-my-pov/attach/qrcode.png" width="350" />
    <small class="img-hint">Scanning on mobile</small>
</div>


<h3 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h3><ul>
<li>WHAT is Progressive Web App?</li>
<li>1 - Installability</li>
<li>2 - App Shell</li>
<li>3 - Offline<ul>
<li>SERVICE WORKER!</li>
</ul>
</li>
<li>4 - Re-engageable<ul>
<li>Push Notification</li>
</ul>
</li>
<li>CONS in my pov</li>
<li>PROS in my pov</li>
<li>Why Web?</li>
</ul>
<h3 id="Power-by-Yanshuo-io（演说-io）"><a href="#Power-by-Yanshuo-io（演说-io）" class="headerlink" title="Power by Yanshuo.io（演说.io）"></a>Power by <a target="_blank" rel="noopener" href="https://yanshuo.io/">Yanshuo.io（演说.io）</a></h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2016-02-01-React-vs-Angular2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016-02-01-React-vs-Angular2/" class="post-title-link" itemprop="url">「译」React vs Angular 2：冰与火之歌</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-02-01 12:00:00" itemprop="dateCreated datePublished" datetime="2016-02-01T12:00:00+00:00">2016-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>这篇文章转载自<a target="_blank" rel="noopener" href="http://zhuanlan.zhihu.com/FrontendMagazine/20549104">我在知乎专栏「前端外刊评论」上发表的文章</a>。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://angular.io/">Angular 2</a> 已经发布 Beta 版，而且似乎很有信心在 2016 年成为热门框架。是时候进行一场巅峰对决了，我们来看看它如何与 <a target="_blank" rel="noopener" href="https://facebook.github.io/react/">React</a> 这个 2015 年的新宠抗衡。</p>
<p><strong>免责声明：</strong>我之前很喜欢使用 Angular 1，不过在 2015 年转到了 React。最近我也在 Pluralsight 上发布了一门关于 <a target="_blank" rel="noopener" href="https://www.pluralsight.com/courses/react-flux-building-applications">React 和 Flux 的课程</a>（<a target="_blank" rel="noopener" href="http://app.pluralsight.com/signup">免费试学</a>）。所以，<strong>是的，我本人是有偏见的，但我不会偏袒任何一方。</strong></p>
<p>好了，我们开始吧，这场对决将会非常血腥。</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*MRPl_SNuRGJchb6eOAnkSA.jpeg"></p>
<p>图片来源：<a target="_blank" rel="noopener" href="https://twitter.com/jwcarroll">@jwcarrol</a></p>
<h2 id="两者根本不具有可比性！"><a href="#两者根本不具有可比性！" class="headerlink" title="两者根本不具有可比性！"></a>两者根本不具有可比性！</h2><p>是的是的，Angular 是框架，React 是类库。所以有人觉得比较这两者没有逻辑性可言。大错特错！</p>
<blockquote>
<p>选择 Angular 还是 React 就像选择直接购买成品电脑还是买零件自己组装一样。</p>
</blockquote>
<p>两者的优缺点本文都会提及，我会拿 React 语法和组件模型跟 Angular 的语法和组件模型做对比。这就像是拿成品电脑的 CPU 跟零售的 CPU 做对比，没有任何不妥。</p>
<h2 id="Angular-2-的优点"><a href="#Angular-2-的优点" class="headerlink" title="Angular 2 的优点"></a>Angular 2 的优点</h2><p>我们先看 Angular 相对 React 有哪些优势。</p>
<h4 id="无选择性疲劳"><a href="#无选择性疲劳" class="headerlink" title="无选择性疲劳"></a><strong>无选择性疲劳</strong></h4><p>Angular 是一个完整的框架，本身就提供了比 React 多得多的建议和功能。而要用 React，开发者通常还需要借助别的类库来打造一个真正的应用。比如你可能需要额外的库来处理路由、强制单向数据流、进行 API 调用、做测试以及管理依赖等等。要做的选择和决定太多了，让人很有压力。这也是为什么 React 有那么多的入门套件的原因（我自己就写了两个：<a target="_blank" rel="noopener" href="https://github.com/coryhouse/react-flux-starter-kit">1</a>、<a target="_blank" rel="noopener" href="https://github.com/coryhouse/react-slingshot">2</a>）。</p>
<p>Angular 自带了不少主张，所以能够帮助你更快开始，不至于因为要做很多决定而无所适从。这种强制的一致性也能帮助新人更快适应其开发模式，并使得开发者在不同团队间切换更具可行性。</p>
<p>Angular 核心团队让我非常欣赏的一点是，他们拥抱了 TypeScript，这就造成了另一个优势。</p>
<h4 id="TypeScript-阳关大道"><a href="#TypeScript-阳关大道" class="headerlink" title="TypeScript &#x3D; 阳关大道"></a>TypeScript &#x3D; 阳关大道</h4><p>没错，并非所有人都喜欢 TypeScript，但是 Angular 2 毅然决然地选择了它确实是个巨大的优势。反观 React，网上的各种示例应用令人沮丧地不一致——ES5 和 ES6 的项目基本上各占一半，而且目前存在<a target="_blank" rel="noopener" href="http://jamesknelson.com/should-i-use-react-createclass-es6-classes-or-stateless-functional-components/">三种不同的组件声明方式</a>。这无疑给初学者造成了困惑。（Angular 还拥抱了装饰器（decorator）而不是继承（extends）——很多人认为这也是个加分项）。</p>
<p>尽管 Angular 2 并不强制使用 TypeScript，但显然的是，Angular 的核心团队默认在文档中使用 TypeScript。这意味着相关的示例应用和开源项目更有可能保持一致性。Angular 已经提供了<a target="_blank" rel="noopener" href="https://angular.io/docs/ts/latest/quickstart.html">非常清晰的关于如何使用 TypeScript 编译器的例子</a>。（诚然，目前<a target="_blank" rel="noopener" href="http://angularjs.blogspot.com/2015/09/angular-2-survey-results.html">并非所有人都在拥抱 TypeScript</a>，但我有理由相信等到正式发布之后，TypeScript 会成为事实上的标准）。这种一致性应该会帮助初学者避免在学习 React 时遇到的疑惑和选择困难。</p>
<h4 id="极少的代码变动"><a href="#极少的代码变动" class="headerlink" title="极少的代码变动"></a>极少的代码变动</h4><p>2015 年是 <a target="_blank" rel="noopener" href="https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4#.559iqxb39">JavaScript 疲劳</a>元年，React 可以说是罪魁祸首。而且 React 尚未发布 1.0，所以未来还可能有很多变数。React 生态圈依旧在快速地变动着，尤其是<a target="_blank" rel="noopener" href="https://github.com/kriasoft/react-starter-kit/issues/22">各种 Flux 变种</a>和<a target="_blank" rel="noopener" href="https://github.com/rackt/react-router">路由</a>。也就是说，你今天用 React 写的所有东西，都有可能在 React 1.0 正式发布后过时，或者必须进行大量的改动。</p>
<p>相反，Angular 2 是一个对已经成熟完整框架（Angular 1）的重新发明，而且经过仔细、系统的设计。所以 Angular 不大可能在正式发布后要求已有项目进行痛苦的代码变动。Angular 作为一个完整的框架，你在选择它的时候，也会信任其开发团队，相信他们会认真决定框架的未来。而使用 React，一切都需要你自己负责，你要自己整合一大堆开源类库来打造一个完整的应用，类库之间互不相干且变动频繁。这是一个令人沮丧的耗时工作，而且永远没有尽头。</p>
<h4 id="广泛的工具支持"><a href="#广泛的工具支持" class="headerlink" title="广泛的工具支持"></a><strong>广泛的工具支持</strong></h4><p>后面我会说，我认为 React 的 JSX 是非常耀眼的亮点。然而要使用 JSX，你需要选择支持它的工具。尽管 React 已经足够流行，工具支持不再是什么问题，但诸如 IDE 和 lint 工具等新工具还不大可能很快得到支持。Angular 2 的模版是保存在一个字符串或独立的 HTML 文件中的，所以不要求特殊的工具支持（不过似乎 Angular 字符串模版的智能解析工具已经呼之欲出了）。</p>
<h4 id="Web-Components-友好"><a href="#Web-Components-友好" class="headerlink" title="Web Components 友好"></a>Web Components 友好</h4><p>Angular 2 还拥抱了 Web Component 标准。唉，真尴尬我居然一开始忘记提到这点了——最近我还发布了一门关于<a target="_blank" rel="noopener" href="https://www.pluralsight.com/courses/web-components-shadow-dom">Web Components 课程</a>呢！简单来说，把 Angular 2 组件转换成原生 Web Components 应该会比 React 组件容易得多。固然 Web Components 的<a target="_blank" rel="noopener" href="http://jonrimmer.github.io/are-we-componentized-yet/">浏览器支持度依然很弱</a>，但长期来看，对 Web Components 友好是很大的优势。</p>
<p>Angular 的实现有其自身的局限和陷阱，这正好让我过渡到对 React 优势的讨论。</p>
<h3 id="React-的优点"><a href="#React-的优点" class="headerlink" title="React 的优点"></a>React 的优点</h3><p>现在，让我们看看是什么让 React 如此与众不同。</p>
<h4 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a><strong>JSX</strong></h4><p>JSX 是一种类似 HTML 的语法，但它实际上会被编译成 JavaScript。将标签与代码混写在同一个文件中意味着输入一个组件的函数或者变量时你将享受到自动补全的福利。而 Angular 基于字符串的模版就相形见绌了：很多编辑器都不会高亮它们（只会显示单色）、只有有限的代码补全支持，并且一直到运行时才会报错。并且，通常你也只能得到很有限的错误提示。不过，Angular 的团队<a target="_blank" rel="noopener" href="https://github.com/angular/angular/issues/4417">造了一个自己的 HTML 解析器来解决这个问题</a>。（叼叼叼！）</p>
<p>如果你不喜欢 Angular 的字符串模版，你可以把模版移到一个单独的文件里去。不过这样你就回到了我认为的“老样子”：你需要在自己脑袋里记住这两个文件的关联，不但没有代码自动补全，也没有任何编译时检查来协助你。这听起来可能并不算什么……除非你已经爱上了与 React 相伴的日子。在同一个文件中组合组件还能享受编译时的检查，大概是 JSX 最与众不同的地方之一了。</p>
<p><img src="http://p5.qhimg.com/d/inn/8a99f370/2.jpg"></p>
<p>对比 Angular 2 与 React 在标签忘记闭合时是如何表现的。</p>
<p>关于为什么 JSX 是一个巨大的优势，可以看看 <a target="_blank" rel="noopener" href="https://medium.com/@housecor/react-s-jsx-the-other-side-of-the-coin-2ace7ab62b98#.5007n49wq">JSX：硬币的另一面（JSX: The Other Side of the Coin）</a>. （P.S. 这是作者写的另一篇文章，如果大家希望我们可以把这篇也翻了，欢迎在评论区举手）</p>
<h4 id="React-报错清晰快速"><a href="#React-报错清晰快速" class="headerlink" title="React 报错清晰快速"></a>React 报错清晰快速</h4><p>当你在 React 的 JSX 中不小心手抖打错时，它并不会被编译。这是一件非常美妙的事情：无论你是忘记闭合了标签还是引用了一个不存在的属性（property），你都可以立刻知道到底是哪一行出错了。<strong>JSX 编译器会指出你手抖的具体行号</strong>，彻彻底底加速你的开发。</p>
<p>相反，当你在 Angular 2 中不小心敲错了一个变量时，鸦雀无声。<strong>Angular 2 并不会在编译时做什么，它会等到运行时才静默报错。</strong>它报错得<em>如此之慢</em>，我加载完整个应用然后奇怪为什么我的数据没有显示出来呢？这太不爽了。</p>
<h4 id="React-以-JavaScript-为中心"><a href="#React-以-JavaScript-为中心" class="headerlink" title="React 以 JavaScript 为中心"></a>React 以 JavaScript 为中心</h4><p>终于来了。这才是 React 和 Angular 的根本区别。<strong>很不幸，Angular 2 仍然是以 HTML 而非 JavaScript 为中心的。</strong>Angular 2 并没有解决它设计上的根本问题：</p>
<blockquote>
<p>Angular 2 继续把 “JS” 放到 HTML 里。React 则把 “HTML” 放到 JS 里。</p>
</blockquote>
<p>这种分歧带来的影响真是再怎么强调也不为过。它们从根本上影响着开发体验。Angular 以 HTML 为中心的设计留下了巨大的缺陷。正如我在 <a target="_blank" rel="noopener" href="https://medium.com/@housecor/react-s-jsx-the-other-side-of-the-coin-2ace7ab62b98#.jqh5kkxlk">JSX：硬币的另一面</a> 中所说的，JavaScript 远比 HTML 要强大。因此，<strong>增强 JavaScript 让其支持标签要比增强 HTML 让其支持逻辑要合理得多</strong>。无论如何，HTML 与 JavaScript 都需要某种方式以粘合在一起。React 以 JavaScript 为中心的思路从根本上优于 Angular、Ember、Knockout 这些以 HTML 为中心的思路。</p>
<p>让我们来看看为什么。</p>
<h4 id="React-以-JavaScript-为中心的设计-简约"><a href="#React-以-JavaScript-为中心的设计-简约" class="headerlink" title="React 以 JavaScript 为中心的设计 &#x3D; 简约"></a>React 以 JavaScript 为中心的设计 &#x3D; 简约</h4><p>Angular 2 延续了 Angular 1 试图让 HTML 更加强大的老路子。所以即使是像循环或者条件判断这样的简单任务你也不得不使用 Angular 2 的独特语法来完成。例如，Angular 2 通过两种语法同时提供了单向数据绑定与双向数据绑定，可不幸的是它们实在差得有点多：</p>


<figure class="highlight hbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">myVar</span>&#125;&#125;</span><span class="language-xml">        //单向数据绑定</span></span><br><span class="line"><span class="language-xml">ngModel=&quot;myVar&quot;  //双向数据绑定</span></span><br></pre></td></tr></table></figure>



<p>在 React 中，数据绑定语法不取决于数据流的单双向（数据绑定的单双向是在其他地方处理的，不得不说我觉得理应如此）。不管是单向还是双向数据流，绑定语法都是这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;myVar&#125;</span><br></pre></td></tr></table></figure>

<p>Angular 2 的内联母版（inline master templates）使用了这样的语法：</p>

<figure class="highlight hbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">li</span> *<span class="attr">ngFor</span>=<span class="string">&quot;#hero of heroes&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="template-variable">&#123;&#123;<span class="name">hero.name</span>&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br></pre></td></tr></table></figure>


<p>上面这个代码片段遍历了一组 hero，而我比较关心的几点是：</p>
<ul>
<li>通过星号来声明一个“母版”实在是太晦涩了</li>
<li><code>hero</code> 前的英镑符号（<code>#</code>）用于声明一个局部模版变量。这个概念感觉非常鸡肋（如果你偏好不使用 <code>#</code>，你也可以使用 <code>var-</code> 前缀写法）</li>
<li>为 HTML 加入了循环语义的HTML 特性（attribute）<code>ngFor</code> 是 Angular 特有的东西</li>
</ul>
<p>相比上面 Angular 2 的语法，React 的语法可是纯净的 JavaScript （不过我得承认下面的属性 <code>key</code> 是个 React 的私货）</p>
<figure class="highlight hbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  &#123; heroes.map(hero =&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;hero.id&#125;</span>&gt;</span>&#123;hero.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  )&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>鉴于 JS 原生支持循环，React JSX 利用 JS 的力量来做到这类事情简直易如反掌，配合 <code>map</code>、<code>filter</code> 能做的还远不止此。</p>
<p>去看看 <a target="_blank" rel="noopener" href="https://angular.io/docs/ts/latest/guide/cheatsheet.html">Angular 2 速查表</a>？那不是 HTML，也不是 JavaScript……这叫 <strong>Angular</strong>。</p>
<blockquote>
<p><strong>读懂 Angular：</strong> 学一大堆 Angular 特有的语法</p>
<p>读懂 React： 学 JavaScript</p>
</blockquote>
<p>React 因为语法和概念的简约而与众不同。我们不妨品味下当今流行的 JS 框架&#x2F;库都是如何实现遍历的：</p>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ember     : &#123;&#123;# each&#125;&#125;</span><br><span class="line">Angular 1 : ng-repeat</span><br><span class="line">Angular 2 : ngFor</span><br><span class="line">Knockout  : data-bind=&quot;foreach&quot;</span><br><span class="line">React     : 直接用 JS 就好啦 :)</span><br></pre></td></tr></table></figure>


<p>除了 React，所有其它框架都用自己的专有语法重新发明了一个我们在 JavaScript 常见得不能再常见的东西：<strong>循环</strong>。这大概就是 React 的美妙之处，利用 JavaScript 的力量来处理标签，而不是什么奇怪的新语法。</p>
<p>Angular 2 中的奇怪语法还有点击事件的绑定：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(click)=<span class="string">&quot;onSelect(hero)&quot;</span></span><br></pre></td></tr></table></figure>

<p>相反，React 再一次使用了普通的 JavaScript：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onClick=&#123;<span class="variable language_">this</span>.<span class="property">onSelect</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>, hero)&#125;</span><br></pre></td></tr></table></figure>

<p>并且，鉴于 React 内建了一个模拟的事件机制（Angular 2 也有），你并不需要去担心使用内联语法声明事件处理器所暗含的性能问题。</p>
<p>为什么要强迫自己满脑子都是一个框架的特殊语法呢？为什么不直接拥抱 JS 的力量？</p>
<h4 id="奢华的开发体验"><a href="#奢华的开发体验" class="headerlink" title="奢华的开发体验"></a>奢华的开发体验</h4><p>JSX 具备的代码自动补全、编译时检查与丰富的错误提示已经创造了非常棒的开发体验，既为我们减少了输入，与节约了时间。而配合上热替换（hot reloading）与时间旅行（time travel），你将获得前所未有的开发体验，效率高到飞起。</p>
<p>原文这里链了个 Youtube 上的视频：<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=xsSnOQynTHs&feature=youtu.be">Dan Abramov - Live React: Hot Reloading with Time Travel at react-europe 2015</a>，大家自备梯子。</p>
<h4 id="担心框架的大小？"><a href="#担心框架的大小？" class="headerlink" title="担心框架的大小？"></a>担心框架的大小？</h4><p>这里是一些常见框架&#x2F;库压缩后的大小（<a target="_blank" rel="noopener" href="https://gist.github.com/Restuta/cda69e50a853aa64912d">来源</a>）：</p>
<ul>
<li><strong>Angular 2:</strong> 566k (766k with RxJS)</li>
<li><strong>Ember:</strong> 435k</li>
<li><a target="_blank" rel="noopener" href="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"><strong>Angular 1</strong></a><strong>:</strong> 143k</li>
<li><strong>React + Redux:</strong> 139k</li>
</ul>
<p>列出的都是框架级的、用于浏览器且压缩后的大小（但并未 gzip）。需要补充的是，Angular 2 的尺寸在最终版本发布时应该会有所减小。</p>
<p>为了做一个更真实的对比，我将 Angular 2 <a target="_blank" rel="noopener" href="https://angular.io/docs/ts/latest/tutorial/">官方教程</a>中的 Tour of Heroes 应用用 Angular 2 和 React（还用上了新的 <a target="_blank" rel="noopener" href="https://github.com/coryhouse/react-slingshot">React Slingshot</a> 入门套件）都实现了一遍，结果如何呢？</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/coryhouse/angular-2-tour-of-heroes/tree/master"><strong>Angular 2</strong></a><strong>:</strong> 764k 压缩后</li>
<li><a target="_blank" rel="noopener" href="https://github.com/coryhouse/react-tour-of-heroes"><strong>React + Redux</strong></a><strong>:</strong> 151k 压缩后</li>
</ul>
<p>可以看到，<strong>做一个差不多的东西，Angular 2 目前的尺寸是 React + Redux 的五倍还多</strong>。重要的事情再说一遍，Angular 2 的最终版本应该会减重。</p>
<p>不过，我承认关于框架大小的担忧可能被夸大了：</p>
<blockquote>
<p>大型应用往往至少有几百 KB 的代码，经常还更多，不管它们是不是使用了框架。开发者需要做很多的抽象来构建一个复杂的软件。无论这些抽象是来自框架的还是自己手写的，它都会对应用的加载性能造成负面影响。  </p>
<p> 就算你完全杜绝框架的使用，许多应用仍然是几百 KB 的 JavaScript 在那。 — Tom Dale <a target="_blank" rel="noopener" href="http://tomdale.net/2015/11/javascript-frameworks-and-mobile-performance/">JavaScript Frameworks and Mobile Performance</a></p>
</blockquote>
<p>Tom 的观点是对的。像 Angular、Ember 这样的框架之所以更大是因为它们自带了更多的功能。</p>
<p>但是，我关心的点在于：很多应用其实用不到这种大型框架提供的所有功能。在这个越来越拥抱微服务、微应用、<a target="_blank" rel="noopener" href="http://www.npmjs.com/">单一职责模块（single-responsibility packages）</a>的时代，<strong>React 通过让你自己挑选必要模块，让你的应用大小真正做到量身定做</strong>。在这个有着 200,000 个 npm 模块的世界里，这点非常强大。</p>
<h4 id="React-信奉Unix-哲学"><a href="#React-信奉Unix-哲学" class="headerlink" title="React 信奉Unix 哲学."></a>React 信奉<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Unix_philosophy">Unix 哲学</a>.</h4><p>React 是一个类库。它的哲学与 Angular、Ember 这些大而全的框架恰恰相反。你可以根据场景挑选各种时髦的类库，搭配出你的最佳组合。JavaScript 世界在飞速发展，React 允许你不断用更好的类库去迭代你应用中的每个小部分，而不是傻等着你选择的框架自己升级。</p>
<p>Unix 久经沙场屹立不倒，原因就是：</p>
<blockquote>
<p>小而美、可组合、目的单一，这种哲学永远不会过时。</p>
</blockquote>
<p>React 作为一个专注、可组合并且目的单一的工具，已经被<a target="_blank" rel="noopener" href="https://github.com/facebook/react/wiki/Sites-Using-React">全世界的各大网站们</a>使用，预示着它的前途光明（当然，Angular 也被用于<a target="_blank" rel="noopener" href="https://www.madewithangular.com/#/">许多大牌网站</a>）。</p>
<h4 id="谢幕之战"><a href="#谢幕之战" class="headerlink" title="谢幕之战"></a>谢幕之战</h4><p>Angular 2 相比第一代有着长足的进步。新的组件模型比第一代的指令（directives）易学许多；新增了对于同构／服务器端渲染的支持；使用虚拟 DOM 提供了 3-10 倍的性能提升。这些改进使得 Angular 2 与 React 旗鼓相当。不可否认，它功能齐全、观点鲜明，能够显著减少 “JavaScript 疲劳” 。</p>
<p>不过，Angular 2 的大小和语法都让我望而却步。Angular 致力的 HTML 中心设计比 React 的 JavaScript 中心模型要复杂太多。在 React 中，你并不需要学习 <code>ng-什么什么</code> 这种框架特有的 HTML 补丁（shim），你只要写 JavaScript 就好了。这才是我相信的未来。</p>
<h3 id="著作权声明"><a href="#著作权声明" class="headerlink" title="著作权声明"></a>著作权声明</h3><p>本文译自 <a target="_blank" rel="noopener" href="https://medium.freecodecamp.com/angular-2-versus-react-there-will-be-blood-66595faafd51#.v4y4euy1r">Angular 2 versus React: There Will Be Blood</a>，其实<a target="_blank" rel="noopener" href="http://www.w3ctech.com/topic/1675?from=timeline&isappinstalled=0">之前有人翻译过</a>，但是翻得水平有一点不忍直视，我们不希望浪费这篇好文章。<br>本文由 <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/li-ling-hao">@李凌豪</a> <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/huxpro">@黄玄</a> 联合翻译，首次发布于<a target="_blank" rel="noopener" href="http://zhuanlan.zhihu.com/FrontendMagazine">前端外刊评论 · 知乎专栏</a>，转载请保留原文链接 ;)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2015-12-28-css-sucks-2015/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015-12-28-css-sucks-2015/" class="post-title-link" itemprop="url">都 2015 年了，CSS 怎么还是这么糟糕</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-12-28 00:00:00" itemprop="dateCreated datePublished" datetime="2015-12-28T00:00:00+00:00">2015-12-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>下滑这里查看更多内容</p>
</blockquote>
<h3 id="Watching-Fullscreen-→"><a href="#Watching-Fullscreen-→" class="headerlink" title="Watching Fullscreen →"></a><a target="_blank" rel="noopener" href="https://huangxuan.me/css-sucks-2015/">Watching Fullscreen →</a></h3><div class="visible-md visible-lg">
<img src="//huangxuan.me/css-sucks-2015/attach/qrcode.png" width="350"/>
<small class="img-hint">你也可以通过扫描二维码在手机上观看</small>
</div>


<p>这个 Web Slides 开源在<a target="_blank" rel="noopener" href="https://github.com/Huxpro/css-sucks-2015">我的 Github 上</a>，欢迎你帮助我完善这个展示文稿，你可以给我提 issue，可以 fork &amp; pull request。如果它能帮助到你了，希望你还能不吝啬 star 一下这个项目</p>
<h3 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h3><ul>
<li>Document Times<ul>
<li>Frameworks</li>
<li>Style Guide<ul>
<li><strong>OOCSS</strong></li>
<li><strong>SMACSS</strong></li>
</ul>
</li>
<li><strong>Pre-processer</strong></li>
<li><strong>PostCSS</strong></li>
</ul>
</li>
<li>Application Times<ul>
<li><strong>Shadow DOM</strong></li>
<li><strong>CSS “4”</strong></li>
<li>Naming Convention<ul>
<li><strong>BEM</strong></li>
<li><strong>SUIT</strong></li>
</ul>
</li>
<li><strong>Atomic CSS</strong></li>
<li><strong>CSS in JS</strong></li>
<li><strong>CSS Modules</strong>  <ul>
<li>Interoperable CSS</li>
</ul>
</li>
<li>PostCSS, again</li>
</ul>
</li>
<li>My Opinionated Proposal<ul>
<li><strong>POCss</strong></li>
</ul>
</li>
</ul>
<h2 id="POCss-Page-Override-Components-CSS"><a href="#POCss-Page-Override-Components-CSS" class="headerlink" title="POCss: Page Override Components CSS"></a>POCss: Page Override Components CSS</h2><h3 id="1-Scoping-Components-CSS-Blocks-should-only-be-used-inside-a-component-of-the-same-name"><a href="#1-Scoping-Components-CSS-Blocks-should-only-be-used-inside-a-component-of-the-same-name" class="headerlink" title="1. Scoping Components CSS Blocks should only be used inside a component of the same name."></a>1. Scoping Components <br><small style="line-height:2em;"><em>CSS Blocks should only be used inside a component of the same name.</em></small></h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component/index.scss</span></span><br><span class="line"><span class="selector-class">.ComponentName</span> &#123;</span><br><span class="line">    &amp;<span class="attr">--mofierName</span> &#123;&#125;</span><br><span class="line">    &amp;__decendentName &#123;</span><br><span class="line">        &amp;<span class="attr">--modifierName</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.isStateOfComponent</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Component/index.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./index.scss&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>CSS is <em>always bundled</em> with components<br>(from loading, mount to unmount)</p>
<h3 id="2-Components-can-be-Overrode-by-Pages-There-is-always-requirements-to-rewrite-styles-of-components-in-pages"><a href="#2-Components-can-be-Overrode-by-Pages-There-is-always-requirements-to-rewrite-styles-of-components-in-pages" class="headerlink" title="2. Components can be Overrode by Pages There is always requirements to rewrite styles of components in pages"></a>2. Components can be Overrode by Pages <br><small style="line-height:2em;"><em>There is always requirements to rewrite styles of components in pages</em></small></h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pages/PageA.scss</span></span><br><span class="line"><span class="selector-id">#PageA</span> &#123;</span><br><span class="line">    <span class="selector-class">.pagelet-name</span> &#123;</span><br><span class="line">        <span class="selector-class">.pagelet-descendent-name</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.ComponentName</span>&#123; <span class="comment">/* override */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pages/index.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./PageA.scss&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><em>#Page</em> for absolutely scoping between pages</li>
<li><em>.pagelet-name</em> should be lowercase to prevent conflicting with components</li>
</ul>
<h3 id="Why-POC"><a href="#Why-POC" class="headerlink" title="Why POC?"></a>Why POC?</h3><ul>
<li><p><strong>It’s technology-agnostic</strong></p>
<small>
  *One css framework can be played with whatever technology stacks*<br>
  *You can combined Scss, PostCSS and whatever you want*
</small>
</li>
<li><p><strong>Solving problems, and easy</strong></p>
<small>
  *Makes reading and teamwork much easier*<br>
  *Get all benefit from BEM, SUITCSS and others*
</small>
</li>
<li><p><strong>Leverage the power of cascading properly</strong></p>
<small>
  *Scoping components but allow reasonable overriding*<br>
  *It's pragmatic, flexible and hitting the sweet spot*
</small></li>
</ul>
<h3 id="Thanks"><a href="#Thanks" class="headerlink" title="Thanks"></a>Thanks</h3><p><a target="_blank" rel="noopener" href="http://lab.hakim.se/reveal-js">Reveal.js</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.vvbuys.com/2015-12-15-ios9-safari-web/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="vvbuys">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VVbugs Blog">
      <meta itemprop="description" content="Share some post and some issue for linux program">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | VVbugs Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2015-12-15-ios9-safari-web/" class="post-title-link" itemprop="url">「译」iOS 9，为前端世界都带来了些什么？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2015-12-15 00:00:00" itemprop="dateCreated datePublished" datetime="2015-12-15T00:00:00+00:00">2015-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 01:05:07" itemprop="dateModified" datetime="2024-02-02T01:05:07+00:00">2024-02-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>2015 年 9 月，Apple 重磅发布了全新的 iPhone 6s&#x2F;6s Plus、iPad Pro 与全新的操作系统 watchOS 2 与 tvOS 9（是的，这货居然是第 9 版），加上已经发布的 iOS 9，它们都为前端世界带来了哪些变化呢？作为一个 web 开发者，是时候站在我们的角度来说一说了！</p>
<blockquote>
<p><strong>注！</strong> 该译文存在大量英文术语，笔者将默认读者知晓 ES6、viewport、native app、webview 等常用前端术语，并不对这些已知术语进行汉语翻译<br>对于新发布或较新的产品名称与技术术语，诸如 Apple Pen、Split View 等专有名词，笔者将在文中使用其英文名，但会尝试对部分名词进行汉语标注<br>另外，出于对 wiki 式阅读的偏爱，笔者为您添加了很多额外的链接，方便您查阅文档或出处</p>
</blockquote>
<h2 id="简而言之"><a href="#简而言之" class="headerlink" title="简而言之"></a>简而言之</h2><p>如果你不想阅读整篇文章，这里为你准备了一个总结：</p>
<h4 id="新的设备特性"><a href="#新的设备特性" class="headerlink" title="新的设备特性"></a>新的设备特性</h4><ul>
<li>iPhone 6s 与 6s Plus 拥有 <strong>“<a target="_blank" rel="noopener" href="http://www.apple.com/iphone-6s/3d-touch/">3D Touch</a>”</strong>，这是一个全新的硬件特性，它可以侦测压力，是一个可以让你拿到手指压力数据的 API</li>
<li>iPad Pro 的 viewport 为 1024px，与以往的 iPad 全都不同</li>
<li>想在 iPad Pro 上支持新的 Apple Pen？不好意思，目前似乎并没有适用于网站的 API</li>
</ul>
<h4 id="新的操作系统特性（与-web-相关的）"><a href="#新的操作系统特性（与-web-相关的）" class="headerlink" title="新的操作系统特性（与 web 相关的）"></a>新的操作系统特性（与 web 相关的）</h4><ul>
<li>iPad 上的 Safari 现在可以通过 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForSlideOverAndSplitView.html#//apple_ref/doc/uid/TP40015145-CH13-SW1">Split View</a>（分屏视图）与其他应用一起使用，这意味着新的 viewport 尺寸将会越来越常见</li>
<li>新的 Safari View Controller（<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/SafariServices/Reference/SFSafariViewController_Ref/index.html#//apple_ref/occ/cl/SFSafariViewController"><code>SFSafariViewController</code></a>）可以让你在 native app 内提供与 Safari 界面、行为连贯一致的应用内网页浏览体验</li>
<li>注意啦！Safari 新加入了 Content Blocker（内容拦截器）。以后，并不是所有的访问都一定会出现在你的 Google Analytics 了</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/AppSearch/UniversalLinks.html#//apple_ref/doc/uid/TP40016308-CH12">Universal Links</a> 可以让应用的拥有者在 iOS 内部“占有”自己的域名。因此，访问 yourdomain.com 将会打开你的应用（类似 Android 的 Intents 机制）</li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/AppSearch/index.html#//apple_ref/doc/uid/TP40016308">App Search（应用搜索）</a>：现在，Apple 将会抓取你的网页内容（与 native app 内容）用于 Spotlight 与 Siri 的搜索结果，<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/AppSearch/WebContent.html#//apple_ref/doc/uid/TP40016308-CH8">想知道你的标签都兼容吗？</a></li>
<li>你的网站现在可以通过 JavaScript API 访问 iCloud 的用户数据</li>
</ul>
<h4 id="新的-API-支持"><a href="#新的-API-支持" class="headerlink" title="新的 API 支持"></a>新的 API 支持</h4><ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/timing">Performance Timing API</a> 在 iOS 9 得到回归</li>
<li>关于 HTML5 Video，你现在可以在支持 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/WindowsViews/Conceptual/AdoptingMultitaskingOniPad/QuickStartForPictureInPicture.html#//apple_ref/doc/uid/TP40015145-CH14">Picture in Picture（画中画）</a>的 iPad 设备上提供这项新功能；你的视频甚至可以在 Safari 关闭后继续播放</li>
<li>更好的 ES6 支持：classes（类）, computed properties（可计算属性）, template literals（模版字符串）等</li>
<li>Backdrop CSS filters（背景滤镜）</li>
<li>CSS @supports 与 CSS Supports JavaScript API </li>
<li>CSS Level4 伪选择器</li>
<li>用于支持分页内容的 CSS Scroll Snapping</li>
<li>WKWebView 现在可以访问本地文件了</li>
<li>我们仍然需要等待 Push Notification，camera access，Service Workers 这些现代 web API 的到来</li>
</ul>
<h4 id="新的操作系统"><a href="#新的操作系统" class="headerlink" title="新的操作系统"></a>新的操作系统</h4><ul>
<li>新一代 Apple TV 的 <strong>tvOS</strong>： 没有浏览器，也没有 webview。但是 JavaScript、XHR 和 DOM 可以通过一个叫做 TVML 的标记语言来使用</li>
<li>Apple Watch 的 <strong>watchOS</strong>：完全没有任何浏览器和 webview</li>
</ul>
<blockquote>
<p><strong>再注！</strong> 由于原文写于 Apple 发布会之前，为了不让读者感到奇怪，笔者将会对文章进行适当改写与补充，以保证本文的连贯性</p>
</blockquote>
<h2 id="新的-iOS-设备特性"><a href="#新的-iOS-设备特性" class="headerlink" title="新的 iOS 设备特性"></a>新的 iOS 设备特性</h2><h3 id="iPhones-6s-与-3D-Touch"><a href="#iPhones-6s-与-3D-Touch" class="headerlink" title="iPhones 6s 与 3D Touch"></a>iPhones 6s 与 3D Touch</h3><p>从 web 设计与开发的角度来说，新的 iPhone 6s 与 6s Plus 与之前的版本并没有太多差别。不过，有一个特性注定会吸引我们的目光：<strong>3D Touch</strong></p>
<p>我们无法确定 Apple 是不是只是重命名了一下 “Force Touch”（用于 Apple Watch、TrackPad 2 与最新的 MacBook 上）或者 3D Touch 的确是一个为 iPhone 定制的似曾相识却不同的东西。3D Touch 允许操作系统和应用侦测每一个手指与屏幕接触时的压力。从用户体验的角度来说，最大的变化莫过于当你用点力去触碰或者拖拽屏幕时，操作系统将会触发诸如 peek，pop 这些新机制。那么问题来了：<strong>我们是否能够在网站中使用这个新玩意呢？让我们一点点来看：</strong></p>
<p>iOS 9 搭载的 Safari 包含了一些用于 “Force Touch” 的新 API，但它们其实并不是那个用于 iPhone 6s 3D Touch 的 API。你可以理解为这些 API 就是 MacBook 版 Safari 里为 Force Touch 准备的那些 API ，因为共享一套 codebase，所以它理所当然得存在了 iOS 版里而已。</p>
<p>Force Touch API 为我们添加了两个新东西：</p>
<ol>
<li>你的 click 事件处理函数将会从 MouseEvent 中收到一个新的属性：<code>webkitForce</code></li>
<li>DOM 也新增了四个事件：<code>(webkit)mouseforcewillbegin</code>，<code>mouseforcedown</code>，<code>mouseforceup</code> 与 <code>mouseforcechange</code>。下边的示意图将告诉你这些事件是在何时被触发的：</li>
</ol>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/foceevents.png" alt="Force Events"></p>
<p>相信你已经从它们的名字中意识到了，这些事件都是基于鼠标而非触摸的，毕竟它们是为 MacBook 设计的。并且，TouchEvent 也并没有包含 <code>webkitForce</code> 这个属性，它仅仅存在于 MouseEvent 里。在 iOS Safari 里，你确实可以找到 <code>onwebkitmouseforce</code> 这一系列事件处理器，但是很可惜它们并不会被触发，click 返回的 MouseEvent 也永远只能得到一个 <code>webkitForce: 0</code></p>
<p>可喜可贺的是，故事还没有结束。<a target="_blank" rel="noopener" href="https://w3c.github.io/touch-events/">Touch Events v2 draft spec（触摸事件第二版草案）</a> 中正式添加了 <code>force</code> 属性。3D Touch 也得以在 iPhone 6s 与 6s+ 中通过 TouchEvent 访问到。不过，笔者也要在这里提醒大家，由于没有 <code>webkitmouseforcechange</code> 这样给力的事件，在手机上我们只能通过 <strong>轮询 TouchEvent 的做法</strong> 来不断检测压力值的改变……非常坑爹</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/fr3ino">@Marcel Freinbichler</a> 第一个在 Twitter 上晒出了自己的 <a target="_blank" rel="noopener" href="http://freinbichler.me/apps/3dtouch">Demo</a>。在 6s 或 new Macbook 的 Safari（目前仅 Safari 支持）上访问就可以看到圆圈会随着压力放大。墙内的小伙伴可以直接试试下面这个圆圈，体验下 3D&#x2F;Force Touch 带来的的奇妙体验。</p>
<iframe src="//huangxuan.me/forcify/" style="
    width:100%;
    height:500px;
    border: 0;
"></iframe>

<p>如果你不巧在用不支持 3D&#x2F;Force Touch 的设备，发现尼玛用力按下去之后居然圆圈也有反映！？</p>
<p>放心，这真的不是你的设备突然习得了“感应压力”这项技能，而是因为 <a target="_blank" rel="noopener" href="http://huangxuan.me/forcify">Forcify</a> 是一个用于在所有设备上 polyfill 3D&#x2F;Force Touch API 的 JS 库……它不但封装了 OSX&#x2F;iOS 两个平台之间 API 的差异，还使用”长按”来模拟了 <code>force</code> 值的变化……</p>
<h3 id="iPad-Pro"><a href="#iPad-Pro" class="headerlink" title="iPad Pro"></a>iPad Pro</h3><p>全新的 iPad Pro（12.9 寸）打破了以往 iPad 渲染网站的方式。在此之前，市面上所有的 iPad（从初代 iPad，到 iPad Air 4，到 iPad Mini）都是以 768px 的宽度提供 viewport。</p>
<p>而屏幕更大的 iPad Pro 选择了宽 1024px 的 viewport，这使得它天生就能容纳更多的内容。不少人说iPad Pro 就是抄 Microsft Surface Pro 的嘛……嗯哼，IE&#x2F;Edge 在 Surface Pro 上就是以 1024px 作为视口宽度的……</p>
<p>从交互的角度上来说，iPad Pro 虽然不支持 3D Touch，但是可以搭配 Smart Keyboard 与&#x2F;或 Apple Pen（带有压力侦测）使用。对于键盘其实并没有什么好说的，如果一个网站在搭配键盘的桌面电脑上好用，它在 iPad Pro 上应该也不赖。而对于 Apple Pen，很可惜，目前似乎并没有 API 能让你在网站上获得这根笔的压力与角度。</p>
<h2 id="新的-iOS-操作系统特性"><a href="#新的-iOS-操作系统特性" class="headerlink" title="新的 iOS 操作系统特性"></a>新的 iOS 操作系统特性</h2><h3 id="iPad-上的多任务处理"><a href="#iPad-上的多任务处理" class="headerlink" title="iPad 上的多任务处理"></a>iPad 上的多任务处理</h3><p>自 iOS 9 起，iPad 允许两个应用在同一时刻并肩执行，有三种方式：<strong>Slide Over</strong>，<strong>Split View</strong> 与 <strong>Picture-in-Picture</strong>。不过，每一种方式都有其硬件需求，比如说 Slide Over 需要 iPad Air, iPad Mini 2 以上的设备，而 Split View 由于对内存的要求目前只支持 iPad Air 2 与 iPad Pro。</p>
<h4 id="Slide-Over（滑过来！）"><a href="#Slide-Over（滑过来！）" class="headerlink" title="Slide Over（滑过来！）"></a>Slide Over（滑过来！）</h4><p>Slide Over 支持的 App 并不多，不过 Safari 名列其中，这意味着我们的网站将可能在这个模式下被渲染。当网站处于 Slide Over 模式下时，它将在屏幕的右 1&#x2F;4 位置渲染，并且置于其他 native app 之上。</p>
<p>这个模式也为 Responsive Web Design（响应式网站设计）提出了新的挑战：<strong>一个只为 iPad 优化的网站，也需要能在该设备上以无需手动刷新的形式支持小屏幕的渲染。</strong>因此，如果你正在使用服务器端探测（RESS），那么你的 iPad 版本需要以某种方式包含手机版本的网站，或者在进入该模式后重新加载一次。（如果你不了解 RESS，你可以观看我的<a href="/2014/11/20/responsive-web-design/">另一篇博文</a>）</p>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/slideover.png" alt="Slide Over"></p>
<p>在这个模式下，无论横屏还是竖屏，所有的 iPad（包括 Pro）都会把你的网站以 320px 的 viewport 宽度进行渲染，就好像在一个大 iPhone 5 上一样。你可以在 CSS 中通过 media query（媒体查询）探测到这个模式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* iPad Air or iPad Mini */</span></span><br><span class="line">(device-<span class="attribute">width</span>: <span class="number">768px</span>) and (width: <span class="number">320px</span>)</span><br><span class="line"><span class="comment">/* iPad Pro */</span></span><br><span class="line">(device-width: <span class="number">1024px</span>) and (width: <span class="number">320px</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Split-View（分屏视图）"><a href="#Split-View（分屏视图）" class="headerlink" title="Split View（分屏视图）"></a>Split View（分屏视图）</h4><p>在较新版本的 iPad 上，你可以将 Slide Over 的 Side View（侧视图）升级为 Split View。此时，两个应用将以相同比例在你的屏幕上同时工作。</p>
<p>在这个模式下，我们的网站将可能……</p>
<ul>
<li><strong>以屏幕 1&#x2F;3 比例渲染时</strong>，viewport 在 iPad Air&#x2F;mini 犹如 iPhone 5，宽 320px。而在 iPad Pro 上则像是 iPhone 6：宽 375px</li>
<li><strong>以屏幕 1&#x2F;2 比例渲染时</strong>，viewport 在 iPad Air&#x2F;mini 上呈现为 507px 宽，而在 iPad Pro（横屏）下呈现为 678px 宽</li>
<li><strong>以屏幕 2&#x2F;3 比例渲染时</strong>，viewport 在 iPad Air&#x2F;mini 上呈现为 694px 宽，而在 iPad Pro（横屏）下呈现为 981px 宽</li>
</ul>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/splitview.png" alt="Split View"></p>
<h4 id="Picture-in-Picture（画中画）"><a href="#Picture-in-Picture（画中画）" class="headerlink" title="Picture in Picture（画中画）"></a>Picture in Picture（画中画）</h4><p>在一些较新版本的 iPad 上，使用 HTML5 video 标签的网站可以将其暴露到 Picture in Picture 机制中。通过 API（本文稍后会讲）或用户的触发，视频可以独立于网站在其他应用的上方继续播放。</p>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/pip.png" alt="Picture in Picture"></p>
<h3 id="iOS-9-下的响应式网页设计"><a href="#iOS-9-下的响应式网页设计" class="headerlink" title="iOS 9 下的响应式网页设计"></a>iOS 9 下的响应式网页设计</h3><p>下图向你展示了 iOS 9 所有可能的 viewport 尺寸，检查检查你的响应式断点都包含它们了吗？</p>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/ios9rwd.png" alt="iOS 9 RWD"></p>
<h3 id="Safari-View-Controller"><a href="#Safari-View-Controller" class="headerlink" title="Safari View Controller"></a>Safari View Controller</h3><p>如果你用过 Twitter 或者 Facebook（或者微信，微博……），那么你一定知道很多 native app 在打开一个网页链接时并不会默认使用 Safari。它们试图让你留在它们的应用里，所以通过提供 webview 让你在应用内进行网页浏览。可是问题在于，这类 webview 并不会与浏览器共享 cookies，sessions，autofill（自动填充）与 bookmark（书签），为了解决这些问题，就有了 Safari View Controller。</p>
<p>现在，native app 可以使用 Safari View Controller 来打开网站，它提供与 Safari 完全一致的隐私政策、local storage，cookies、sessions 同时让用户留在你的 app 中，它通过一个 “Done”（完成）按钮使用户可以回到 native app 的上一个 controller。这个全新的 controller 还可以让我们在 Share（分享）按钮上添加自定义的操作，这些操作在用户使用 Safari 应用时并不会出现。同时，native app 对这个自定义 Safari 实例具有完全的内容控制，你可以屏蔽不想被渲染的内容。</p>
<p>当你需要基于 web 的鉴权，比如 OAuth 时，使用 Safari View Controller 同样是一个好主意，这样就不再需要打开浏览器再重定向回你的应用。不过注意了，Safari View Controller 只适用于在线、公开的 web 内容。如果你的 web 内容假设在本地或者私服，那么 WKWebView 仍然是最推荐的选择。</p>
<blockquote>
<p>笔者八卦一下，Safari View Controller 实际上也算是半个社区推进的产物。早在 2014 年 12 月，Tumblr 的 iOS 工程师 Bryan 就发表了一篇著名的 <a target="_blank" rel="noopener" href="http://bryan.io/post/104845880796/we-need-a-safari-view-controller">We need a “Safari view controller”</a> 叙述现有 webview 在第三方登录鉴权时的窘境。<br>2015 年 6 月，Apple Safari 工程师 Ricky Mondello 的 Twitter 宣告了这个设想的落地：You all asked for it. Come see me introduce it. Introducing Safari View Controller 1:30 PM, Tuesday. Nob Hill.</p>
</blockquote>
<h3 id="Safari-Content-Blockers"><a href="#Safari-Content-Blockers" class="headerlink" title="Safari Content Blockers"></a>Safari Content Blockers</h3><p>现在，iOS 9 上的 Safari 支持一种全新的 App Extensions（应用拓展）：<strong>Content Blocker</strong>（内容拦截器）。这类拓展以 native app 的形式存在，你可以在 App Store 上下载到，它们可以拦截 Safari 内的任何内容，包括：跟踪器、广告、自定义字体、大图片、JavaScript 文件等等。</p>
<p>作为 web 开发者，尽管我们不能禁用 Content Blocker，我们仍然应该注意到它们的存在。诸如 Crystal 的一些拦截器宣称他们<a target="_blank" rel="noopener" href="http://murphyapps.co/blog/2015/8/22/crystal-benchmarks">可以提高网页的打开速度</a>。Crystal 声称可以加快网页的加载速度 3.9 倍并且少用 53% 的带宽。不过问题是：到底哪些东西被拦截器拦截了？<a target="_blank" rel="noopener" href="http://thenextweb.com/apple/2015/08/27/content-blocking-in-ios-9-is-going-to-screw-up-way-more-than-just-ads/">这篇文章</a>提到了一些我们未来可能会遇到的问题。</p>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/crystal.png" alt="crystal"></p>
<p>在 iOS 9 发布后，Peace，一个 Content Blocker，曾在 App Store 排名跻身前十。从用户的角度来说，如果一个网站由于被 Content Blocker 拦截了某些重要资源而不能正常工作，你可以长按重新加载按钮并且以不启用 Content Blocker 的方式重新加载这个网站（见下图，来自 MacWorld.com）</p>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/macworld.png" alt="disable content blocker"></p>
<p>Content Blocker 能隐藏元素，也有能力通过 CSS 选择器、域名、类型、或者 URL 来过滤并拦截某个文件的加载，<a target="_blank" rel="noopener" href="https://itunes.apple.com/us/app/purify-blocker-fast-clutter/id1030156203?ls=1&mt=8">Purify Blocker</a> 给用户提供了拦截某一种内容类型的进阶选项，比如 Web Fonts。</p>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/purify.png" alt="purify"></p>
<h3 id="WKWebView-的增强"><a href="#WKWebView-的增强" class="headerlink" title="WKWebView 的增强"></a>WKWebView 的增强</h3><p>UIWebView 已经被官方弃用，虽然它还在在那，不过它再也不会得到什么升级。与此相反，WKWebView 正在取代它的位置。一个最受期待的特性现在终于推出：加载本地文件到 WKWebView。因此，现在 Apache Cordova 应用与其他 web 内容都可以直接从 iOS 包中使用本地文件了，不再需要各种诡异的 hack 了。</p>
<p>此外，还有一些新特性也一并推出。比如说，通过 WKWebsiteDataStore，Objective-C 或 Swift 有能力查询与管理 webview 的本地存储（比如 localStorage 或 IndexedDB）。这就允许我们将原有的数据存储替换成新的某些东西，比如说替换成一个不永久的（Chrome for iOS 的隐身模式就需要这种东西）</p>
<h3 id="Universal-Links（通用链接）"><a href="#Universal-Links（通用链接）" class="headerlink" title="Universal Links（通用链接）"></a>Universal Links（通用链接）</h3><p>如果你既有一个网站，又有一个 native app，你现在可以通过 Universal Links 来增强用户体验。它允许你在操作系统内“占有”自己的域名，这样，一切指向你网站的链接都会被重定向到你的 app。</p>
<p>目前，所有的 app 都是通过自定义 URI 来达到这个效果的，比如 <code>comgooglemaps://</code> 就可以用来从网站或者其他原生 iOS 应用中打开 Google Maps。</p>
<p>想要提供这个特性的话，你首先需要在 native app 中实现 Deep Linking（深度链接），让应用中的内容与 Safari 的 URL 吻合。然后，你需要在 Apple 的网站上关联你的域名，取得这个域名的 SSL 认证并且把签名后的 JSON 部署到该域名上。这是为了防止第三方的应用“占据”了属于你而不属于他们的域名，比如说 twitter.com 被非 Twitter 的其他应用占据掉。</p>
<p>目前唯一的缺点是用户好像并不能决定到底以哪种方式来打开内容（使用 web 还是 app），不过我们可以观望一段时间看看它会如何发展。在不远的这段时间里，你可能会发现在网站或 Google 搜索里点击一个链接时会没有任何预警的就跳进了 native app 里。</p>
<h3 id="App-Search（应用搜索）"><a href="#App-Search（应用搜索）" class="headerlink" title="App Search（应用搜索）"></a>App Search（应用搜索）</h3><p>Apple 带着自己的 web 蜘蛛杀进了搜索的市场，而我们需要支持它得以在 Siri 与 Spotlight 中提升自己的曝光率。这在我们同时拥有网站与 app 时尤为重要，因为现在 Apple 会索引你网站的内容，但打开时却可能将用户带到了 app 里去。</p>
<p>尽管这会开启 SEO 的新篇章，不过却相当容易。你需要使用一些标签标准，诸如 <a target="_blank" rel="noopener" href="http://schema.org/">Web Schema</a>、<a target="_blank" rel="noopener" href="http://applinks.org/">AppLinks</a>、<a target="_blank" rel="noopener" href="http://ogp.me/">OpenGraph</a> 或者 <a target="_blank" rel="noopener" href="https://dev.twitter.com/cards/mobile">Twitter Cards</a>，配合上 App Banner 与 <code>app-argument</code>，如果你有你自己的 native app 的话。</p>
<blockquote>
<p>关于“让你的网页支持 Apple 搜索”的更多详情，请查阅 Apple 官方文档 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/AppSearch/WebContent.html#//apple_ref/doc/uid/TP40016308-CH8-SW5">Mark Up Web Content</a></p>
</blockquote>
<p>Apple 刚刚发布了一个 <a target="_blank" rel="noopener" href="https://search.developer.apple.com/appsearch-validation-tool/">App Search Validation Tool（应用搜索验证工具）</a>来帮助你搞清楚，需要向你的网站添加什么才能支持 App Search</p>
<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/appsearch-1024x467.png" alt="App Search"></p>
<h3 id="CloudKit-JS"><a href="#CloudKit-JS" class="headerlink" title="CloudKit JS"></a>CloudKit JS</h3><p>如果你拥有一个 native app，你很可能会将用户数据保存在 iCloud 上。在过去，只有 iOS 与 Mac 应用被允许使用它。现在，通过 CloudKit JS，你的网站也可以连接上 iCloud 数据了。</p>
<h3 id="Back-Button"><a href="#Back-Button" class="headerlink" title="Back Button"></a>Back Button</h3><p>现在，当你链接到一个 native app 时（通过自定义 URI 或者 Universal Link），Safari 会询问用户是否想要使用 native app 打开这个链接（见下图）。如果用户同意了，这个应用将被打开，并且在左上角会有一个返回按钮可以返回 Safari ，返回到你的网站。</p>
<img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/back.png" alt="backbutton" width="320" />

<h2 id="新的-API-支持-1"><a href="#新的-API-支持-1" class="headerlink" title="新的 API 支持"></a>新的 API 支持</h2><h3 id="Navigation-Timing-API"><a href="#Navigation-Timing-API" class="headerlink" title="Navigation Timing API"></a>Navigation Timing API</h3><p>Navigation Timing API 在 iOS 9 迎来了回归。让我们回忆一下，这货添加于 8.0 却在一周后的 8.1 中去掉了。这对于 Web 性能是个好消息。通过这个 API，我们可以更精确的测量时间，还可以获得一系列有关加载过程的时间戳，它们对于追踪与在真实场景中做决策来改进用户体验都非常有用。</p>
<h3 id="Picture-in-Picture"><a href="#Picture-in-Picture" class="headerlink" title="Picture in Picture"></a>Picture in Picture</h3><p>PiP API（被称为 Presentation Mode API）目前只支持 iOS，它允许我们手动让一个 <code>&lt;video&gt;</code> 元素进入或离开 PiP 模式如果 <code>video.webkitSupportsPresentationMode</code> 是支持的。</p>
<p>举个例子，我们可以在内嵌模式与 PiP 模式中切换：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">video.<span class="title function_">webkitSetPresentationMode</span>(</span><br><span class="line">    video.<span class="property">webkitPresentationMode</span> === <span class="string">&quot;picture-in-picture&quot;</span> ?</span><br><span class="line">    <span class="string">&quot;inline&quot;</span> : </span><br><span class="line">    <span class="string">&quot;picture-in-picture&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>我们还可以通过新的 <code>onwebkitpresentationmodechanged</code> 事件来检测 Presentation Mode（展示模式）的变化。</p>
<h3 id="Backdrop-CSS"><a href="#Backdrop-CSS" class="headerlink" title="Backdrop CSS"></a>Backdrop CSS</h3><p>iOS 7 与最近的 Mac OS 使用 Backdrop filter（背景滤镜）来模糊背景（指 native 开发），而在网站上实现这个却并不容易。</p>
<p>iOS 9 上的 Safari 现在支持了来自 Filter Effect v2 spec（滤镜特效第二版规范）的 <strong>backdrop-filter</strong>。比如说，我们可以使用一个半透明的背景并且对其背后的背景使用滤镜：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">header</span> &#123;</span><br><span class="line">   <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">   -webkit-backdrop-<span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">5px</span>);</span><br><span class="line">   backdrop-<span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">5px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/backdrop.png" alt="backdrop"></p>
<h3 id="CSS-Scroll-Snapping"><a href="#CSS-Scroll-Snapping" class="headerlink" title="CSS Scroll Snapping"></a>CSS Scroll Snapping</h3><p>在 web 上实现分页内容（比如相册跑马灯）总是非常麻烦，无论是使用 JavaScript 框架、touch 事件还是 hacking 滚动条等等。Apple 新添加了一个很赞的 CSS 特性叫做 CSS Scroll Snapping。这个特性新增了一系列的 CSS 属性让你定义规则或者不规则的 snap zone（停留区域），这样滚动的位置就会“啪”地一下停在这个区域，而非像以前一样可以停在任何地方。  </p>
<p>来看个例子：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#photo-gallery</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow-x</span>: scroll;</span><br><span class="line">    -webkit-scroll-snap-points-x: <span class="built_in">repeat</span>(<span class="number">100%</span>);</span><br><span class="line">    -webkit-<span class="attribute">scroll-snap-type</span>: mandatory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>想要看个跑起来后的例子？笔者为大家准备了 webkit 的官方 <a target="_blank" rel="noopener" href="http://www.webkit.org/demos/scroll-snap/">demo</a>，不过这个属性目前只支持 iOS 9 Safari 哦，并不支持 webview</p>
</blockquote>
<h3 id="CSS-Supports"><a href="#CSS-Supports" class="headerlink" title="CSS Supports"></a>CSS Supports</h3><p>CSS Supports，包括 CSS <code>@supports</code> 与来自 CSS Conditional Rules Module Level 3 spec 的 JavaScript CSS Supports API 都在 iOS 上迎来降临。现在，我们可以针对某个 CSS 属性的特定值的支持情况来编写代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@supports</span>(-webkit-scroll-snap-type: mandatory) &#123;</span><br><span class="line">    <span class="comment">/* we use it */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样，使用 JavaScript：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable constant_">CSS</span>.<span class="title function_">supports</span>(<span class="string">&quot;-webkit-scroll-snap-type&quot;</span>, <span class="string">&quot;mandatory&quot;</span>)) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一些细微的改进"><a href="#一些细微的改进" class="headerlink" title="一些细微的改进"></a>一些细微的改进</h3><ul>
<li>ECMAScript 6 的更完善支持：classed、computed properties、template literial 与 week sets</li>
<li>新的 CSS Level4 伪类&#x2F;元素选择器：<code>:not</code>、<code>:matches</code>、<code>:any-link</code>、<code>:placeholder-shown</code>、<code>:read-write</code>、<code>:read-only</code></li>
<li>Native app 现在可以通过 extension 来向 Safari 的 Shared Links（分享链接）窗口上注入信息</li>
<li>大量无前缀 CSS 属性的支持（终于），比如 transition、animation、@keyframes、flex 与 columns</li>
<li>Mac OS El Capitán 上的 Safari 9 提供了一个全新设计的 Web Inspector（Web 检查器）。幸运的是，iOS 9 的远程调试完全兼容 Mac OS 上的 Safari 8，所以你倒是不用急着升级你的 Mac OS</li>
<li>iOS 9 通过 <code>-apple-font</code> 加入了一些 Dynamic Fonts（动态字体），并且它们现在应用的是 Apple 的新字体：San Francisco，笔者的博客就已经用上它啦</li>
<li>scrollingElement 现在可用了</li>
<li><code>&lt;input type=file&gt;</code> 现在允许你从 iCloud Drive 与已安装的第三方应用，比如 Google Drive 中选择文件</li>
</ul>
<img src="http://www.mobilexweb.com/wp-content/uploads/2015/09/IMG_2017.png" alt="input file" width="320" />

<ul>
<li>当你加载一个 HTTPS 协议的页面时，你不能混用 HTTP 与 HTTPS 的资源</li>
</ul>
<h2 id="Bugs"><a href="#Bugs" class="headerlink" title="Bugs"></a>Bugs</h2><p>Bug 通常都要在几周之后才会显露出来，我也会持续跟进并更新这篇文章。目前为止，我的发现如下：</p>
<ul>
<li>对于 Home Screen webapps（添加至主屏的 web 应用），<code>apple-mobile-web-app-status-bar-style</code> 这个 meta 标签不起作用了！所以你现在不能再像过去一样使用 <code>black-translucent</code> 让你的 webapp 渲染在状态栏的后面了。（iOS 9.2 fixed 了这个 bug）</li>
<li>Speech Synthesis API （语音综合 API）不再工作了</li>
</ul>
<h2 id="仍在等待……"><a href="#仍在等待……" class="headerlink" title="仍在等待……"></a>仍在等待……</h2><p>当 Mac 上的 Safari、桌面电脑与 Android 上的 Chrome 都已经为网站支持 Push Notification （通知推送）时，iOS 上的 Safari 仍然不支持这个特性。就 API 而言，我们仍然没有：WebRTC、getUserMedia、Service Worker、FileSystem API、Network Information API、Battery Status API、Vibration API 等等……你又在 iOS 上等待哪些特性呢？ </p>
<h2 id="watchOS-与-tvOS"><a href="#watchOS-与-tvOS" class="headerlink" title="watchOS 与 tvOS"></a>watchOS 与 tvOS</h2><p>新发布的 watchOS 2.0 与 tvOS 9.0 都是基于 iOS 的操作系统，它们针对特定的设备发行（Apple Watch 与新的 Apple TV）。从用户的角度来说，那里并没有浏览器了。从开发者的角度，那里也没有 Webview 了。</p>
<p>尽管有不少人抱怨（大部分都是针对 webview 的缺失），我并不能确定这是不是个坏主意。我猜测 Apple 会尝试通过 Siri 来将 “web” 带给 TV、手表、甚至 CarPlay 的用户。所以，如果你遵循了上述的 “App Search” 的步骤，你的内容将可能通过 Siri 在这些设备上以 widget（小部件）或者快捷回复的形式变得可以访问。</p>
<p>对于 Apple TV ，它支持使用 JavaScript、DOM API 与 XMLHttpRequest 来让我们构建某种类似 Client-Server webapp 的东西。没有 HTML 和 CSS，这是什么把戏？其实它支持的叫 TVML，是一种基于 XML、为那些可以被渲染在 TV 屏幕上的特定内容而优化后的标签。这些标签只可以在来自应用商店的 native app 中渲染，但是这些 TVML 是由服务器端来生成的。</p>
<h2 id="著作权声明"><a href="#著作权声明" class="headerlink" title="著作权声明"></a>著作权声明</h2><p>本文译自 <a target="_blank" rel="noopener" href="http://www.mobilexweb.com/blog/ios9-safari-for-web-developers">iOS 9, Safari and the Web: 3D Touch, new Responsive Web Design, Native integration and HTML5 APIs — Breaking the Mobile Web</a><br>译者 <a target="_blank" rel="noopener" href="http://weibo.com/huxpro">黄玄</a>，首次发布于 <a target="_blank" rel="noopener" href="http://huangxuan.me/">Hux Blog</a>，转载请保留以上链接</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/24/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/26/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">vvbuys</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
